[WARNING]: Found both group and host with same name: admin
[WARNING]: Found both group and host with same name: master
ansible-playbook [core 2.15.3]
  config file = None
  configured module search path = ['/home/ec2-user/.ansible/plugins/modules', '/usr/share/ansible/plugins/modules']
  ansible python module location = /usr/lib/python3.9/site-packages/ansible
  ansible collection location = /home/ec2-user/.ansible/collections:/usr/share/ansible/collections
  executable location = /usr/bin/ansible-playbook
  python version = 3.9.16 (main, Apr 24 2024, 00:00:00) [GCC 11.4.1 20230605 (Red Hat 11.4.1-2)] (/usr/bin/python3.9)
  jinja version = 3.1.4
  libyaml = True
No config file found; using defaults
host_list declined parsing /home/ec2-user/devops_setup/kubernetes/inventory as it did not pass its verify_file() method
script declined parsing /home/ec2-user/devops_setup/kubernetes/inventory as it did not pass its verify_file() method
auto declined parsing /home/ec2-user/devops_setup/kubernetes/inventory as it did not pass its verify_file() method
Parsed /home/ec2-user/devops_setup/kubernetes/inventory inventory source with ini plugin
Skipping callback 'default', as we already have a stdout callback.
Skipping callback 'minimal', as we already have a stdout callback.
Skipping callback 'oneline', as we already have a stdout callback.

PLAYBOOK: setup_kubectl_auth.yaml **********************************************
2 plays in /home/ec2-user/devops_setup/ansible/playbooks/kubernetes/setup_kubectl_auth.yaml

PLAY [Setup Jenkins service account on Kubernetes] *****************************

TASK [Gathering Facts] *********************************************************
task path: /home/ec2-user/devops_setup/ansible/playbooks/kubernetes/setup_kubectl_auth.yaml:2
<10.0.1.171> ESTABLISH SSH CONNECTION FOR USER: ec2-user
<10.0.1.171> SSH: EXEC ssh -C -o ControlMaster=auto -o ControlPersist=60s -o KbdInteractiveAuthentication=no -o PreferredAuthentications=gssapi-with-mic,gssapi-keyex,hostbased,publickey -o PasswordAuthentication=no -o 'User="ec2-user"' -o ConnectTimeout=10 -o 'ControlPath="/home/ec2-user/.ansible/cp/f291336e89"' 10.0.1.171 '/bin/sh -c '"'"'echo ~ec2-user && sleep 0'"'"''
<10.0.1.171> (0, b'/home/ec2-user\n', b'')
<10.0.1.171> ESTABLISH SSH CONNECTION FOR USER: ec2-user
<10.0.1.171> SSH: EXEC ssh -C -o ControlMaster=auto -o ControlPersist=60s -o KbdInteractiveAuthentication=no -o PreferredAuthentications=gssapi-with-mic,gssapi-keyex,hostbased,publickey -o PasswordAuthentication=no -o 'User="ec2-user"' -o ConnectTimeout=10 -o 'ControlPath="/home/ec2-user/.ansible/cp/f291336e89"' 10.0.1.171 '/bin/sh -c '"'"'( umask 77 && mkdir -p "` echo /home/ec2-user/.ansible/tmp `"&& mkdir "` echo /home/ec2-user/.ansible/tmp/ansible-tmp-1721489328.1585429-327574-260630976406164 `" && echo ansible-tmp-1721489328.1585429-327574-260630976406164="` echo /home/ec2-user/.ansible/tmp/ansible-tmp-1721489328.1585429-327574-260630976406164 `" ) && sleep 0'"'"''
<10.0.1.171> (0, b'ansible-tmp-1721489328.1585429-327574-260630976406164=/home/ec2-user/.ansible/tmp/ansible-tmp-1721489328.1585429-327574-260630976406164\n', b'')
<master> Attempting python interpreter discovery
<10.0.1.171> ESTABLISH SSH CONNECTION FOR USER: ec2-user
<10.0.1.171> SSH: EXEC ssh -C -o ControlMaster=auto -o ControlPersist=60s -o KbdInteractiveAuthentication=no -o PreferredAuthentications=gssapi-with-mic,gssapi-keyex,hostbased,publickey -o PasswordAuthentication=no -o 'User="ec2-user"' -o ConnectTimeout=10 -o 'ControlPath="/home/ec2-user/.ansible/cp/f291336e89"' 10.0.1.171 '/bin/sh -c '"'"'echo PLATFORM; uname; echo FOUND; command -v '"'"'"'"'"'"'"'"'python3.11'"'"'"'"'"'"'"'"'; command -v '"'"'"'"'"'"'"'"'python3.10'"'"'"'"'"'"'"'"'; command -v '"'"'"'"'"'"'"'"'python3.9'"'"'"'"'"'"'"'"'; command -v '"'"'"'"'"'"'"'"'python3.8'"'"'"'"'"'"'"'"'; command -v '"'"'"'"'"'"'"'"'python3.7'"'"'"'"'"'"'"'"'; command -v '"'"'"'"'"'"'"'"'python3.6'"'"'"'"'"'"'"'"'; command -v '"'"'"'"'"'"'"'"'python3.5'"'"'"'"'"'"'"'"'; command -v '"'"'"'"'"'"'"'"'/usr/bin/python3'"'"'"'"'"'"'"'"'; command -v '"'"'"'"'"'"'"'"'/usr/libexec/platform-python'"'"'"'"'"'"'"'"'; command -v '"'"'"'"'"'"'"'"'python2.7'"'"'"'"'"'"'"'"'; command -v '"'"'"'"'"'"'"'"'/usr/bin/python'"'"'"'"'"'"'"'"'; command -v '"'"'"'"'"'"'"'"'python'"'"'"'"'"'"'"'"'; echo ENDFOUND && sleep 0'"'"''
<10.0.1.171> (0, b'PLATFORM\nLinux\nFOUND\n/usr/bin/python3.9\n/usr/bin/python3\nENDFOUND\n', b'')
<10.0.1.171> ESTABLISH SSH CONNECTION FOR USER: ec2-user
<10.0.1.171> SSH: EXEC ssh -C -o ControlMaster=auto -o ControlPersist=60s -o KbdInteractiveAuthentication=no -o PreferredAuthentications=gssapi-with-mic,gssapi-keyex,hostbased,publickey -o PasswordAuthentication=no -o 'User="ec2-user"' -o ConnectTimeout=10 -o 'ControlPath="/home/ec2-user/.ansible/cp/f291336e89"' 10.0.1.171 '/bin/sh -c '"'"'/usr/bin/python3.9 && sleep 0'"'"''
<10.0.1.171> (0, b'{"platform_dist_result": [], "osrelease_content": "NAME=\\"Amazon Linux\\"\\nVERSION=\\"2023\\"\\nID=\\"amzn\\"\\nID_LIKE=\\"fedora\\"\\nVERSION_ID=\\"2023\\"\\nPLATFORM_ID=\\"platform:al2023\\"\\nPRETTY_NAME=\\"Amazon Linux 2023.5.20240701\\"\\nANSI_COLOR=\\"0;33\\"\\nCPE_NAME=\\"cpe:2.3:o:amazon:amazon_linux:2023\\"\\nHOME_URL=\\"https://aws.amazon.com/linux/amazon-linux-2023/\\"\\nDOCUMENTATION_URL=\\"https://docs.aws.amazon.com/linux/\\"\\nSUPPORT_URL=\\"https://aws.amazon.com/premiumsupport/\\"\\nBUG_REPORT_URL=\\"https://github.com/amazonlinux/amazon-linux-2023\\"\\nVENDOR_NAME=\\"AWS\\"\\nVENDOR_URL=\\"https://aws.amazon.com/\\"\\nSUPPORT_END=\\"2028-03-15\\"\\n"}\n', b'')
<master> Python interpreter discovery fallback (unsupported Linux distribution: amzn)
Using module file /usr/lib/python3.9/site-packages/ansible/modules/setup.py
<10.0.1.171> PUT /home/ec2-user/.ansible/tmp/ansible-local-327570hxfw9f7r/tmpy45xsnb4 TO /home/ec2-user/.ansible/tmp/ansible-tmp-1721489328.1585429-327574-260630976406164/AnsiballZ_setup.py
<10.0.1.171> SSH: EXEC sftp -b - -C -o ControlMaster=auto -o ControlPersist=60s -o KbdInteractiveAuthentication=no -o PreferredAuthentications=gssapi-with-mic,gssapi-keyex,hostbased,publickey -o PasswordAuthentication=no -o 'User="ec2-user"' -o ConnectTimeout=10 -o 'ControlPath="/home/ec2-user/.ansible/cp/f291336e89"' '[10.0.1.171]'
<10.0.1.171> (0, b'sftp> put /home/ec2-user/.ansible/tmp/ansible-local-327570hxfw9f7r/tmpy45xsnb4 /home/ec2-user/.ansible/tmp/ansible-tmp-1721489328.1585429-327574-260630976406164/AnsiballZ_setup.py\n', b'')
<10.0.1.171> ESTABLISH SSH CONNECTION FOR USER: ec2-user
<10.0.1.171> SSH: EXEC ssh -C -o ControlMaster=auto -o ControlPersist=60s -o KbdInteractiveAuthentication=no -o PreferredAuthentications=gssapi-with-mic,gssapi-keyex,hostbased,publickey -o PasswordAuthentication=no -o 'User="ec2-user"' -o ConnectTimeout=10 -o 'ControlPath="/home/ec2-user/.ansible/cp/f291336e89"' 10.0.1.171 '/bin/sh -c '"'"'chmod u+x /home/ec2-user/.ansible/tmp/ansible-tmp-1721489328.1585429-327574-260630976406164/ /home/ec2-user/.ansible/tmp/ansible-tmp-1721489328.1585429-327574-260630976406164/AnsiballZ_setup.py && sleep 0'"'"''
<10.0.1.171> (0, b'', b'')
<10.0.1.171> ESTABLISH SSH CONNECTION FOR USER: ec2-user
<10.0.1.171> SSH: EXEC ssh -C -o ControlMaster=auto -o ControlPersist=60s -o KbdInteractiveAuthentication=no -o PreferredAuthentications=gssapi-with-mic,gssapi-keyex,hostbased,publickey -o PasswordAuthentication=no -o 'User="ec2-user"' -o ConnectTimeout=10 -o 'ControlPath="/home/ec2-user/.ansible/cp/f291336e89"' -tt 10.0.1.171 '/bin/sh -c '"'"'sudo -H -S -n  -u root /bin/sh -c '"'"'"'"'"'"'"'"'echo BECOME-SUCCESS-etdmdlvspyqlkvwybfzuitsqsolakudn ; /usr/bin/python3.9 /home/ec2-user/.ansible/tmp/ansible-tmp-1721489328.1585429-327574-260630976406164/AnsiballZ_setup.py'"'"'"'"'"'"'"'"' && sleep 0'"'"''
Escalation succeeded
<10.0.1.171> (0, b'\r\n{"ansible_facts": {"ansible_is_chroot": false, "ansible_fips": false, "ansible_local": {}, "ansible_distribution": "Amazon", "ansible_distribution_release": "NA", "ansible_distribution_version": "2023", "ansible_distribution_major_version": "2023", "ansible_distribution_file_path": "/etc/os-release", "ansible_distribution_file_variety": "Amazon", "ansible_distribution_file_parsed": true, "ansible_distribution_minor_version": "NA", "ansible_os_family": "RedHat", "ansible_ssh_host_key_ecdsa_public": "AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBDDn0dwOCKjwfU8S0mix7UVFuH1wO8MAmqcUnQ6NvGKwyQFKtM8b5+4JzeNHxqXMSJ26d2/vZ/aDnNJNKWBdxmM=", "ansible_ssh_host_key_ecdsa_public_keytype": "ecdsa-sha2-nistp256", "ansible_ssh_host_key_ed25519_public": "AAAAC3NzaC1lZDI1NTE5AAAAILHqFO/I9aUPcoZg00ak6tbKwIJ+PJ8hzsziBKKN56AG", "ansible_ssh_host_key_ed25519_public_keytype": "ssh-ed25519", "ansible_hostnqn": "", "ansible_system_capabilities_enforced": "False", "ansible_system_capabilities": [], "ansible_virtualization_role": "guest", "ansible_virtualization_type": "kvm", "ansible_virtualization_tech_guest": ["kvm"], "ansible_virtualization_tech_host": [], "ansible_user_id": "root", "ansible_user_uid": 0, "ansible_user_gid": 0, "ansible_user_gecos": "root", "ansible_user_dir": "/root", "ansible_user_shell": "/bin/bash", "ansible_real_user_id": 0, "ansible_effective_user_id": 0, "ansible_real_group_id": 0, "ansible_effective_group_id": 0, "ansible_cmdline": {"BOOT_IMAGE": "(hd0,gpt1)/boot/vmlinuz-6.1.94-99.176.amzn2023.x86_64", "root": "UUID=36d29e5b-3776-49ee-a4d6-5868c3a57848", "ro": true, "console": "ttyS0,115200n8", "nvme_core.io_timeout": "4294967295", "rd.emergency": "poweroff", "rd.shell": "0", "selinux": "1", "security": "selinux", "quiet": true}, "ansible_proc_cmdline": {"BOOT_IMAGE": "(hd0,gpt1)/boot/vmlinuz-6.1.94-99.176.amzn2023.x86_64", "root": "UUID=36d29e5b-3776-49ee-a4d6-5868c3a57848", "ro": true, "console": ["tty0", "ttyS0,115200n8"], "nvme_core.io_timeout": "4294967295", "rd.emergency": "poweroff", "rd.shell": "0", "selinux": "1", "security": "selinux", "quiet": true}, "ansible_env": {"SHELL": "/bin/bash", "SUDO_GID": "1000", "SUDO_COMMAND": "/bin/sh -c echo BECOME-SUCCESS-etdmdlvspyqlkvwybfzuitsqsolakudn ; /usr/bin/python3.9 /home/ec2-user/.ansible/tmp/ansible-tmp-1721489328.1585429-327574-260630976406164/AnsiballZ_setup.py", "SUDO_USER": "ec2-user", "PWD": "/home/ec2-user", "LOGNAME": "root", "HOME": "/root", "LANG": "C.UTF-8", "LS_COLORS": "rs=0:di=01;34:ln=01;36:mh=00:pi=40;33:so=01;35:do=01;35:bd=40;33;01:cd=40;33;01:or=40;31;01:mi=01;37;41:su=37;41:sg=30;43:ca=30;41:tw=30;42:ow=34;42:st=37;44:ex=01;32:*.tar=01;31:*.tgz=01;31:*.arc=01;31:*.arj=01;31:*.taz=01;31:*.lha=01;31:*.lz4=01;31:*.lzh=01;31:*.lzma=01;31:*.tlz=01;31:*.txz=01;31:*.tzo=01;31:*.t7z=01;31:*.zip=01;31:*.z=01;31:*.dz=01;31:*.gz=01;31:*.lrz=01;31:*.lz=01;31:*.lzo=01;31:*.xz=01;31:*.zst=01;31:*.tzst=01;31:*.bz2=01;31:*.bz=01;31:*.tbz=01;31:*.tbz2=01;31:*.tz=01;31:*.deb=01;31:*.rpm=01;31:*.jar=01;31:*.war=01;31:*.ear=01;31:*.sar=01;31:*.rar=01;31:*.alz=01;31:*.ace=01;31:*.zoo=01;31:*.cpio=01;31:*.7z=01;31:*.rz=01;31:*.cab=01;31:*.wim=01;31:*.swm=01;31:*.dwm=01;31:*.esd=01;31:*.jpg=01;35:*.jpeg=01;35:*.mjpg=01;35:*.mjpeg=01;35:*.gif=01;35:*.bmp=01;35:*.pbm=01;35:*.pgm=01;35:*.ppm=01;35:*.tga=01;35:*.xbm=01;35:*.xpm=01;35:*.tif=01;35:*.tiff=01;35:*.png=01;35:*.svg=01;35:*.svgz=01;35:*.mng=01;35:*.pcx=01;35:*.mov=01;35:*.mpg=01;35:*.mpeg=01;35:*.m2v=01;35:*.mkv=01;35:*.webm=01;35:*.webp=01;35:*.ogm=01;35:*.mp4=01;35:*.m4v=01;35:*.mp4v=01;35:*.vob=01;35:*.qt=01;35:*.nuv=01;35:*.wmv=01;35:*.asf=01;35:*.rm=01;35:*.rmvb=01;35:*.flc=01;35:*.avi=01;35:*.fli=01;35:*.flv=01;35:*.gl=01;35:*.dl=01;35:*.xcf=01;35:*.xwd=01;35:*.yuv=01;35:*.cgm=01;35:*.emf=01;35:*.ogv=01;35:*.ogx=01;35:*.aac=01;36:*.au=01;36:*.flac=01;36:*.m4a=01;36:*.mid=01;36:*.midi=01;36:*.mka=01;36:*.mp3=01;36:*.mpc=01;36:*.ogg=01;36:*.ra=01;36:*.wav=01;36:*.oga=01;36:*.opus=01;36:*.spx=01;36:*.xspf=01;36:", "TERM": "xterm-256color", "USER": "root", "SHLVL": "0", "PATH": "/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/var/lib/snapd/snap/bin", "SUDO_UID": "1000", "MAIL": "/var/mail/root", "_": "/usr/bin/python3.9"}, "ansible_system": "Linux", "ansible_kernel": "6.1.94-99.176.amzn2023.x86_64", "ansible_kernel_version": "#1 SMP PREEMPT_DYNAMIC Tue Jun 18 14:57:56 UTC 2024", "ansible_machine": "x86_64", "ansible_python_version": "3.9.16", "ansible_fqdn": "ip-10-0-1-171.eu-north-1.compute.internal", "ansible_hostname": "ip-10-0-1-171", "ansible_nodename": "ip-10-0-1-171.eu-north-1.compute.internal", "ansible_domain": "eu-north-1.compute.internal", "ansible_userspace_bits": "64", "ansible_architecture": "x86_64", "ansible_userspace_architecture": "x86_64", "ansible_machine_id": "ec2c6beabc5db423958bc58dc1c87f27", "ansible_loadavg": {"1m": 1.67, "5m": 0.7, "15m": 0.26}, "ansible_iscsi_iqn": "", "ansible_processor": ["0", "GenuineIntel", "Intel(R) Xeon(R) Platinum 8175M CPU @ 2.50GHz", "1", "GenuineIntel", "Intel(R) Xeon(R) Platinum 8175M CPU @ 2.50GHz"], "ansible_processor_count": 1, "ansible_processor_cores": 1, "ansible_processor_threads_per_core": 2, "ansible_processor_vcpus": 2, "ansible_processor_nproc": 2, "ansible_memtotal_mb": 3827, "ansible_memfree_mb": 1650, "ansible_swaptotal_mb": 0, "ansible_swapfree_mb": 0, "ansible_memory_mb": {"real": {"total": 3827, "used": 2177, "free": 1650}, "nocache": {"free": 3234, "used": 593}, "swap": {"total": 0, "free": 0, "used": 0, "cached": 0}}, "ansible_bios_date": "10/16/2017", "ansible_bios_vendor": "Amazon EC2", "ansible_bios_version": "1.0", "ansible_board_asset_tag": "i-0c0e04ec29dd38e0b", "ansible_board_name": "NA", "ansible_board_serial": "NA", "ansible_board_vendor": "Amazon EC2", "ansible_board_version": "NA", "ansible_chassis_asset_tag": "Amazon EC2", "ansible_chassis_serial": "NA", "ansible_chassis_vendor": "Amazon EC2", "ansible_chassis_version": "NA", "ansible_form_factor": "Other", "ansible_product_name": "t3.medium", "ansible_product_serial": "ec2c6bea-bc5d-b423-958b-c58dc1c87f27", "ansible_product_uuid": "ec2c6bea-bc5d-b423-958b-c58dc1c87f27", "ansible_product_version": "NA", "ansible_system_vendor": "Amazon EC2", "ansible_devices": {"loop1": {"virtual": 1, "links": {"ids": [], "uuids": [], "labels": [], "masters": []}, "vendor": null, "model": null, "sas_address": null, "sas_device_handle": null, "removable": "0", "support_discard": "0", "partitions": {}, "rotational": "1", "scheduler_mode": "none", "sectors": "0", "sectorsize": "512", "size": "0.00 Bytes", "host": "", "holders": []}, "nvme0n1": {"virtual": 1, "links": {"ids": ["nvme-Amazon_Elastic_Block_Store_vol006b4df43030b06c5", "nvme-Amazon_Elastic_Block_Store_vol006b4df43030b06c5-ns-1", "nvme-Amazon_Elastic_Block_Store_vol006b4df43030b06c5_1", "nvme-nvme.1d0f-766f6c3030366234646634333033306230366335-416d617a6f6e20456c617374696320426c6f636b2053746f7265-00000001"], "uuids": [], "labels": [], "masters": []}, "vendor": null, "model": "Amazon Elastic Block Store", "sas_address": null, "sas_device_handle": null, "serial": "vol006b4df43030b06c5", "removable": "0", "support_discard": "0", "partitions": {"nvme0n1p1": {"links": {"ids": ["nvme-Amazon_Elastic_Block_Store_vol006b4df43030b06c5-ns-1-part1", "nvme-Amazon_Elastic_Block_Store_vol006b4df43030b06c5-part1", "nvme-Amazon_Elastic_Block_Store_vol006b4df43030b06c5_1-part1", "nvme-nvme.1d0f-766f6c3030366234646634333033306230366335-416d617a6f6e20456c617374696320426c6f636b2053746f7265-00000001-part1"], "uuids": ["36d29e5b-3776-49ee-a4d6-5868c3a57848"], "labels": ["\\\\x2f"], "masters": []}, "start": "24576", "sectors": "16752607", "sectorsize": 512, "size": "7.99 GB", "uuid": "36d29e5b-3776-49ee-a4d6-5868c3a57848", "holders": []}, "nvme0n1p128": {"links": {"ids": ["nvme-Amazon_Elastic_Block_Store_vol006b4df43030b06c5-ns-1-part128", "nvme-Amazon_Elastic_Block_Store_vol006b4df43030b06c5-part128", "nvme-Amazon_Elastic_Block_Store_vol006b4df43030b06c5_1-part128", "nvme-nvme.1d0f-766f6c3030366234646634333033306230366335-416d617a6f6e20456c617374696320426c6f636b2053746f7265-00000001-part128"], "uuids": ["BE57-6C57"], "labels": [], "masters": []}, "start": "2048", "sectors": "20480", "sectorsize": 512, "size": "10.00 MB", "uuid": "BE57-6C57", "holders": []}, "nvme0n1p127": {"links": {"ids": ["nvme-Amazon_Elastic_Block_Store_vol006b4df43030b06c5-ns-1-part127", "nvme-Amazon_Elastic_Block_Store_vol006b4df43030b06c5-part127", "nvme-Amazon_Elastic_Block_Store_vol006b4df43030b06c5_1-part127", "nvme-nvme.1d0f-766f6c3030366234646634333033306230366335-416d617a6f6e20456c617374696320426c6f636b2053746f7265-00000001-part127"], "uuids": [], "labels": [], "masters": []}, "start": "22528", "sectors": "2048", "sectorsize": 512, "size": "1.00 MB", "uuid": null, "holders": []}}, "rotational": "0", "scheduler_mode": "none", "sectors": "16777216", "sectorsize": "512", "size": "8.00 GB", "host": "Non-Volatile memory controller: Amazon.com, Inc. NVMe EBS Controller", "holders": []}, "loop6": {"virtual": 1, "links": {"ids": [], "uuids": [], "labels": [], "masters": []}, "vendor": null, "model": null, "sas_address": null, "sas_device_handle": null, "removable": "0", "support_discard": "0", "partitions": {}, "rotational": "1", "scheduler_mode": "none", "sectors": "0", "sectorsize": "512", "size": "0.00 Bytes", "host": "", "holders": []}, "loop4": {"virtual": 1, "links": {"ids": [], "uuids": [], "labels": [], "masters": []}, "vendor": null, "model": null, "sas_address": null, "sas_device_handle": null, "removable": "0", "support_discard": "0", "partitions": {}, "rotational": "1", "scheduler_mode": "none", "sectors": "0", "sectorsize": "512", "size": "0.00 Bytes", "host": "", "holders": []}, "loop2": {"virtual": 1, "links": {"ids": [], "uuids": [], "labels": [], "masters": []}, "vendor": null, "model": null, "sas_address": null, "sas_device_handle": null, "removable": "0", "support_discard": "0", "partitions": {}, "rotational": "1", "scheduler_mode": "none", "sectors": "0", "sectorsize": "512", "size": "0.00 Bytes", "host": "", "holders": []}, "loop0": {"virtual": 1, "links": {"ids": [], "uuids": [], "labels": [], "masters": []}, "vendor": null, "model": null, "sas_address": null, "sas_device_handle": null, "removable": "0", "support_discard": "0", "partitions": {}, "rotational": "1", "scheduler_mode": "none", "sectors": "0", "sectorsize": "512", "size": "0.00 Bytes", "host": "", "holders": []}, "loop7": {"virtual": 1, "links": {"ids": [], "uuids": [], "labels": [], "masters": []}, "vendor": null, "model": null, "sas_address": null, "sas_device_handle": null, "removable": "0", "support_discard": "0", "partitions": {}, "rotational": "1", "scheduler_mode": "none", "sectors": "0", "sectorsize": "512", "size": "0.00 Bytes", "host": "", "holders": []}, "loop5": {"virtual": 1, "links": {"ids": [], "uuids": [], "labels": [], "masters": []}, "vendor": null, "model": null, "sas_address": null, "sas_device_handle": null, "removable": "0", "support_discard": "0", "partitions": {}, "rotational": "1", "scheduler_mode": "none", "sectors": "0", "sectorsize": "512", "size": "0.00 Bytes", "host": "", "holders": []}, "loop3": {"virtual": 1, "links": {"ids": [], "uuids": [], "labels": [], "masters": []}, "vendor": null, "model": null, "sas_address": null, "sas_device_handle": null, "removable": "0", "support_discard": "0", "partitions": {}, "rotational": "1", "scheduler_mode": "none", "sectors": "0", "sectorsize": "512", "size": "0.00 Bytes", "host": "", "holders": []}}, "ansible_device_links": {"ids": {"nvme0n1p128": ["nvme-Amazon_Elastic_Block_Store_vol006b4df43030b06c5-ns-1-part128", "nvme-Amazon_Elastic_Block_Store_vol006b4df43030b06c5-part128", "nvme-Amazon_Elastic_Block_Store_vol006b4df43030b06c5_1-part128", "nvme-nvme.1d0f-766f6c3030366234646634333033306230366335-416d617a6f6e20456c617374696320426c6f636b2053746f7265-00000001-part128"], "nvme0n1p1": ["nvme-Amazon_Elastic_Block_Store_vol006b4df43030b06c5-ns-1-part1", "nvme-Amazon_Elastic_Block_Store_vol006b4df43030b06c5-part1", "nvme-Amazon_Elastic_Block_Store_vol006b4df43030b06c5_1-part1", "nvme-nvme.1d0f-766f6c3030366234646634333033306230366335-416d617a6f6e20456c617374696320426c6f636b2053746f7265-00000001-part1"], "nvme0n1p127": ["nvme-Amazon_Elastic_Block_Store_vol006b4df43030b06c5-ns-1-part127", "nvme-Amazon_Elastic_Block_Store_vol006b4df43030b06c5-part127", "nvme-Amazon_Elastic_Block_Store_vol006b4df43030b06c5_1-part127", "nvme-nvme.1d0f-766f6c3030366234646634333033306230366335-416d617a6f6e20456c617374696320426c6f636b2053746f7265-00000001-part127"], "nvme0n1": ["nvme-Amazon_Elastic_Block_Store_vol006b4df43030b06c5", "nvme-Amazon_Elastic_Block_Store_vol006b4df43030b06c5-ns-1", "nvme-Amazon_Elastic_Block_Store_vol006b4df43030b06c5_1", "nvme-nvme.1d0f-766f6c3030366234646634333033306230366335-416d617a6f6e20456c617374696320426c6f636b2053746f7265-00000001"]}, "uuids": {"nvme0n1p128": ["BE57-6C57"], "nvme0n1p1": ["36d29e5b-3776-49ee-a4d6-5868c3a57848"]}, "labels": {"nvme0n1p1": ["\\\\x2f"]}, "masters": {}}, "ansible_uptime_seconds": 132, "ansible_lvm": "N/A", "ansible_mounts": [{"mount": "/", "device": "/dev/nvme0n1p1", "fstype": "xfs", "options": "rw,seclabel,noatime,attr2,inode64,logbufs=8,logbsize=32k,sunit=1024,swidth=1024,noquota", "size_total": 8510222336, "size_available": 5442535424, "block_size": 4096, "block_total": 2077691, "block_available": 1328744, "block_used": 748947, "inode_total": 4188096, "inode_available": 4131957, "inode_used": 56139, "uuid": "36d29e5b-3776-49ee-a4d6-5868c3a57848"}, {"mount": "/boot/efi", "device": "/dev/nvme0n1p128", "fstype": "vfat", "options": "rw,noatime,fmask=0077,dmask=0077,codepage=437,iocharset=ascii,shortname=winnt,errors=remount-ro", "size_total": 10446848, "size_available": 9105408, "block_size": 2048, "block_total": 5101, "block_available": 4446, "block_used": 655, "inode_total": 0, "inode_available": 0, "inode_used": 0, "uuid": "BE57-6C57"}], "ansible_selinux_python_present": true, "ansible_selinux": {"status": "enabled", "policyvers": 33, "config_mode": "permissive", "mode": "permissive", "type": "targeted"}, "ansible_apparmor": {"status": "disabled"}, "ansible_fibre_channel_wwn": [], "ansible_lsb": {}, "ansible_date_time": {"year": "2024", "month": "07", "weekday": "Saturday", "weekday_number": "6", "weeknumber": "29", "day": "20", "hour": "15", "minute": "28", "second": "49", "epoch": "1721489329", "epoch_int": "1721489329", "date": "2024-07-20", "time": "15:28:49", "iso8601_micro": "2024-07-20T15:28:49.601479Z", "iso8601": "2024-07-20T15:28:49Z", "iso8601_basic": "20240720T152849601479", "iso8601_basic_short": "20240720T152849", "tz": "UTC", "tz_dst": "UTC", "tz_offset": "+0000"}, "ansible_interfaces": ["ens5", "lo"], "ansible_lo": {"device": "lo", "mtu": 65536, "active": true, "type": "loopback", "promisc": false, "ipv4": {"address": "127.0.0.1", "broadcast": "", "netmask": "255.0.0.0", "network": "127.0.0.0", "prefix": "8"}, "ipv6": [{"address": "::1", "prefix": "128", "scope": "host"}], "features": {"rx_checksumming": "on [fixed]", "tx_checksumming": "on", "tx_checksum_ipv4": "off [fixed]", "tx_checksum_ip_generic": "on [fixed]", "tx_checksum_ipv6": "off [fixed]", "tx_checksum_fcoe_crc": "off [fixed]", "tx_checksum_sctp": "on [fixed]", "scatter_gather": "on", "tx_scatter_gather": "on [fixed]", "tx_scatter_gather_fraglist": "on [fixed]", "tcp_segmentation_offload": "on", "tx_tcp_segmentation": "on", "tx_tcp_ecn_segmentation": "on", "tx_tcp_mangleid_segmentation": "on", "tx_tcp6_segmentation": "on", "generic_segmentation_offload": "on", "generic_receive_offload": "on", "large_receive_offload": "off [fixed]", "rx_vlan_offload": "off [fixed]", "tx_vlan_offload": "off [fixed]", "ntuple_filters": "off [fixed]", "receive_hashing": "off [fixed]", "highdma": "on [fixed]", "rx_vlan_filter": "off [fixed]", "vlan_challenged": "on [fixed]", "tx_lockless": "on [fixed]", "netns_local": "on [fixed]", "tx_gso_robust": "off [fixed]", "tx_fcoe_segmentation": "off [fixed]", "tx_gre_segmentation": "off [fixed]", "tx_gre_csum_segmentation": "off [fixed]", "tx_ipxip4_segmentation": "off [fixed]", "tx_ipxip6_segmentation": "off [fixed]", "tx_udp_tnl_segmentation": "off [fixed]", "tx_udp_tnl_csum_segmentation": "off [fixed]", "tx_gso_partial": "off [fixed]", "tx_tunnel_remcsum_segmentation": "off [fixed]", "tx_sctp_segmentation": "on", "tx_esp_segmentation": "off [fixed]", "tx_udp_segmentation": "on", "tx_gso_list": "on", "fcoe_mtu": "off [fixed]", "tx_nocache_copy": "off [fixed]", "loopback": "on [fixed]", "rx_fcs": "off [fixed]", "rx_all": "off [fixed]", "tx_vlan_stag_hw_insert": "off [fixed]", "rx_vlan_stag_hw_parse": "off [fixed]", "rx_vlan_stag_filter": "off [fixed]", "l2_fwd_offload": "off [fixed]", "hw_tc_offload": "off [fixed]", "esp_hw_offload": "off [fixed]", "esp_tx_csum_hw_offload": "off [fixed]", "rx_udp_tunnel_port_offload": "off [fixed]", "tls_hw_tx_offload": "off [fixed]", "tls_hw_rx_offload": "off [fixed]", "rx_gro_hw": "off [fixed]", "tls_hw_record": "off [fixed]", "rx_gro_list": "off", "macsec_hw_offload": "off [fixed]", "rx_udp_gro_forwarding": "off", "hsr_tag_ins_offload": "off [fixed]", "hsr_tag_rm_offload": "off [fixed]", "hsr_fwd_offload": "off [fixed]", "hsr_dup_offload": "off [fixed]"}, "timestamping": [], "hw_timestamp_filters": []}, "ansible_ens5": {"device": "ens5", "macaddress": "06:3e:91:bf:45:f5", "mtu": 9001, "active": true, "module": "ena", "type": "ether", "pciid": "0000:00:05.0", "promisc": false, "ipv4": {"address": "10.0.1.171", "broadcast": "", "netmask": "255.255.255.0", "network": "10.0.1.0", "prefix": "24"}, "ipv6": [{"address": "fe80::43e:91ff:febf:45f5", "prefix": "64", "scope": "link"}], "features": {"rx_checksumming": "off [fixed]", "tx_checksumming": "on", "tx_checksum_ipv4": "on", "tx_checksum_ip_generic": "off [fixed]", "tx_checksum_ipv6": "on", "tx_checksum_fcoe_crc": "off [fixed]", "tx_checksum_sctp": "off [fixed]", "scatter_gather": "on", "tx_scatter_gather": "on", "tx_scatter_gather_fraglist": "off [fixed]", "tcp_segmentation_offload": "off", "tx_tcp_segmentation": "off [fixed]", "tx_tcp_ecn_segmentation": "off [fixed]", "tx_tcp_mangleid_segmentation": "off [fixed]", "tx_tcp6_segmentation": "off [fixed]", "generic_segmentation_offload": "on", "generic_receive_offload": "on", "large_receive_offload": "off [fixed]", "rx_vlan_offload": "off [fixed]", "tx_vlan_offload": "off [fixed]", "ntuple_filters": "off [fixed]", "receive_hashing": "on", "highdma": "on", "rx_vlan_filter": "off [fixed]", "vlan_challenged": "off [fixed]", "tx_lockless": "off [fixed]", "netns_local": "off [fixed]", "tx_gso_robust": "off [fixed]", "tx_fcoe_segmentation": "off [fixed]", "tx_gre_segmentation": "off [fixed]", "tx_gre_csum_segmentation": "off [fixed]", "tx_ipxip4_segmentation": "off [fixed]", "tx_ipxip6_segmentation": "off [fixed]", "tx_udp_tnl_segmentation": "off [fixed]", "tx_udp_tnl_csum_segmentation": "off [fixed]", "tx_gso_partial": "off [fixed]", "tx_tunnel_remcsum_segmentation": "off [fixed]", "tx_sctp_segmentation": "off [fixed]", "tx_esp_segmentation": "off [fixed]", "tx_udp_segmentation": "off [fixed]", "tx_gso_list": "off [fixed]", "fcoe_mtu": "off [fixed]", "tx_nocache_copy": "off", "loopback": "off [fixed]", "rx_fcs": "off [fixed]", "rx_all": "off [fixed]", "tx_vlan_stag_hw_insert": "off [fixed]", "rx_vlan_stag_hw_parse": "off [fixed]", "rx_vlan_stag_filter": "off [fixed]", "l2_fwd_offload": "off [fixed]", "hw_tc_offload": "off [fixed]", "esp_hw_offload": "off [fixed]", "esp_tx_csum_hw_offload": "off [fixed]", "rx_udp_tunnel_port_offload": "off [fixed]", "tls_hw_tx_offload": "off [fixed]", "tls_hw_rx_offload": "off [fixed]", "rx_gro_hw": "off [fixed]", "tls_hw_record": "off [fixed]", "rx_gro_list": "off", "macsec_hw_offload": "off [fixed]", "rx_udp_gro_forwarding": "off", "hsr_tag_ins_offload": "off [fixed]", "hsr_tag_rm_offload": "off [fixed]", "hsr_fwd_offload": "off [fixed]", "hsr_dup_offload": "off [fixed]"}, "timestamping": [], "hw_timestamp_filters": []}, "ansible_default_ipv4": {"gateway": "10.0.1.1", "interface": "ens5", "address": "10.0.1.171", "broadcast": "", "netmask": "255.255.255.0", "network": "10.0.1.0", "prefix": "24", "macaddress": "06:3e:91:bf:45:f5", "mtu": 9001, "type": "ether", "alias": "ens5"}, "ansible_default_ipv6": {}, "ansible_all_ipv4_addresses": ["10.0.1.171"], "ansible_all_ipv6_addresses": ["fe80::43e:91ff:febf:45f5"], "ansible_locally_reachable_ips": {"ipv4": ["10.0.1.171", "127.0.0.0/8", "127.0.0.1"], "ipv6": ["::1", "fe80::43e:91ff:febf:45f5"]}, "ansible_dns": {"nameservers": ["10.0.0.2"], "search": ["eu-north-1.compute.internal"]}, "ansible_pkg_mgr": "dnf", "ansible_python": {"version": {"major": 3, "minor": 9, "micro": 16, "releaselevel": "final", "serial": 0}, "version_info": [3, 9, 16, "final", 0], "executable": "/usr/bin/python3.9", "has_sslcontext": true, "type": "cpython"}, "ansible_service_mgr": "systemd", "gather_subset": ["all"], "module_setup": true}, "invocation": {"module_args": {"gather_subset": ["all"], "gather_timeout": 10, "filter": [], "fact_path": "/etc/ansible/facts.d"}}}\r\n', b'Shared connection to 10.0.1.171 closed.\r\n')
[WARNING]: Platform linux on host master is using the discovered Python
interpreter at /usr/bin/python3.9, but future installation of another Python
interpreter could change the meaning of that path. See
https://docs.ansible.com/ansible-
core/2.15/reference_appendices/interpreter_discovery.html for more information.
<10.0.1.171> ESTABLISH SSH CONNECTION FOR USER: ec2-user
<10.0.1.171> SSH: EXEC ssh -C -o ControlMaster=auto -o ControlPersist=60s -o KbdInteractiveAuthentication=no -o PreferredAuthentications=gssapi-with-mic,gssapi-keyex,hostbased,publickey -o PasswordAuthentication=no -o 'User="ec2-user"' -o ConnectTimeout=10 -o 'ControlPath="/home/ec2-user/.ansible/cp/f291336e89"' 10.0.1.171 '/bin/sh -c '"'"'rm -f -r /home/ec2-user/.ansible/tmp/ansible-tmp-1721489328.1585429-327574-260630976406164/ > /dev/null 2>&1 && sleep 0'"'"''
<10.0.1.171> (0, b'', b'')
ok: [master]

TASK [Get private IP using curl] ***********************************************
task path: /home/ec2-user/devops_setup/ansible/playbooks/kubernetes/setup_kubectl_auth.yaml:6
<10.0.1.171> ESTABLISH SSH CONNECTION FOR USER: ec2-user
<10.0.1.171> SSH: EXEC ssh -C -o ControlMaster=auto -o ControlPersist=60s -o KbdInteractiveAuthentication=no -o PreferredAuthentications=gssapi-with-mic,gssapi-keyex,hostbased,publickey -o PasswordAuthentication=no -o 'User="ec2-user"' -o ConnectTimeout=10 -o 'ControlPath="/home/ec2-user/.ansible/cp/f291336e89"' 10.0.1.171 '/bin/sh -c '"'"'echo ~ec2-user && sleep 0'"'"''
<10.0.1.171> (0, b'/home/ec2-user\n', b'')
<10.0.1.171> ESTABLISH SSH CONNECTION FOR USER: ec2-user
<10.0.1.171> SSH: EXEC ssh -C -o ControlMaster=auto -o ControlPersist=60s -o KbdInteractiveAuthentication=no -o PreferredAuthentications=gssapi-with-mic,gssapi-keyex,hostbased,publickey -o PasswordAuthentication=no -o 'User="ec2-user"' -o ConnectTimeout=10 -o 'ControlPath="/home/ec2-user/.ansible/cp/f291336e89"' 10.0.1.171 '/bin/sh -c '"'"'( umask 77 && mkdir -p "` echo /home/ec2-user/.ansible/tmp `"&& mkdir "` echo /home/ec2-user/.ansible/tmp/ansible-tmp-1721489329.8603547-327620-192994025159144 `" && echo ansible-tmp-1721489329.8603547-327620-192994025159144="` echo /home/ec2-user/.ansible/tmp/ansible-tmp-1721489329.8603547-327620-192994025159144 `" ) && sleep 0'"'"''
<10.0.1.171> (0, b'ansible-tmp-1721489329.8603547-327620-192994025159144=/home/ec2-user/.ansible/tmp/ansible-tmp-1721489329.8603547-327620-192994025159144\n', b'')
Using module file /usr/lib/python3.9/site-packages/ansible/modules/command.py
<10.0.1.171> PUT /home/ec2-user/.ansible/tmp/ansible-local-327570hxfw9f7r/tmpe7his4co TO /home/ec2-user/.ansible/tmp/ansible-tmp-1721489329.8603547-327620-192994025159144/AnsiballZ_command.py
<10.0.1.171> SSH: EXEC sftp -b - -C -o ControlMaster=auto -o ControlPersist=60s -o KbdInteractiveAuthentication=no -o PreferredAuthentications=gssapi-with-mic,gssapi-keyex,hostbased,publickey -o PasswordAuthentication=no -o 'User="ec2-user"' -o ConnectTimeout=10 -o 'ControlPath="/home/ec2-user/.ansible/cp/f291336e89"' '[10.0.1.171]'
<10.0.1.171> (0, b'sftp> put /home/ec2-user/.ansible/tmp/ansible-local-327570hxfw9f7r/tmpe7his4co /home/ec2-user/.ansible/tmp/ansible-tmp-1721489329.8603547-327620-192994025159144/AnsiballZ_command.py\n', b'')
<10.0.1.171> ESTABLISH SSH CONNECTION FOR USER: ec2-user
<10.0.1.171> SSH: EXEC ssh -C -o ControlMaster=auto -o ControlPersist=60s -o KbdInteractiveAuthentication=no -o PreferredAuthentications=gssapi-with-mic,gssapi-keyex,hostbased,publickey -o PasswordAuthentication=no -o 'User="ec2-user"' -o ConnectTimeout=10 -o 'ControlPath="/home/ec2-user/.ansible/cp/f291336e89"' 10.0.1.171 '/bin/sh -c '"'"'chmod u+x /home/ec2-user/.ansible/tmp/ansible-tmp-1721489329.8603547-327620-192994025159144/ /home/ec2-user/.ansible/tmp/ansible-tmp-1721489329.8603547-327620-192994025159144/AnsiballZ_command.py && sleep 0'"'"''
<10.0.1.171> (0, b'', b'')
<10.0.1.171> ESTABLISH SSH CONNECTION FOR USER: ec2-user
<10.0.1.171> SSH: EXEC ssh -C -o ControlMaster=auto -o ControlPersist=60s -o KbdInteractiveAuthentication=no -o PreferredAuthentications=gssapi-with-mic,gssapi-keyex,hostbased,publickey -o PasswordAuthentication=no -o 'User="ec2-user"' -o ConnectTimeout=10 -o 'ControlPath="/home/ec2-user/.ansible/cp/f291336e89"' -tt 10.0.1.171 '/bin/sh -c '"'"'sudo -H -S -n  -u root /bin/sh -c '"'"'"'"'"'"'"'"'echo BECOME-SUCCESS-atkkcacottfwsuevkuijeaxgijknyyfo ; /usr/bin/python3.9 /home/ec2-user/.ansible/tmp/ansible-tmp-1721489329.8603547-327620-192994025159144/AnsiballZ_command.py'"'"'"'"'"'"'"'"' && sleep 0'"'"''
Escalation succeeded
<10.0.1.171> (0, b'\r\n{"changed": true, "stdout": "", "stderr": "", "rc": 0, "cmd": ["curl", "-s", "http://169.254.169.254/latest/meta-data/local-ipv4"], "start": "2024-07-20 15:28:50.452464", "end": "2024-07-20 15:28:50.460911", "delta": "0:00:00.008447", "msg": "", "invocation": {"module_args": {"_raw_params": "curl -s http://169.254.169.254/latest/meta-data/local-ipv4", "_uses_shell": false, "stdin_add_newline": true, "strip_empty_ends": true, "argv": null, "chdir": null, "executable": null, "creates": null, "removes": null, "stdin": null}}}\r\n', b'Shared connection to 10.0.1.171 closed.\r\n')
<10.0.1.171> ESTABLISH SSH CONNECTION FOR USER: ec2-user
<10.0.1.171> SSH: EXEC ssh -C -o ControlMaster=auto -o ControlPersist=60s -o KbdInteractiveAuthentication=no -o PreferredAuthentications=gssapi-with-mic,gssapi-keyex,hostbased,publickey -o PasswordAuthentication=no -o 'User="ec2-user"' -o ConnectTimeout=10 -o 'ControlPath="/home/ec2-user/.ansible/cp/f291336e89"' 10.0.1.171 '/bin/sh -c '"'"'rm -f -r /home/ec2-user/.ansible/tmp/ansible-tmp-1721489329.8603547-327620-192994025159144/ > /dev/null 2>&1 && sleep 0'"'"''
<10.0.1.171> (0, b'', b'')
changed: [master] => {
    "changed": true,
    "cmd": [
        "curl",
        "-s",
        "http://169.254.169.254/latest/meta-data/local-ipv4"
    ],
    "delta": "0:00:00.008447",
    "end": "2024-07-20 15:28:50.460911",
    "invocation": {
        "module_args": {
            "_raw_params": "curl -s http://169.254.169.254/latest/meta-data/local-ipv4",
            "_uses_shell": false,
            "argv": null,
            "chdir": null,
            "creates": null,
            "executable": null,
            "removes": null,
            "stdin": null,
            "stdin_add_newline": true,
            "strip_empty_ends": true
        }
    },
    "msg": "",
    "rc": 0,
    "start": "2024-07-20 15:28:50.452464",
    "stderr": "",
    "stderr_lines": [],
    "stdout": "",
    "stdout_lines": []
}

TASK [Set master private IP fact] **********************************************
task path: /home/ec2-user/devops_setup/ansible/playbooks/kubernetes/setup_kubectl_auth.yaml:10
ok: [master] => {
    "ansible_facts": {
        "master_private_ip": ""
    },
    "changed": false
}

TASK [Print private IP] ********************************************************
task path: /home/ec2-user/devops_setup/ansible/playbooks/kubernetes/setup_kubectl_auth.yaml:14
ok: [master] => {
    "msg": "The private IP of the target server is: 10.0.1.171"
}

TASK [Set KUBECONFIG environment variable] *************************************
task path: /home/ec2-user/devops_setup/ansible/playbooks/kubernetes/setup_kubectl_auth.yaml:18
ok: [master] => {
    "ansible_facts": {
        "kubeconfig_path": "/etc/kubernetes/admin.conf"
    },
    "changed": false
}

TASK [Remove existing Jenkins service account] *********************************
task path: /home/ec2-user/devops_setup/ansible/playbooks/kubernetes/setup_kubectl_auth.yaml:22
<10.0.1.171> ESTABLISH SSH CONNECTION FOR USER: ec2-user
<10.0.1.171> SSH: EXEC ssh -C -o ControlMaster=auto -o ControlPersist=60s -o KbdInteractiveAuthentication=no -o PreferredAuthentications=gssapi-with-mic,gssapi-keyex,hostbased,publickey -o PasswordAuthentication=no -o 'User="ec2-user"' -o ConnectTimeout=10 -o 'ControlPath="/home/ec2-user/.ansible/cp/f291336e89"' 10.0.1.171 '/bin/sh -c '"'"'echo ~ec2-user && sleep 0'"'"''
<10.0.1.171> (0, b'/home/ec2-user\n', b'')
<10.0.1.171> ESTABLISH SSH CONNECTION FOR USER: ec2-user
<10.0.1.171> SSH: EXEC ssh -C -o ControlMaster=auto -o ControlPersist=60s -o KbdInteractiveAuthentication=no -o PreferredAuthentications=gssapi-with-mic,gssapi-keyex,hostbased,publickey -o PasswordAuthentication=no -o 'User="ec2-user"' -o ConnectTimeout=10 -o 'ControlPath="/home/ec2-user/.ansible/cp/f291336e89"' 10.0.1.171 '/bin/sh -c '"'"'( umask 77 && mkdir -p "` echo /home/ec2-user/.ansible/tmp `"&& mkdir "` echo /home/ec2-user/.ansible/tmp/ansible-tmp-1721489330.6970513-327635-108160141268913 `" && echo ansible-tmp-1721489330.6970513-327635-108160141268913="` echo /home/ec2-user/.ansible/tmp/ansible-tmp-1721489330.6970513-327635-108160141268913 `" ) && sleep 0'"'"''
<10.0.1.171> (0, b'ansible-tmp-1721489330.6970513-327635-108160141268913=/home/ec2-user/.ansible/tmp/ansible-tmp-1721489330.6970513-327635-108160141268913\n', b'')
Using module file /usr/lib/python3.9/site-packages/ansible/modules/command.py
<10.0.1.171> PUT /home/ec2-user/.ansible/tmp/ansible-local-327570hxfw9f7r/tmpfblmc_x9 TO /home/ec2-user/.ansible/tmp/ansible-tmp-1721489330.6970513-327635-108160141268913/AnsiballZ_command.py
<10.0.1.171> SSH: EXEC sftp -b - -C -o ControlMaster=auto -o ControlPersist=60s -o KbdInteractiveAuthentication=no -o PreferredAuthentications=gssapi-with-mic,gssapi-keyex,hostbased,publickey -o PasswordAuthentication=no -o 'User="ec2-user"' -o ConnectTimeout=10 -o 'ControlPath="/home/ec2-user/.ansible/cp/f291336e89"' '[10.0.1.171]'
<10.0.1.171> (0, b'sftp> put /home/ec2-user/.ansible/tmp/ansible-local-327570hxfw9f7r/tmpfblmc_x9 /home/ec2-user/.ansible/tmp/ansible-tmp-1721489330.6970513-327635-108160141268913/AnsiballZ_command.py\n', b'')
<10.0.1.171> ESTABLISH SSH CONNECTION FOR USER: ec2-user
<10.0.1.171> SSH: EXEC ssh -C -o ControlMaster=auto -o ControlPersist=60s -o KbdInteractiveAuthentication=no -o PreferredAuthentications=gssapi-with-mic,gssapi-keyex,hostbased,publickey -o PasswordAuthentication=no -o 'User="ec2-user"' -o ConnectTimeout=10 -o 'ControlPath="/home/ec2-user/.ansible/cp/f291336e89"' 10.0.1.171 '/bin/sh -c '"'"'chmod u+x /home/ec2-user/.ansible/tmp/ansible-tmp-1721489330.6970513-327635-108160141268913/ /home/ec2-user/.ansible/tmp/ansible-tmp-1721489330.6970513-327635-108160141268913/AnsiballZ_command.py && sleep 0'"'"''
<10.0.1.171> (0, b'', b'')
<10.0.1.171> ESTABLISH SSH CONNECTION FOR USER: ec2-user
<10.0.1.171> SSH: EXEC ssh -C -o ControlMaster=auto -o ControlPersist=60s -o KbdInteractiveAuthentication=no -o PreferredAuthentications=gssapi-with-mic,gssapi-keyex,hostbased,publickey -o PasswordAuthentication=no -o 'User="ec2-user"' -o ConnectTimeout=10 -o 'ControlPath="/home/ec2-user/.ansible/cp/f291336e89"' -tt 10.0.1.171 '/bin/sh -c '"'"'sudo -H -S -n  -u root /bin/sh -c '"'"'"'"'"'"'"'"'echo BECOME-SUCCESS-rxxyjtiimgpknatrgvnlquqicbpokxkf ; KUBECONFIG=/etc/kubernetes/admin.conf /usr/bin/python3.9 /home/ec2-user/.ansible/tmp/ansible-tmp-1721489330.6970513-327635-108160141268913/AnsiballZ_command.py'"'"'"'"'"'"'"'"' && sleep 0'"'"''
Escalation succeeded
<10.0.1.171> (1, b'\r\n{"changed": true, "stdout": "", "stderr": "Error from server (NotFound): serviceaccounts \\"jenkins\\" not found", "rc": 1, "cmd": ["kubectl", "delete", "serviceaccount", "jenkins", "-n", "default"], "start": "2024-07-20 15:28:51.202166", "end": "2024-07-20 15:28:51.321999", "delta": "0:00:00.119833", "failed": true, "msg": "non-zero return code", "invocation": {"module_args": {"_raw_params": "kubectl delete serviceaccount jenkins -n default", "_uses_shell": false, "stdin_add_newline": true, "strip_empty_ends": true, "argv": null, "chdir": null, "executable": null, "creates": null, "removes": null, "stdin": null}}}\r\n', b'Shared connection to 10.0.1.171 closed.\r\n')
<10.0.1.171> Failed to connect to the host via ssh: Shared connection to 10.0.1.171 closed.
<10.0.1.171> ESTABLISH SSH CONNECTION FOR USER: ec2-user
<10.0.1.171> SSH: EXEC ssh -C -o ControlMaster=auto -o ControlPersist=60s -o KbdInteractiveAuthentication=no -o PreferredAuthentications=gssapi-with-mic,gssapi-keyex,hostbased,publickey -o PasswordAuthentication=no -o 'User="ec2-user"' -o ConnectTimeout=10 -o 'ControlPath="/home/ec2-user/.ansible/cp/f291336e89"' 10.0.1.171 '/bin/sh -c '"'"'rm -f -r /home/ec2-user/.ansible/tmp/ansible-tmp-1721489330.6970513-327635-108160141268913/ > /dev/null 2>&1 && sleep 0'"'"''
<10.0.1.171> (0, b'', b'')
fatal: [master]: FAILED! => {
    "changed": true,
    "cmd": [
        "kubectl",
        "delete",
        "serviceaccount",
        "jenkins",
        "-n",
        "default"
    ],
    "delta": "0:00:00.119833",
    "end": "2024-07-20 15:28:51.321999",
    "invocation": {
        "module_args": {
            "_raw_params": "kubectl delete serviceaccount jenkins -n default",
            "_uses_shell": false,
            "argv": null,
            "chdir": null,
            "creates": null,
            "executable": null,
            "removes": null,
            "stdin": null,
            "stdin_add_newline": true,
            "strip_empty_ends": true
        }
    },
    "msg": "non-zero return code",
    "rc": 1,
    "start": "2024-07-20 15:28:51.202166",
    "stderr": "Error from server (NotFound): serviceaccounts \"jenkins\" not found",
    "stderr_lines": [
        "Error from server (NotFound): serviceaccounts \"jenkins\" not found"
    ],
    "stdout": "",
    "stdout_lines": []
}
...ignoring

TASK [Remove existing Jenkins cluster role binding] ****************************
task path: /home/ec2-user/devops_setup/ansible/playbooks/kubernetes/setup_kubectl_auth.yaml:28
<10.0.1.171> ESTABLISH SSH CONNECTION FOR USER: ec2-user
<10.0.1.171> SSH: EXEC ssh -C -o ControlMaster=auto -o ControlPersist=60s -o KbdInteractiveAuthentication=no -o PreferredAuthentications=gssapi-with-mic,gssapi-keyex,hostbased,publickey -o PasswordAuthentication=no -o 'User="ec2-user"' -o ConnectTimeout=10 -o 'ControlPath="/home/ec2-user/.ansible/cp/f291336e89"' 10.0.1.171 '/bin/sh -c '"'"'echo ~ec2-user && sleep 0'"'"''
<10.0.1.171> (0, b'/home/ec2-user\n', b'')
<10.0.1.171> ESTABLISH SSH CONNECTION FOR USER: ec2-user
<10.0.1.171> SSH: EXEC ssh -C -o ControlMaster=auto -o ControlPersist=60s -o KbdInteractiveAuthentication=no -o PreferredAuthentications=gssapi-with-mic,gssapi-keyex,hostbased,publickey -o PasswordAuthentication=no -o 'User="ec2-user"' -o ConnectTimeout=10 -o 'ControlPath="/home/ec2-user/.ansible/cp/f291336e89"' 10.0.1.171 '/bin/sh -c '"'"'( umask 77 && mkdir -p "` echo /home/ec2-user/.ansible/tmp `"&& mkdir "` echo /home/ec2-user/.ansible/tmp/ansible-tmp-1721489331.5064702-327650-163739741050998 `" && echo ansible-tmp-1721489331.5064702-327650-163739741050998="` echo /home/ec2-user/.ansible/tmp/ansible-tmp-1721489331.5064702-327650-163739741050998 `" ) && sleep 0'"'"''
<10.0.1.171> (0, b'ansible-tmp-1721489331.5064702-327650-163739741050998=/home/ec2-user/.ansible/tmp/ansible-tmp-1721489331.5064702-327650-163739741050998\n', b'')
Using module file /usr/lib/python3.9/site-packages/ansible/modules/command.py
<10.0.1.171> PUT /home/ec2-user/.ansible/tmp/ansible-local-327570hxfw9f7r/tmpeii8vwde TO /home/ec2-user/.ansible/tmp/ansible-tmp-1721489331.5064702-327650-163739741050998/AnsiballZ_command.py
<10.0.1.171> SSH: EXEC sftp -b - -C -o ControlMaster=auto -o ControlPersist=60s -o KbdInteractiveAuthentication=no -o PreferredAuthentications=gssapi-with-mic,gssapi-keyex,hostbased,publickey -o PasswordAuthentication=no -o 'User="ec2-user"' -o ConnectTimeout=10 -o 'ControlPath="/home/ec2-user/.ansible/cp/f291336e89"' '[10.0.1.171]'
<10.0.1.171> (0, b'sftp> put /home/ec2-user/.ansible/tmp/ansible-local-327570hxfw9f7r/tmpeii8vwde /home/ec2-user/.ansible/tmp/ansible-tmp-1721489331.5064702-327650-163739741050998/AnsiballZ_command.py\n', b'')
<10.0.1.171> ESTABLISH SSH CONNECTION FOR USER: ec2-user
<10.0.1.171> SSH: EXEC ssh -C -o ControlMaster=auto -o ControlPersist=60s -o KbdInteractiveAuthentication=no -o PreferredAuthentications=gssapi-with-mic,gssapi-keyex,hostbased,publickey -o PasswordAuthentication=no -o 'User="ec2-user"' -o ConnectTimeout=10 -o 'ControlPath="/home/ec2-user/.ansible/cp/f291336e89"' 10.0.1.171 '/bin/sh -c '"'"'chmod u+x /home/ec2-user/.ansible/tmp/ansible-tmp-1721489331.5064702-327650-163739741050998/ /home/ec2-user/.ansible/tmp/ansible-tmp-1721489331.5064702-327650-163739741050998/AnsiballZ_command.py && sleep 0'"'"''
<10.0.1.171> (0, b'', b'')
<10.0.1.171> ESTABLISH SSH CONNECTION FOR USER: ec2-user
<10.0.1.171> SSH: EXEC ssh -C -o ControlMaster=auto -o ControlPersist=60s -o KbdInteractiveAuthentication=no -o PreferredAuthentications=gssapi-with-mic,gssapi-keyex,hostbased,publickey -o PasswordAuthentication=no -o 'User="ec2-user"' -o ConnectTimeout=10 -o 'ControlPath="/home/ec2-user/.ansible/cp/f291336e89"' -tt 10.0.1.171 '/bin/sh -c '"'"'sudo -H -S -n  -u root /bin/sh -c '"'"'"'"'"'"'"'"'echo BECOME-SUCCESS-erusocgohueozbxhjeaxwyakscjdbmvz ; KUBECONFIG=/etc/kubernetes/admin.conf /usr/bin/python3.9 /home/ec2-user/.ansible/tmp/ansible-tmp-1721489331.5064702-327650-163739741050998/AnsiballZ_command.py'"'"'"'"'"'"'"'"' && sleep 0'"'"''
Escalation succeeded
<10.0.1.171> (1, b'\r\n{"changed": true, "stdout": "", "stderr": "Error from server (NotFound): clusterrolebindings.rbac.authorization.k8s.io \\"jenkins\\" not found", "rc": 1, "cmd": ["kubectl", "delete", "clusterrolebinding", "jenkins"], "start": "2024-07-20 15:28:52.137970", "end": "2024-07-20 15:28:52.240099", "delta": "0:00:00.102129", "failed": true, "msg": "non-zero return code", "invocation": {"module_args": {"_raw_params": "kubectl delete clusterrolebinding jenkins", "_uses_shell": false, "stdin_add_newline": true, "strip_empty_ends": true, "argv": null, "chdir": null, "executable": null, "creates": null, "removes": null, "stdin": null}}}\r\n', b'Shared connection to 10.0.1.171 closed.\r\n')
<10.0.1.171> Failed to connect to the host via ssh: Shared connection to 10.0.1.171 closed.
<10.0.1.171> ESTABLISH SSH CONNECTION FOR USER: ec2-user
<10.0.1.171> SSH: EXEC ssh -C -o ControlMaster=auto -o ControlPersist=60s -o KbdInteractiveAuthentication=no -o PreferredAuthentications=gssapi-with-mic,gssapi-keyex,hostbased,publickey -o PasswordAuthentication=no -o 'User="ec2-user"' -o ConnectTimeout=10 -o 'ControlPath="/home/ec2-user/.ansible/cp/f291336e89"' 10.0.1.171 '/bin/sh -c '"'"'rm -f -r /home/ec2-user/.ansible/tmp/ansible-tmp-1721489331.5064702-327650-163739741050998/ > /dev/null 2>&1 && sleep 0'"'"''
<10.0.1.171> (0, b'', b'')
fatal: [master]: FAILED! => {
    "changed": true,
    "cmd": [
        "kubectl",
        "delete",
        "clusterrolebinding",
        "jenkins"
    ],
    "delta": "0:00:00.102129",
    "end": "2024-07-20 15:28:52.240099",
    "invocation": {
        "module_args": {
            "_raw_params": "kubectl delete clusterrolebinding jenkins",
            "_uses_shell": false,
            "argv": null,
            "chdir": null,
            "creates": null,
            "executable": null,
            "removes": null,
            "stdin": null,
            "stdin_add_newline": true,
            "strip_empty_ends": true
        }
    },
    "msg": "non-zero return code",
    "rc": 1,
    "start": "2024-07-20 15:28:52.137970",
    "stderr": "Error from server (NotFound): clusterrolebindings.rbac.authorization.k8s.io \"jenkins\" not found",
    "stderr_lines": [
        "Error from server (NotFound): clusterrolebindings.rbac.authorization.k8s.io \"jenkins\" not found"
    ],
    "stdout": "",
    "stdout_lines": []
}
...ignoring

TASK [Remove existing Jenkins secret] ******************************************
task path: /home/ec2-user/devops_setup/ansible/playbooks/kubernetes/setup_kubectl_auth.yaml:34
<10.0.1.171> ESTABLISH SSH CONNECTION FOR USER: ec2-user
<10.0.1.171> SSH: EXEC ssh -C -o ControlMaster=auto -o ControlPersist=60s -o KbdInteractiveAuthentication=no -o PreferredAuthentications=gssapi-with-mic,gssapi-keyex,hostbased,publickey -o PasswordAuthentication=no -o 'User="ec2-user"' -o ConnectTimeout=10 -o 'ControlPath="/home/ec2-user/.ansible/cp/f291336e89"' 10.0.1.171 '/bin/sh -c '"'"'echo ~ec2-user && sleep 0'"'"''
<10.0.1.171> (0, b'/home/ec2-user\n', b'')
<10.0.1.171> ESTABLISH SSH CONNECTION FOR USER: ec2-user
<10.0.1.171> SSH: EXEC ssh -C -o ControlMaster=auto -o ControlPersist=60s -o KbdInteractiveAuthentication=no -o PreferredAuthentications=gssapi-with-mic,gssapi-keyex,hostbased,publickey -o PasswordAuthentication=no -o 'User="ec2-user"' -o ConnectTimeout=10 -o 'ControlPath="/home/ec2-user/.ansible/cp/f291336e89"' 10.0.1.171 '/bin/sh -c '"'"'( umask 77 && mkdir -p "` echo /home/ec2-user/.ansible/tmp `"&& mkdir "` echo /home/ec2-user/.ansible/tmp/ansible-tmp-1721489332.422567-327659-56457422461139 `" && echo ansible-tmp-1721489332.422567-327659-56457422461139="` echo /home/ec2-user/.ansible/tmp/ansible-tmp-1721489332.422567-327659-56457422461139 `" ) && sleep 0'"'"''
<10.0.1.171> (0, b'ansible-tmp-1721489332.422567-327659-56457422461139=/home/ec2-user/.ansible/tmp/ansible-tmp-1721489332.422567-327659-56457422461139\n', b'')
Using module file /usr/lib/python3.9/site-packages/ansible/modules/command.py
<10.0.1.171> PUT /home/ec2-user/.ansible/tmp/ansible-local-327570hxfw9f7r/tmpe4segu6e TO /home/ec2-user/.ansible/tmp/ansible-tmp-1721489332.422567-327659-56457422461139/AnsiballZ_command.py
<10.0.1.171> SSH: EXEC sftp -b - -C -o ControlMaster=auto -o ControlPersist=60s -o KbdInteractiveAuthentication=no -o PreferredAuthentications=gssapi-with-mic,gssapi-keyex,hostbased,publickey -o PasswordAuthentication=no -o 'User="ec2-user"' -o ConnectTimeout=10 -o 'ControlPath="/home/ec2-user/.ansible/cp/f291336e89"' '[10.0.1.171]'
<10.0.1.171> (0, b'sftp> put /home/ec2-user/.ansible/tmp/ansible-local-327570hxfw9f7r/tmpe4segu6e /home/ec2-user/.ansible/tmp/ansible-tmp-1721489332.422567-327659-56457422461139/AnsiballZ_command.py\n', b'')
<10.0.1.171> ESTABLISH SSH CONNECTION FOR USER: ec2-user
<10.0.1.171> SSH: EXEC ssh -C -o ControlMaster=auto -o ControlPersist=60s -o KbdInteractiveAuthentication=no -o PreferredAuthentications=gssapi-with-mic,gssapi-keyex,hostbased,publickey -o PasswordAuthentication=no -o 'User="ec2-user"' -o ConnectTimeout=10 -o 'ControlPath="/home/ec2-user/.ansible/cp/f291336e89"' 10.0.1.171 '/bin/sh -c '"'"'chmod u+x /home/ec2-user/.ansible/tmp/ansible-tmp-1721489332.422567-327659-56457422461139/ /home/ec2-user/.ansible/tmp/ansible-tmp-1721489332.422567-327659-56457422461139/AnsiballZ_command.py && sleep 0'"'"''
<10.0.1.171> (0, b'', b'')
<10.0.1.171> ESTABLISH SSH CONNECTION FOR USER: ec2-user
<10.0.1.171> SSH: EXEC ssh -C -o ControlMaster=auto -o ControlPersist=60s -o KbdInteractiveAuthentication=no -o PreferredAuthentications=gssapi-with-mic,gssapi-keyex,hostbased,publickey -o PasswordAuthentication=no -o 'User="ec2-user"' -o ConnectTimeout=10 -o 'ControlPath="/home/ec2-user/.ansible/cp/f291336e89"' -tt 10.0.1.171 '/bin/sh -c '"'"'sudo -H -S -n  -u root /bin/sh -c '"'"'"'"'"'"'"'"'echo BECOME-SUCCESS-unxmatsxbpjagrhdscuoqdqjucfurstz ; KUBECONFIG=/etc/kubernetes/admin.conf /usr/bin/python3.9 /home/ec2-user/.ansible/tmp/ansible-tmp-1721489332.422567-327659-56457422461139/AnsiballZ_command.py'"'"'"'"'"'"'"'"' && sleep 0'"'"''
Escalation succeeded
<10.0.1.171> (1, b'\r\n{"changed": true, "stdout": "", "stderr": "Error from server (NotFound): secrets \\"jenkins-secret\\" not found", "rc": 1, "cmd": ["kubectl", "delete", "secret", "jenkins-secret", "-n", "default"], "start": "2024-07-20 15:28:52.864040", "end": "2024-07-20 15:28:52.947818", "delta": "0:00:00.083778", "failed": true, "msg": "non-zero return code", "invocation": {"module_args": {"_raw_params": "kubectl delete secret jenkins-secret -n default", "_uses_shell": false, "stdin_add_newline": true, "strip_empty_ends": true, "argv": null, "chdir": null, "executable": null, "creates": null, "removes": null, "stdin": null}}}\r\n', b'Shared connection to 10.0.1.171 closed.\r\n')
<10.0.1.171> Failed to connect to the host via ssh: Shared connection to 10.0.1.171 closed.
<10.0.1.171> ESTABLISH SSH CONNECTION FOR USER: ec2-user
<10.0.1.171> SSH: EXEC ssh -C -o ControlMaster=auto -o ControlPersist=60s -o KbdInteractiveAuthentication=no -o PreferredAuthentications=gssapi-with-mic,gssapi-keyex,hostbased,publickey -o PasswordAuthentication=no -o 'User="ec2-user"' -o ConnectTimeout=10 -o 'ControlPath="/home/ec2-user/.ansible/cp/f291336e89"' 10.0.1.171 '/bin/sh -c '"'"'rm -f -r /home/ec2-user/.ansible/tmp/ansible-tmp-1721489332.422567-327659-56457422461139/ > /dev/null 2>&1 && sleep 0'"'"''
<10.0.1.171> (0, b'', b'')
fatal: [master]: FAILED! => {
    "changed": true,
    "cmd": [
        "kubectl",
        "delete",
        "secret",
        "jenkins-secret",
        "-n",
        "default"
    ],
    "delta": "0:00:00.083778",
    "end": "2024-07-20 15:28:52.947818",
    "invocation": {
        "module_args": {
            "_raw_params": "kubectl delete secret jenkins-secret -n default",
            "_uses_shell": false,
            "argv": null,
            "chdir": null,
            "creates": null,
            "executable": null,
            "removes": null,
            "stdin": null,
            "stdin_add_newline": true,
            "strip_empty_ends": true
        }
    },
    "msg": "non-zero return code",
    "rc": 1,
    "start": "2024-07-20 15:28:52.864040",
    "stderr": "Error from server (NotFound): secrets \"jenkins-secret\" not found",
    "stderr_lines": [
        "Error from server (NotFound): secrets \"jenkins-secret\" not found"
    ],
    "stdout": "",
    "stdout_lines": []
}
...ignoring

TASK [Remove existing kubeconfig file for Jenkins] *****************************
task path: /home/ec2-user/devops_setup/ansible/playbooks/kubernetes/setup_kubectl_auth.yaml:40
<10.0.1.171> ESTABLISH SSH CONNECTION FOR USER: ec2-user
<10.0.1.171> SSH: EXEC ssh -C -o ControlMaster=auto -o ControlPersist=60s -o KbdInteractiveAuthentication=no -o PreferredAuthentications=gssapi-with-mic,gssapi-keyex,hostbased,publickey -o PasswordAuthentication=no -o 'User="ec2-user"' -o ConnectTimeout=10 -o 'ControlPath="/home/ec2-user/.ansible/cp/f291336e89"' 10.0.1.171 '/bin/sh -c '"'"'echo ~ec2-user && sleep 0'"'"''
<10.0.1.171> (0, b'/home/ec2-user\n', b'')
<10.0.1.171> ESTABLISH SSH CONNECTION FOR USER: ec2-user
<10.0.1.171> SSH: EXEC ssh -C -o ControlMaster=auto -o ControlPersist=60s -o KbdInteractiveAuthentication=no -o PreferredAuthentications=gssapi-with-mic,gssapi-keyex,hostbased,publickey -o PasswordAuthentication=no -o 'User="ec2-user"' -o ConnectTimeout=10 -o 'ControlPath="/home/ec2-user/.ansible/cp/f291336e89"' 10.0.1.171 '/bin/sh -c '"'"'( umask 77 && mkdir -p "` echo /home/ec2-user/.ansible/tmp `"&& mkdir "` echo /home/ec2-user/.ansible/tmp/ansible-tmp-1721489333.1048057-327674-93590797322400 `" && echo ansible-tmp-1721489333.1048057-327674-93590797322400="` echo /home/ec2-user/.ansible/tmp/ansible-tmp-1721489333.1048057-327674-93590797322400 `" ) && sleep 0'"'"''
<10.0.1.171> (0, b'ansible-tmp-1721489333.1048057-327674-93590797322400=/home/ec2-user/.ansible/tmp/ansible-tmp-1721489333.1048057-327674-93590797322400\n', b'')
Using module file /usr/lib/python3.9/site-packages/ansible/modules/file.py
<10.0.1.171> PUT /home/ec2-user/.ansible/tmp/ansible-local-327570hxfw9f7r/tmp8c41y1is TO /home/ec2-user/.ansible/tmp/ansible-tmp-1721489333.1048057-327674-93590797322400/AnsiballZ_file.py
<10.0.1.171> SSH: EXEC sftp -b - -C -o ControlMaster=auto -o ControlPersist=60s -o KbdInteractiveAuthentication=no -o PreferredAuthentications=gssapi-with-mic,gssapi-keyex,hostbased,publickey -o PasswordAuthentication=no -o 'User="ec2-user"' -o ConnectTimeout=10 -o 'ControlPath="/home/ec2-user/.ansible/cp/f291336e89"' '[10.0.1.171]'
<10.0.1.171> (0, b'sftp> put /home/ec2-user/.ansible/tmp/ansible-local-327570hxfw9f7r/tmp8c41y1is /home/ec2-user/.ansible/tmp/ansible-tmp-1721489333.1048057-327674-93590797322400/AnsiballZ_file.py\n', b'')
<10.0.1.171> ESTABLISH SSH CONNECTION FOR USER: ec2-user
<10.0.1.171> SSH: EXEC ssh -C -o ControlMaster=auto -o ControlPersist=60s -o KbdInteractiveAuthentication=no -o PreferredAuthentications=gssapi-with-mic,gssapi-keyex,hostbased,publickey -o PasswordAuthentication=no -o 'User="ec2-user"' -o ConnectTimeout=10 -o 'ControlPath="/home/ec2-user/.ansible/cp/f291336e89"' 10.0.1.171 '/bin/sh -c '"'"'chmod u+x /home/ec2-user/.ansible/tmp/ansible-tmp-1721489333.1048057-327674-93590797322400/ /home/ec2-user/.ansible/tmp/ansible-tmp-1721489333.1048057-327674-93590797322400/AnsiballZ_file.py && sleep 0'"'"''
<10.0.1.171> (0, b'', b'')
<10.0.1.171> ESTABLISH SSH CONNECTION FOR USER: ec2-user
<10.0.1.171> SSH: EXEC ssh -C -o ControlMaster=auto -o ControlPersist=60s -o KbdInteractiveAuthentication=no -o PreferredAuthentications=gssapi-with-mic,gssapi-keyex,hostbased,publickey -o PasswordAuthentication=no -o 'User="ec2-user"' -o ConnectTimeout=10 -o 'ControlPath="/home/ec2-user/.ansible/cp/f291336e89"' -tt 10.0.1.171 '/bin/sh -c '"'"'sudo -H -S -n  -u root /bin/sh -c '"'"'"'"'"'"'"'"'echo BECOME-SUCCESS-pkdgrskqzfzrcemcajpuilawlkvjzusv ; /usr/bin/python3.9 /home/ec2-user/.ansible/tmp/ansible-tmp-1721489333.1048057-327674-93590797322400/AnsiballZ_file.py'"'"'"'"'"'"'"'"' && sleep 0'"'"''
Escalation succeeded
<10.0.1.171> (0, b'\r\n{"path": "/tmp/kubeconfig-jenkins.yaml", "changed": false, "state": "absent", "invocation": {"module_args": {"path": "/tmp/kubeconfig-jenkins.yaml", "state": "absent", "recurse": false, "force": false, "follow": true, "modification_time_format": "%Y%m%d%H%M.%S", "access_time_format": "%Y%m%d%H%M.%S", "unsafe_writes": false, "_original_basename": null, "_diff_peek": null, "src": null, "modification_time": null, "access_time": null, "mode": null, "owner": null, "group": null, "seuser": null, "serole": null, "selevel": null, "setype": null, "attributes": null}}}\r\n', b'Shared connection to 10.0.1.171 closed.\r\n')
<10.0.1.171> ESTABLISH SSH CONNECTION FOR USER: ec2-user
<10.0.1.171> SSH: EXEC ssh -C -o ControlMaster=auto -o ControlPersist=60s -o KbdInteractiveAuthentication=no -o PreferredAuthentications=gssapi-with-mic,gssapi-keyex,hostbased,publickey -o PasswordAuthentication=no -o 'User="ec2-user"' -o ConnectTimeout=10 -o 'ControlPath="/home/ec2-user/.ansible/cp/f291336e89"' 10.0.1.171 '/bin/sh -c '"'"'rm -f -r /home/ec2-user/.ansible/tmp/ansible-tmp-1721489333.1048057-327674-93590797322400/ > /dev/null 2>&1 && sleep 0'"'"''
<10.0.1.171> (0, b'', b'')
ok: [master] => {
    "changed": false,
    "invocation": {
        "module_args": {
            "_diff_peek": null,
            "_original_basename": null,
            "access_time": null,
            "access_time_format": "%Y%m%d%H%M.%S",
            "attributes": null,
            "follow": true,
            "force": false,
            "group": null,
            "mode": null,
            "modification_time": null,
            "modification_time_format": "%Y%m%d%H%M.%S",
            "owner": null,
            "path": "/tmp/kubeconfig-jenkins.yaml",
            "recurse": false,
            "selevel": null,
            "serole": null,
            "setype": null,
            "seuser": null,
            "src": null,
            "state": "absent",
            "unsafe_writes": false
        }
    },
    "path": "/tmp/kubeconfig-jenkins.yaml",
    "state": "absent"
}

TASK [Create service account for Jenkins] **************************************
task path: /home/ec2-user/devops_setup/ansible/playbooks/kubernetes/setup_kubectl_auth.yaml:45
<10.0.1.171> ESTABLISH SSH CONNECTION FOR USER: ec2-user
<10.0.1.171> SSH: EXEC ssh -C -o ControlMaster=auto -o ControlPersist=60s -o KbdInteractiveAuthentication=no -o PreferredAuthentications=gssapi-with-mic,gssapi-keyex,hostbased,publickey -o PasswordAuthentication=no -o 'User="ec2-user"' -o ConnectTimeout=10 -o 'ControlPath="/home/ec2-user/.ansible/cp/f291336e89"' 10.0.1.171 '/bin/sh -c '"'"'echo ~ec2-user && sleep 0'"'"''
<10.0.1.171> (0, b'/home/ec2-user\n', b'')
<10.0.1.171> ESTABLISH SSH CONNECTION FOR USER: ec2-user
<10.0.1.171> SSH: EXEC ssh -C -o ControlMaster=auto -o ControlPersist=60s -o KbdInteractiveAuthentication=no -o PreferredAuthentications=gssapi-with-mic,gssapi-keyex,hostbased,publickey -o PasswordAuthentication=no -o 'User="ec2-user"' -o ConnectTimeout=10 -o 'ControlPath="/home/ec2-user/.ansible/cp/f291336e89"' 10.0.1.171 '/bin/sh -c '"'"'( umask 77 && mkdir -p "` echo /home/ec2-user/.ansible/tmp `"&& mkdir "` echo /home/ec2-user/.ansible/tmp/ansible-tmp-1721489334.0519738-327699-62278415687043 `" && echo ansible-tmp-1721489334.0519738-327699-62278415687043="` echo /home/ec2-user/.ansible/tmp/ansible-tmp-1721489334.0519738-327699-62278415687043 `" ) && sleep 0'"'"''
<10.0.1.171> (0, b'ansible-tmp-1721489334.0519738-327699-62278415687043=/home/ec2-user/.ansible/tmp/ansible-tmp-1721489334.0519738-327699-62278415687043\n', b'')
Using module file /usr/lib/python3.9/site-packages/ansible/modules/command.py
<10.0.1.171> PUT /home/ec2-user/.ansible/tmp/ansible-local-327570hxfw9f7r/tmpwlmhms3r TO /home/ec2-user/.ansible/tmp/ansible-tmp-1721489334.0519738-327699-62278415687043/AnsiballZ_command.py
<10.0.1.171> SSH: EXEC sftp -b - -C -o ControlMaster=auto -o ControlPersist=60s -o KbdInteractiveAuthentication=no -o PreferredAuthentications=gssapi-with-mic,gssapi-keyex,hostbased,publickey -o PasswordAuthentication=no -o 'User="ec2-user"' -o ConnectTimeout=10 -o 'ControlPath="/home/ec2-user/.ansible/cp/f291336e89"' '[10.0.1.171]'
<10.0.1.171> (0, b'sftp> put /home/ec2-user/.ansible/tmp/ansible-local-327570hxfw9f7r/tmpwlmhms3r /home/ec2-user/.ansible/tmp/ansible-tmp-1721489334.0519738-327699-62278415687043/AnsiballZ_command.py\n', b'')
<10.0.1.171> ESTABLISH SSH CONNECTION FOR USER: ec2-user
<10.0.1.171> SSH: EXEC ssh -C -o ControlMaster=auto -o ControlPersist=60s -o KbdInteractiveAuthentication=no -o PreferredAuthentications=gssapi-with-mic,gssapi-keyex,hostbased,publickey -o PasswordAuthentication=no -o 'User="ec2-user"' -o ConnectTimeout=10 -o 'ControlPath="/home/ec2-user/.ansible/cp/f291336e89"' 10.0.1.171 '/bin/sh -c '"'"'chmod u+x /home/ec2-user/.ansible/tmp/ansible-tmp-1721489334.0519738-327699-62278415687043/ /home/ec2-user/.ansible/tmp/ansible-tmp-1721489334.0519738-327699-62278415687043/AnsiballZ_command.py && sleep 0'"'"''
<10.0.1.171> (0, b'', b'')
<10.0.1.171> ESTABLISH SSH CONNECTION FOR USER: ec2-user
<10.0.1.171> SSH: EXEC ssh -C -o ControlMaster=auto -o ControlPersist=60s -o KbdInteractiveAuthentication=no -o PreferredAuthentications=gssapi-with-mic,gssapi-keyex,hostbased,publickey -o PasswordAuthentication=no -o 'User="ec2-user"' -o ConnectTimeout=10 -o 'ControlPath="/home/ec2-user/.ansible/cp/f291336e89"' -tt 10.0.1.171 '/bin/sh -c '"'"'sudo -H -S -n  -u root /bin/sh -c '"'"'"'"'"'"'"'"'echo BECOME-SUCCESS-uqximssitcddajykblycwbvhqqqdresy ; KUBECONFIG=/etc/kubernetes/admin.conf /usr/bin/python3.9 /home/ec2-user/.ansible/tmp/ansible-tmp-1721489334.0519738-327699-62278415687043/AnsiballZ_command.py'"'"'"'"'"'"'"'"' && sleep 0'"'"''
Escalation succeeded
<10.0.1.171> (0, b'\r\n{"changed": true, "stdout": "serviceaccount/jenkins created", "stderr": "", "rc": 0, "cmd": ["kubectl", "create", "serviceaccount", "jenkins", "-n", "default"], "start": "2024-07-20 15:28:54.573838", "end": "2024-07-20 15:28:54.737363", "delta": "0:00:00.163525", "msg": "", "invocation": {"module_args": {"_raw_params": "kubectl create serviceaccount jenkins -n default", "_uses_shell": false, "stdin_add_newline": true, "strip_empty_ends": true, "argv": null, "chdir": null, "executable": null, "creates": null, "removes": null, "stdin": null}}}\r\n', b'Shared connection to 10.0.1.171 closed.\r\n')
<10.0.1.171> ESTABLISH SSH CONNECTION FOR USER: ec2-user
<10.0.1.171> SSH: EXEC ssh -C -o ControlMaster=auto -o ControlPersist=60s -o KbdInteractiveAuthentication=no -o PreferredAuthentications=gssapi-with-mic,gssapi-keyex,hostbased,publickey -o PasswordAuthentication=no -o 'User="ec2-user"' -o ConnectTimeout=10 -o 'ControlPath="/home/ec2-user/.ansible/cp/f291336e89"' 10.0.1.171 '/bin/sh -c '"'"'rm -f -r /home/ec2-user/.ansible/tmp/ansible-tmp-1721489334.0519738-327699-62278415687043/ > /dev/null 2>&1 && sleep 0'"'"''
<10.0.1.171> (0, b'', b'')
changed: [master] => {
    "changed": true,
    "cmd": [
        "kubectl",
        "create",
        "serviceaccount",
        "jenkins",
        "-n",
        "default"
    ],
    "delta": "0:00:00.163525",
    "end": "2024-07-20 15:28:54.737363",
    "invocation": {
        "module_args": {
            "_raw_params": "kubectl create serviceaccount jenkins -n default",
            "_uses_shell": false,
            "argv": null,
            "chdir": null,
            "creates": null,
            "executable": null,
            "removes": null,
            "stdin": null,
            "stdin_add_newline": true,
            "strip_empty_ends": true
        }
    },
    "msg": "",
    "rc": 0,
    "start": "2024-07-20 15:28:54.573838",
    "stderr": "",
    "stderr_lines": [],
    "stdout": "serviceaccount/jenkins created",
    "stdout_lines": [
        "serviceaccount/jenkins created"
    ]
}

TASK [Create cluster role binding for Jenkins] *********************************
task path: /home/ec2-user/devops_setup/ansible/playbooks/kubernetes/setup_kubectl_auth.yaml:50
<10.0.1.171> ESTABLISH SSH CONNECTION FOR USER: ec2-user
<10.0.1.171> SSH: EXEC ssh -C -o ControlMaster=auto -o ControlPersist=60s -o KbdInteractiveAuthentication=no -o PreferredAuthentications=gssapi-with-mic,gssapi-keyex,hostbased,publickey -o PasswordAuthentication=no -o 'User="ec2-user"' -o ConnectTimeout=10 -o 'ControlPath="/home/ec2-user/.ansible/cp/f291336e89"' 10.0.1.171 '/bin/sh -c '"'"'echo ~ec2-user && sleep 0'"'"''
<10.0.1.171> (0, b'/home/ec2-user\n', b'')
<10.0.1.171> ESTABLISH SSH CONNECTION FOR USER: ec2-user
<10.0.1.171> SSH: EXEC ssh -C -o ControlMaster=auto -o ControlPersist=60s -o KbdInteractiveAuthentication=no -o PreferredAuthentications=gssapi-with-mic,gssapi-keyex,hostbased,publickey -o PasswordAuthentication=no -o 'User="ec2-user"' -o ConnectTimeout=10 -o 'ControlPath="/home/ec2-user/.ansible/cp/f291336e89"' 10.0.1.171 '/bin/sh -c '"'"'( umask 77 && mkdir -p "` echo /home/ec2-user/.ansible/tmp `"&& mkdir "` echo /home/ec2-user/.ansible/tmp/ansible-tmp-1721489334.9262793-327724-267963355576374 `" && echo ansible-tmp-1721489334.9262793-327724-267963355576374="` echo /home/ec2-user/.ansible/tmp/ansible-tmp-1721489334.9262793-327724-267963355576374 `" ) && sleep 0'"'"''
<10.0.1.171> (0, b'ansible-tmp-1721489334.9262793-327724-267963355576374=/home/ec2-user/.ansible/tmp/ansible-tmp-1721489334.9262793-327724-267963355576374\n', b'')
Using module file /usr/lib/python3.9/site-packages/ansible/modules/command.py
<10.0.1.171> PUT /home/ec2-user/.ansible/tmp/ansible-local-327570hxfw9f7r/tmpx__qqizp TO /home/ec2-user/.ansible/tmp/ansible-tmp-1721489334.9262793-327724-267963355576374/AnsiballZ_command.py
<10.0.1.171> SSH: EXEC sftp -b - -C -o ControlMaster=auto -o ControlPersist=60s -o KbdInteractiveAuthentication=no -o PreferredAuthentications=gssapi-with-mic,gssapi-keyex,hostbased,publickey -o PasswordAuthentication=no -o 'User="ec2-user"' -o ConnectTimeout=10 -o 'ControlPath="/home/ec2-user/.ansible/cp/f291336e89"' '[10.0.1.171]'
<10.0.1.171> (0, b'sftp> put /home/ec2-user/.ansible/tmp/ansible-local-327570hxfw9f7r/tmpx__qqizp /home/ec2-user/.ansible/tmp/ansible-tmp-1721489334.9262793-327724-267963355576374/AnsiballZ_command.py\n', b'')
<10.0.1.171> ESTABLISH SSH CONNECTION FOR USER: ec2-user
<10.0.1.171> SSH: EXEC ssh -C -o ControlMaster=auto -o ControlPersist=60s -o KbdInteractiveAuthentication=no -o PreferredAuthentications=gssapi-with-mic,gssapi-keyex,hostbased,publickey -o PasswordAuthentication=no -o 'User="ec2-user"' -o ConnectTimeout=10 -o 'ControlPath="/home/ec2-user/.ansible/cp/f291336e89"' 10.0.1.171 '/bin/sh -c '"'"'chmod u+x /home/ec2-user/.ansible/tmp/ansible-tmp-1721489334.9262793-327724-267963355576374/ /home/ec2-user/.ansible/tmp/ansible-tmp-1721489334.9262793-327724-267963355576374/AnsiballZ_command.py && sleep 0'"'"''
<10.0.1.171> (0, b'', b'')
<10.0.1.171> ESTABLISH SSH CONNECTION FOR USER: ec2-user
<10.0.1.171> SSH: EXEC ssh -C -o ControlMaster=auto -o ControlPersist=60s -o KbdInteractiveAuthentication=no -o PreferredAuthentications=gssapi-with-mic,gssapi-keyex,hostbased,publickey -o PasswordAuthentication=no -o 'User="ec2-user"' -o ConnectTimeout=10 -o 'ControlPath="/home/ec2-user/.ansible/cp/f291336e89"' -tt 10.0.1.171 '/bin/sh -c '"'"'sudo -H -S -n  -u root /bin/sh -c '"'"'"'"'"'"'"'"'echo BECOME-SUCCESS-xmyhwvyfutsevkhuynxwgoyfogradnmt ; KUBECONFIG=/etc/kubernetes/admin.conf /usr/bin/python3.9 /home/ec2-user/.ansible/tmp/ansible-tmp-1721489334.9262793-327724-267963355576374/AnsiballZ_command.py'"'"'"'"'"'"'"'"' && sleep 0'"'"''
Escalation succeeded
<10.0.1.171> (0, b'\r\n{"changed": true, "stdout": "clusterrolebinding.rbac.authorization.k8s.io/jenkins created", "stderr": "", "rc": 0, "cmd": ["kubectl", "create", "clusterrolebinding", "jenkins", "--clusterrole=cluster-admin", "--serviceaccount=default:jenkins"], "start": "2024-07-20 15:28:55.499626", "end": "2024-07-20 15:28:55.662165", "delta": "0:00:00.162539", "msg": "", "invocation": {"module_args": {"_raw_params": "kubectl create clusterrolebinding jenkins --clusterrole=cluster-admin --serviceaccount=default:jenkins", "_uses_shell": false, "stdin_add_newline": true, "strip_empty_ends": true, "argv": null, "chdir": null, "executable": null, "creates": null, "removes": null, "stdin": null}}}\r\n', b'Shared connection to 10.0.1.171 closed.\r\n')
<10.0.1.171> ESTABLISH SSH CONNECTION FOR USER: ec2-user
<10.0.1.171> SSH: EXEC ssh -C -o ControlMaster=auto -o ControlPersist=60s -o KbdInteractiveAuthentication=no -o PreferredAuthentications=gssapi-with-mic,gssapi-keyex,hostbased,publickey -o PasswordAuthentication=no -o 'User="ec2-user"' -o ConnectTimeout=10 -o 'ControlPath="/home/ec2-user/.ansible/cp/f291336e89"' 10.0.1.171 '/bin/sh -c '"'"'rm -f -r /home/ec2-user/.ansible/tmp/ansible-tmp-1721489334.9262793-327724-267963355576374/ > /dev/null 2>&1 && sleep 0'"'"''
<10.0.1.171> (0, b'', b'')
changed: [master] => {
    "changed": true,
    "cmd": [
        "kubectl",
        "create",
        "clusterrolebinding",
        "jenkins",
        "--clusterrole=cluster-admin",
        "--serviceaccount=default:jenkins"
    ],
    "delta": "0:00:00.162539",
    "end": "2024-07-20 15:28:55.662165",
    "invocation": {
        "module_args": {
            "_raw_params": "kubectl create clusterrolebinding jenkins --clusterrole=cluster-admin --serviceaccount=default:jenkins",
            "_uses_shell": false,
            "argv": null,
            "chdir": null,
            "creates": null,
            "executable": null,
            "removes": null,
            "stdin": null,
            "stdin_add_newline": true,
            "strip_empty_ends": true
        }
    },
    "msg": "",
    "rc": 0,
    "start": "2024-07-20 15:28:55.499626",
    "stderr": "",
    "stderr_lines": [],
    "stdout": "clusterrolebinding.rbac.authorization.k8s.io/jenkins created",
    "stdout_lines": [
        "clusterrolebinding.rbac.authorization.k8s.io/jenkins created"
    ]
}

TASK [Get Jenkins token] *******************************************************
task path: /home/ec2-user/devops_setup/ansible/playbooks/kubernetes/setup_kubectl_auth.yaml:55
<10.0.1.171> ESTABLISH SSH CONNECTION FOR USER: ec2-user
<10.0.1.171> SSH: EXEC ssh -C -o ControlMaster=auto -o ControlPersist=60s -o KbdInteractiveAuthentication=no -o PreferredAuthentications=gssapi-with-mic,gssapi-keyex,hostbased,publickey -o PasswordAuthentication=no -o 'User="ec2-user"' -o ConnectTimeout=10 -o 'ControlPath="/home/ec2-user/.ansible/cp/f291336e89"' 10.0.1.171 '/bin/sh -c '"'"'echo ~ec2-user && sleep 0'"'"''
<10.0.1.171> (0, b'/home/ec2-user\n', b'')
<10.0.1.171> ESTABLISH SSH CONNECTION FOR USER: ec2-user
<10.0.1.171> SSH: EXEC ssh -C -o ControlMaster=auto -o ControlPersist=60s -o KbdInteractiveAuthentication=no -o PreferredAuthentications=gssapi-with-mic,gssapi-keyex,hostbased,publickey -o PasswordAuthentication=no -o 'User="ec2-user"' -o ConnectTimeout=10 -o 'ControlPath="/home/ec2-user/.ansible/cp/f291336e89"' 10.0.1.171 '/bin/sh -c '"'"'( umask 77 && mkdir -p "` echo /home/ec2-user/.ansible/tmp `"&& mkdir "` echo /home/ec2-user/.ansible/tmp/ansible-tmp-1721489335.883503-327739-30100149855996 `" && echo ansible-tmp-1721489335.883503-327739-30100149855996="` echo /home/ec2-user/.ansible/tmp/ansible-tmp-1721489335.883503-327739-30100149855996 `" ) && sleep 0'"'"''
<10.0.1.171> (0, b'ansible-tmp-1721489335.883503-327739-30100149855996=/home/ec2-user/.ansible/tmp/ansible-tmp-1721489335.883503-327739-30100149855996\n', b'')
Using module file /usr/lib/python3.9/site-packages/ansible/modules/command.py
<10.0.1.171> PUT /home/ec2-user/.ansible/tmp/ansible-local-327570hxfw9f7r/tmpkk4erbes TO /home/ec2-user/.ansible/tmp/ansible-tmp-1721489335.883503-327739-30100149855996/AnsiballZ_command.py
<10.0.1.171> SSH: EXEC sftp -b - -C -o ControlMaster=auto -o ControlPersist=60s -o KbdInteractiveAuthentication=no -o PreferredAuthentications=gssapi-with-mic,gssapi-keyex,hostbased,publickey -o PasswordAuthentication=no -o 'User="ec2-user"' -o ConnectTimeout=10 -o 'ControlPath="/home/ec2-user/.ansible/cp/f291336e89"' '[10.0.1.171]'
<10.0.1.171> (0, b'sftp> put /home/ec2-user/.ansible/tmp/ansible-local-327570hxfw9f7r/tmpkk4erbes /home/ec2-user/.ansible/tmp/ansible-tmp-1721489335.883503-327739-30100149855996/AnsiballZ_command.py\n', b'')
<10.0.1.171> ESTABLISH SSH CONNECTION FOR USER: ec2-user
<10.0.1.171> SSH: EXEC ssh -C -o ControlMaster=auto -o ControlPersist=60s -o KbdInteractiveAuthentication=no -o PreferredAuthentications=gssapi-with-mic,gssapi-keyex,hostbased,publickey -o PasswordAuthentication=no -o 'User="ec2-user"' -o ConnectTimeout=10 -o 'ControlPath="/home/ec2-user/.ansible/cp/f291336e89"' 10.0.1.171 '/bin/sh -c '"'"'chmod u+x /home/ec2-user/.ansible/tmp/ansible-tmp-1721489335.883503-327739-30100149855996/ /home/ec2-user/.ansible/tmp/ansible-tmp-1721489335.883503-327739-30100149855996/AnsiballZ_command.py && sleep 0'"'"''
<10.0.1.171> (0, b'', b'')
<10.0.1.171> ESTABLISH SSH CONNECTION FOR USER: ec2-user
<10.0.1.171> SSH: EXEC ssh -C -o ControlMaster=auto -o ControlPersist=60s -o KbdInteractiveAuthentication=no -o PreferredAuthentications=gssapi-with-mic,gssapi-keyex,hostbased,publickey -o PasswordAuthentication=no -o 'User="ec2-user"' -o ConnectTimeout=10 -o 'ControlPath="/home/ec2-user/.ansible/cp/f291336e89"' -tt 10.0.1.171 '/bin/sh -c '"'"'sudo -H -S -n  -u root /bin/sh -c '"'"'"'"'"'"'"'"'echo BECOME-SUCCESS-laojdfjflwhljngruluxqgtoazmadpax ; KUBECONFIG=/etc/kubernetes/admin.conf /usr/bin/python3.9 /home/ec2-user/.ansible/tmp/ansible-tmp-1721489335.883503-327739-30100149855996/AnsiballZ_command.py'"'"'"'"'"'"'"'"' && sleep 0'"'"''
Escalation succeeded
<10.0.1.171> (0, b'\r\n{"changed": true, "stdout": "eyJhbGciOiJSUzI1NiIsImtpZCI6Ii1MQTJuMU9KcFJTbEJkcDE1ZVFUamNiSEMyY0VwNzIxd1N4cFFuX2NiTDgifQ.eyJhdWQiOlsiaHR0cHM6Ly9rdWJlcm5ldGVzLmRlZmF1bHQuc3ZjLmNsdXN0ZXIubG9jYWwiXSwiZXhwIjoxNzIxNTc1NzM2LCJpYXQiOjE3MjE0ODkzMzYsImlzcyI6Imh0dHBzOi8va3ViZXJuZXRlcy5kZWZhdWx0LnN2Yy5jbHVzdGVyLmxvY2FsIiwianRpIjoiMGE2M2I5MmMtNGVhYy00NWUxLThkYTEtNDFkY2Y3NDczMGMxIiwia3ViZXJuZXRlcy5pbyI6eyJuYW1lc3BhY2UiOiJkZWZhdWx0Iiwic2VydmljZWFjY291bnQiOnsibmFtZSI6ImplbmtpbnMiLCJ1aWQiOiIxNzkxMDY4NC1jOTkzLTRiYzctYjU1Mi04NTY2YTI4OWMwYWUifX0sIm5iZiI6MTcyMTQ4OTMzNiwic3ViIjoic3lzdGVtOnNlcnZpY2VhY2NvdW50OmRlZmF1bHQ6amVua2lucyJ9.Y-ZwzxSTx3xKLPrJWEO18InqwmCqeVP8Kfc1p_jQusOwq1-y80SCrsI5QuiciqD656x2kTeN_YmAsbuzajUJ2Mx6E-AMtiH09uiYOeHN236FOZDjBmJG7hh_vk5LIGYwc3z5xWEeJozjEPT4-YNOlfcapLHKO6UakvdzkaggXExxtCRilFVU8ZcnM7WuYoKNUnxx-sUJ092RgyW70gKVsddCQPpkvStjpdQdWZnvGAUU62zzHOATx5jv7x842lrb2CT263KXquGUqugAULOrDTzySo7XuKL-IUbbI_nhrKjjMcOb-BfCRB9DWaTl3Jx_PapFz9B9C3iXO8rl17183A", "stderr": "", "rc": 0, "cmd": ["kubectl", "create", "token", "jenkins", "-n", "default", "--duration=24h"], "start": "2024-07-20 15:28:56.564494", "end": "2024-07-20 15:28:56.693897", "delta": "0:00:00.129403", "msg": "", "invocation": {"module_args": {"_raw_params": "kubectl create token jenkins -n default --duration=24h", "_uses_shell": false, "stdin_add_newline": true, "strip_empty_ends": true, "argv": null, "chdir": null, "executable": null, "creates": null, "removes": null, "stdin": null}}}\r\n', b'Shared connection to 10.0.1.171 closed.\r\n')
<10.0.1.171> ESTABLISH SSH CONNECTION FOR USER: ec2-user
<10.0.1.171> SSH: EXEC ssh -C -o ControlMaster=auto -o ControlPersist=60s -o KbdInteractiveAuthentication=no -o PreferredAuthentications=gssapi-with-mic,gssapi-keyex,hostbased,publickey -o PasswordAuthentication=no -o 'User="ec2-user"' -o ConnectTimeout=10 -o 'ControlPath="/home/ec2-user/.ansible/cp/f291336e89"' 10.0.1.171 '/bin/sh -c '"'"'rm -f -r /home/ec2-user/.ansible/tmp/ansible-tmp-1721489335.883503-327739-30100149855996/ > /dev/null 2>&1 && sleep 0'"'"''
<10.0.1.171> (0, b'', b'')
changed: [master] => {
    "changed": true,
    "cmd": [
        "kubectl",
        "create",
        "token",
        "jenkins",
        "-n",
        "default",
        "--duration=24h"
    ],
    "delta": "0:00:00.129403",
    "end": "2024-07-20 15:28:56.693897",
    "invocation": {
        "module_args": {
            "_raw_params": "kubectl create token jenkins -n default --duration=24h",
            "_uses_shell": false,
            "argv": null,
            "chdir": null,
            "creates": null,
            "executable": null,
            "removes": null,
            "stdin": null,
            "stdin_add_newline": true,
            "strip_empty_ends": true
        }
    },
    "msg": "",
    "rc": 0,
    "start": "2024-07-20 15:28:56.564494",
    "stderr": "",
    "stderr_lines": [],
    "stdout": "eyJhbGciOiJSUzI1NiIsImtpZCI6Ii1MQTJuMU9KcFJTbEJkcDE1ZVFUamNiSEMyY0VwNzIxd1N4cFFuX2NiTDgifQ.eyJhdWQiOlsiaHR0cHM6Ly9rdWJlcm5ldGVzLmRlZmF1bHQuc3ZjLmNsdXN0ZXIubG9jYWwiXSwiZXhwIjoxNzIxNTc1NzM2LCJpYXQiOjE3MjE0ODkzMzYsImlzcyI6Imh0dHBzOi8va3ViZXJuZXRlcy5kZWZhdWx0LnN2Yy5jbHVzdGVyLmxvY2FsIiwianRpIjoiMGE2M2I5MmMtNGVhYy00NWUxLThkYTEtNDFkY2Y3NDczMGMxIiwia3ViZXJuZXRlcy5pbyI6eyJuYW1lc3BhY2UiOiJkZWZhdWx0Iiwic2VydmljZWFjY291bnQiOnsibmFtZSI6ImplbmtpbnMiLCJ1aWQiOiIxNzkxMDY4NC1jOTkzLTRiYzctYjU1Mi04NTY2YTI4OWMwYWUifX0sIm5iZiI6MTcyMTQ4OTMzNiwic3ViIjoic3lzdGVtOnNlcnZpY2VhY2NvdW50OmRlZmF1bHQ6amVua2lucyJ9.Y-ZwzxSTx3xKLPrJWEO18InqwmCqeVP8Kfc1p_jQusOwq1-y80SCrsI5QuiciqD656x2kTeN_YmAsbuzajUJ2Mx6E-AMtiH09uiYOeHN236FOZDjBmJG7hh_vk5LIGYwc3z5xWEeJozjEPT4-YNOlfcapLHKO6UakvdzkaggXExxtCRilFVU8ZcnM7WuYoKNUnxx-sUJ092RgyW70gKVsddCQPpkvStjpdQdWZnvGAUU62zzHOATx5jv7x842lrb2CT263KXquGUqugAULOrDTzySo7XuKL-IUbbI_nhrKjjMcOb-BfCRB9DWaTl3Jx_PapFz9B9C3iXO8rl17183A",
    "stdout_lines": [
        "eyJhbGciOiJSUzI1NiIsImtpZCI6Ii1MQTJuMU9KcFJTbEJkcDE1ZVFUamNiSEMyY0VwNzIxd1N4cFFuX2NiTDgifQ.eyJhdWQiOlsiaHR0cHM6Ly9rdWJlcm5ldGVzLmRlZmF1bHQuc3ZjLmNsdXN0ZXIubG9jYWwiXSwiZXhwIjoxNzIxNTc1NzM2LCJpYXQiOjE3MjE0ODkzMzYsImlzcyI6Imh0dHBzOi8va3ViZXJuZXRlcy5kZWZhdWx0LnN2Yy5jbHVzdGVyLmxvY2FsIiwianRpIjoiMGE2M2I5MmMtNGVhYy00NWUxLThkYTEtNDFkY2Y3NDczMGMxIiwia3ViZXJuZXRlcy5pbyI6eyJuYW1lc3BhY2UiOiJkZWZhdWx0Iiwic2VydmljZWFjY291bnQiOnsibmFtZSI6ImplbmtpbnMiLCJ1aWQiOiIxNzkxMDY4NC1jOTkzLTRiYzctYjU1Mi04NTY2YTI4OWMwYWUifX0sIm5iZiI6MTcyMTQ4OTMzNiwic3ViIjoic3lzdGVtOnNlcnZpY2VhY2NvdW50OmRlZmF1bHQ6amVua2lucyJ9.Y-ZwzxSTx3xKLPrJWEO18InqwmCqeVP8Kfc1p_jQusOwq1-y80SCrsI5QuiciqD656x2kTeN_YmAsbuzajUJ2Mx6E-AMtiH09uiYOeHN236FOZDjBmJG7hh_vk5LIGYwc3z5xWEeJozjEPT4-YNOlfcapLHKO6UakvdzkaggXExxtCRilFVU8ZcnM7WuYoKNUnxx-sUJ092RgyW70gKVsddCQPpkvStjpdQdWZnvGAUU62zzHOATx5jv7x842lrb2CT263KXquGUqugAULOrDTzySo7XuKL-IUbbI_nhrKjjMcOb-BfCRB9DWaTl3Jx_PapFz9B9C3iXO8rl17183A"
    ]
}

TASK [Create secret for Jenkins token] *****************************************
task path: /home/ec2-user/devops_setup/ansible/playbooks/kubernetes/setup_kubectl_auth.yaml:61
<10.0.1.171> ESTABLISH SSH CONNECTION FOR USER: ec2-user
<10.0.1.171> SSH: EXEC ssh -C -o ControlMaster=auto -o ControlPersist=60s -o KbdInteractiveAuthentication=no -o PreferredAuthentications=gssapi-with-mic,gssapi-keyex,hostbased,publickey -o PasswordAuthentication=no -o 'User="ec2-user"' -o ConnectTimeout=10 -o 'ControlPath="/home/ec2-user/.ansible/cp/f291336e89"' 10.0.1.171 '/bin/sh -c '"'"'echo ~ec2-user && sleep 0'"'"''
<10.0.1.171> (0, b'/home/ec2-user\n', b'')
<10.0.1.171> ESTABLISH SSH CONNECTION FOR USER: ec2-user
<10.0.1.171> SSH: EXEC ssh -C -o ControlMaster=auto -o ControlPersist=60s -o KbdInteractiveAuthentication=no -o PreferredAuthentications=gssapi-with-mic,gssapi-keyex,hostbased,publickey -o PasswordAuthentication=no -o 'User="ec2-user"' -o ConnectTimeout=10 -o 'ControlPath="/home/ec2-user/.ansible/cp/f291336e89"' 10.0.1.171 '/bin/sh -c '"'"'( umask 77 && mkdir -p "` echo /home/ec2-user/.ansible/tmp `"&& mkdir "` echo /home/ec2-user/.ansible/tmp/ansible-tmp-1721489336.9628546-327748-93351034977514 `" && echo ansible-tmp-1721489336.9628546-327748-93351034977514="` echo /home/ec2-user/.ansible/tmp/ansible-tmp-1721489336.9628546-327748-93351034977514 `" ) && sleep 0'"'"''
<10.0.1.171> (0, b'ansible-tmp-1721489336.9628546-327748-93351034977514=/home/ec2-user/.ansible/tmp/ansible-tmp-1721489336.9628546-327748-93351034977514\n', b'')
Using module file /usr/lib/python3.9/site-packages/ansible/modules/command.py
<10.0.1.171> PUT /home/ec2-user/.ansible/tmp/ansible-local-327570hxfw9f7r/tmpw86gndle TO /home/ec2-user/.ansible/tmp/ansible-tmp-1721489336.9628546-327748-93351034977514/AnsiballZ_command.py
<10.0.1.171> SSH: EXEC sftp -b - -C -o ControlMaster=auto -o ControlPersist=60s -o KbdInteractiveAuthentication=no -o PreferredAuthentications=gssapi-with-mic,gssapi-keyex,hostbased,publickey -o PasswordAuthentication=no -o 'User="ec2-user"' -o ConnectTimeout=10 -o 'ControlPath="/home/ec2-user/.ansible/cp/f291336e89"' '[10.0.1.171]'
<10.0.1.171> (0, b'sftp> put /home/ec2-user/.ansible/tmp/ansible-local-327570hxfw9f7r/tmpw86gndle /home/ec2-user/.ansible/tmp/ansible-tmp-1721489336.9628546-327748-93351034977514/AnsiballZ_command.py\n', b'')
<10.0.1.171> ESTABLISH SSH CONNECTION FOR USER: ec2-user
<10.0.1.171> SSH: EXEC ssh -C -o ControlMaster=auto -o ControlPersist=60s -o KbdInteractiveAuthentication=no -o PreferredAuthentications=gssapi-with-mic,gssapi-keyex,hostbased,publickey -o PasswordAuthentication=no -o 'User="ec2-user"' -o ConnectTimeout=10 -o 'ControlPath="/home/ec2-user/.ansible/cp/f291336e89"' 10.0.1.171 '/bin/sh -c '"'"'chmod u+x /home/ec2-user/.ansible/tmp/ansible-tmp-1721489336.9628546-327748-93351034977514/ /home/ec2-user/.ansible/tmp/ansible-tmp-1721489336.9628546-327748-93351034977514/AnsiballZ_command.py && sleep 0'"'"''
<10.0.1.171> (0, b'', b'')
<10.0.1.171> ESTABLISH SSH CONNECTION FOR USER: ec2-user
<10.0.1.171> SSH: EXEC ssh -C -o ControlMaster=auto -o ControlPersist=60s -o KbdInteractiveAuthentication=no -o PreferredAuthentications=gssapi-with-mic,gssapi-keyex,hostbased,publickey -o PasswordAuthentication=no -o 'User="ec2-user"' -o ConnectTimeout=10 -o 'ControlPath="/home/ec2-user/.ansible/cp/f291336e89"' -tt 10.0.1.171 '/bin/sh -c '"'"'sudo -H -S -n  -u root /bin/sh -c '"'"'"'"'"'"'"'"'echo BECOME-SUCCESS-copmvhlycfocnyfbhbjelkjxlkmgyfto ; KUBECONFIG=/etc/kubernetes/admin.conf /usr/bin/python3.9 /home/ec2-user/.ansible/tmp/ansible-tmp-1721489336.9628546-327748-93351034977514/AnsiballZ_command.py'"'"'"'"'"'"'"'"' && sleep 0'"'"''
Escalation succeeded
<10.0.1.171> (0, b'\r\n{"changed": true, "stdout": "secret/jenkins-secret created", "stderr": "", "rc": 0, "cmd": ["kubectl", "create", "secret", "generic", "jenkins-secret", "--namespace", "default", "--from-literal=token=eyJhbGciOiJSUzI1NiIsImtpZCI6Ii1MQTJuMU9KcFJTbEJkcDE1ZVFUamNiSEMyY0VwNzIxd1N4cFFuX2NiTDgifQ.eyJhdWQiOlsiaHR0cHM6Ly9rdWJlcm5ldGVzLmRlZmF1bHQuc3ZjLmNsdXN0ZXIubG9jYWwiXSwiZXhwIjoxNzIxNTc1NzM2LCJpYXQiOjE3MjE0ODkzMzYsImlzcyI6Imh0dHBzOi8va3ViZXJuZXRlcy5kZWZhdWx0LnN2Yy5jbHVzdGVyLmxvY2FsIiwianRpIjoiMGE2M2I5MmMtNGVhYy00NWUxLThkYTEtNDFkY2Y3NDczMGMxIiwia3ViZXJuZXRlcy5pbyI6eyJuYW1lc3BhY2UiOiJkZWZhdWx0Iiwic2VydmljZWFjY291bnQiOnsibmFtZSI6ImplbmtpbnMiLCJ1aWQiOiIxNzkxMDY4NC1jOTkzLTRiYzctYjU1Mi04NTY2YTI4OWMwYWUifX0sIm5iZiI6MTcyMTQ4OTMzNiwic3ViIjoic3lzdGVtOnNlcnZpY2VhY2NvdW50OmRlZmF1bHQ6amVua2lucyJ9.Y-ZwzxSTx3xKLPrJWEO18InqwmCqeVP8Kfc1p_jQusOwq1-y80SCrsI5QuiciqD656x2kTeN_YmAsbuzajUJ2Mx6E-AMtiH09uiYOeHN236FOZDjBmJG7hh_vk5LIGYwc3z5xWEeJozjEPT4-YNOlfcapLHKO6UakvdzkaggXExxtCRilFVU8ZcnM7WuYoKNUnxx-sUJ092RgyW70gKVsddCQPpkvStjpdQdWZnvGAUU62zzHOATx5jv7x842lrb2CT263KXquGUqugAULOrDTzySo7XuKL-IUbbI_nhrKjjMcOb-BfCRB9DWaTl3Jx_PapFz9B9C3iXO8rl17183A", "--from-file=ca.crt=/etc/kubernetes/pki/ca.crt"], "start": "2024-07-20 15:28:57.603881", "end": "2024-07-20 15:28:57.696283", "delta": "0:00:00.092402", "msg": "", "invocation": {"module_args": {"_raw_params": "kubectl create secret generic jenkins-secret --namespace default --from-literal=token=eyJhbGciOiJSUzI1NiIsImtpZCI6Ii1MQTJuMU9KcFJTbEJkcDE1ZVFUamNiSEMyY0VwNzIxd1N4cFFuX2NiTDgifQ.eyJhdWQiOlsiaHR0cHM6Ly9rdWJlcm5ldGVzLmRlZmF1bHQuc3ZjLmNsdXN0ZXIubG9jYWwiXSwiZXhwIjoxNzIxNTc1NzM2LCJpYXQiOjE3MjE0ODkzMzYsImlzcyI6Imh0dHBzOi8va3ViZXJuZXRlcy5kZWZhdWx0LnN2Yy5jbHVzdGVyLmxvY2FsIiwianRpIjoiMGE2M2I5MmMtNGVhYy00NWUxLThkYTEtNDFkY2Y3NDczMGMxIiwia3ViZXJuZXRlcy5pbyI6eyJuYW1lc3BhY2UiOiJkZWZhdWx0Iiwic2VydmljZWFjY291bnQiOnsibmFtZSI6ImplbmtpbnMiLCJ1aWQiOiIxNzkxMDY4NC1jOTkzLTRiYzctYjU1Mi04NTY2YTI4OWMwYWUifX0sIm5iZiI6MTcyMTQ4OTMzNiwic3ViIjoic3lzdGVtOnNlcnZpY2VhY2NvdW50OmRlZmF1bHQ6amVua2lucyJ9.Y-ZwzxSTx3xKLPrJWEO18InqwmCqeVP8Kfc1p_jQusOwq1-y80SCrsI5QuiciqD656x2kTeN_YmAsbuzajUJ2Mx6E-AMtiH09uiYOeHN236FOZDjBmJG7hh_vk5LIGYwc3z5xWEeJozjEPT4-YNOlfcapLHKO6UakvdzkaggXExxtCRilFVU8ZcnM7WuYoKNUnxx-sUJ092RgyW70gKVsddCQPpkvStjpdQdWZnvGAUU62zzHOATx5jv7x842lrb2CT263KXquGUqugAULOrDTzySo7XuKL-IUbbI_nhrKjjMcOb-BfCRB9DWaTl3Jx_PapFz9B9C3iXO8rl17183A --from-file=ca.crt=/etc/kubernetes/pki/ca.crt", "_uses_shell": false, "stdin_add_newline": true, "strip_empty_ends": true, "argv": null, "chdir": null, "executable": null, "creates": null, "removes": null, "stdin": null}}}\r\n', b'Shared connection to 10.0.1.171 closed.\r\n')
<10.0.1.171> ESTABLISH SSH CONNECTION FOR USER: ec2-user
<10.0.1.171> SSH: EXEC ssh -C -o ControlMaster=auto -o ControlPersist=60s -o KbdInteractiveAuthentication=no -o PreferredAuthentications=gssapi-with-mic,gssapi-keyex,hostbased,publickey -o PasswordAuthentication=no -o 'User="ec2-user"' -o ConnectTimeout=10 -o 'ControlPath="/home/ec2-user/.ansible/cp/f291336e89"' 10.0.1.171 '/bin/sh -c '"'"'rm -f -r /home/ec2-user/.ansible/tmp/ansible-tmp-1721489336.9628546-327748-93351034977514/ > /dev/null 2>&1 && sleep 0'"'"''
<10.0.1.171> (0, b'', b'')
changed: [master] => {
    "changed": true,
    "cmd": [
        "kubectl",
        "create",
        "secret",
        "generic",
        "jenkins-secret",
        "--namespace",
        "default",
        "--from-literal=token=eyJhbGciOiJSUzI1NiIsImtpZCI6Ii1MQTJuMU9KcFJTbEJkcDE1ZVFUamNiSEMyY0VwNzIxd1N4cFFuX2NiTDgifQ.eyJhdWQiOlsiaHR0cHM6Ly9rdWJlcm5ldGVzLmRlZmF1bHQuc3ZjLmNsdXN0ZXIubG9jYWwiXSwiZXhwIjoxNzIxNTc1NzM2LCJpYXQiOjE3MjE0ODkzMzYsImlzcyI6Imh0dHBzOi8va3ViZXJuZXRlcy5kZWZhdWx0LnN2Yy5jbHVzdGVyLmxvY2FsIiwianRpIjoiMGE2M2I5MmMtNGVhYy00NWUxLThkYTEtNDFkY2Y3NDczMGMxIiwia3ViZXJuZXRlcy5pbyI6eyJuYW1lc3BhY2UiOiJkZWZhdWx0Iiwic2VydmljZWFjY291bnQiOnsibmFtZSI6ImplbmtpbnMiLCJ1aWQiOiIxNzkxMDY4NC1jOTkzLTRiYzctYjU1Mi04NTY2YTI4OWMwYWUifX0sIm5iZiI6MTcyMTQ4OTMzNiwic3ViIjoic3lzdGVtOnNlcnZpY2VhY2NvdW50OmRlZmF1bHQ6amVua2lucyJ9.Y-ZwzxSTx3xKLPrJWEO18InqwmCqeVP8Kfc1p_jQusOwq1-y80SCrsI5QuiciqD656x2kTeN_YmAsbuzajUJ2Mx6E-AMtiH09uiYOeHN236FOZDjBmJG7hh_vk5LIGYwc3z5xWEeJozjEPT4-YNOlfcapLHKO6UakvdzkaggXExxtCRilFVU8ZcnM7WuYoKNUnxx-sUJ092RgyW70gKVsddCQPpkvStjpdQdWZnvGAUU62zzHOATx5jv7x842lrb2CT263KXquGUqugAULOrDTzySo7XuKL-IUbbI_nhrKjjMcOb-BfCRB9DWaTl3Jx_PapFz9B9C3iXO8rl17183A",
        "--from-file=ca.crt=/etc/kubernetes/pki/ca.crt"
    ],
    "delta": "0:00:00.092402",
    "end": "2024-07-20 15:28:57.696283",
    "invocation": {
        "module_args": {
            "_raw_params": "kubectl create secret generic jenkins-secret --namespace default --from-literal=token=eyJhbGciOiJSUzI1NiIsImtpZCI6Ii1MQTJuMU9KcFJTbEJkcDE1ZVFUamNiSEMyY0VwNzIxd1N4cFFuX2NiTDgifQ.eyJhdWQiOlsiaHR0cHM6Ly9rdWJlcm5ldGVzLmRlZmF1bHQuc3ZjLmNsdXN0ZXIubG9jYWwiXSwiZXhwIjoxNzIxNTc1NzM2LCJpYXQiOjE3MjE0ODkzMzYsImlzcyI6Imh0dHBzOi8va3ViZXJuZXRlcy5kZWZhdWx0LnN2Yy5jbHVzdGVyLmxvY2FsIiwianRpIjoiMGE2M2I5MmMtNGVhYy00NWUxLThkYTEtNDFkY2Y3NDczMGMxIiwia3ViZXJuZXRlcy5pbyI6eyJuYW1lc3BhY2UiOiJkZWZhdWx0Iiwic2VydmljZWFjY291bnQiOnsibmFtZSI6ImplbmtpbnMiLCJ1aWQiOiIxNzkxMDY4NC1jOTkzLTRiYzctYjU1Mi04NTY2YTI4OWMwYWUifX0sIm5iZiI6MTcyMTQ4OTMzNiwic3ViIjoic3lzdGVtOnNlcnZpY2VhY2NvdW50OmRlZmF1bHQ6amVua2lucyJ9.Y-ZwzxSTx3xKLPrJWEO18InqwmCqeVP8Kfc1p_jQusOwq1-y80SCrsI5QuiciqD656x2kTeN_YmAsbuzajUJ2Mx6E-AMtiH09uiYOeHN236FOZDjBmJG7hh_vk5LIGYwc3z5xWEeJozjEPT4-YNOlfcapLHKO6UakvdzkaggXExxtCRilFVU8ZcnM7WuYoKNUnxx-sUJ092RgyW70gKVsddCQPpkvStjpdQdWZnvGAUU62zzHOATx5jv7x842lrb2CT263KXquGUqugAULOrDTzySo7XuKL-IUbbI_nhrKjjMcOb-BfCRB9DWaTl3Jx_PapFz9B9C3iXO8rl17183A --from-file=ca.crt=/etc/kubernetes/pki/ca.crt",
            "_uses_shell": false,
            "argv": null,
            "chdir": null,
            "creates": null,
            "executable": null,
            "removes": null,
            "stdin": null,
            "stdin_add_newline": true,
            "strip_empty_ends": true
        }
    },
    "msg": "",
    "rc": 0,
    "start": "2024-07-20 15:28:57.603881",
    "stderr": "",
    "stderr_lines": [],
    "stdout": "secret/jenkins-secret created",
    "stdout_lines": [
        "secret/jenkins-secret created"
    ]
}

TASK [Patch service account with secret] ***************************************
task path: /home/ec2-user/devops_setup/ansible/playbooks/kubernetes/setup_kubectl_auth.yaml:66
<10.0.1.171> ESTABLISH SSH CONNECTION FOR USER: ec2-user
<10.0.1.171> SSH: EXEC ssh -C -o ControlMaster=auto -o ControlPersist=60s -o KbdInteractiveAuthentication=no -o PreferredAuthentications=gssapi-with-mic,gssapi-keyex,hostbased,publickey -o PasswordAuthentication=no -o 'User="ec2-user"' -o ConnectTimeout=10 -o 'ControlPath="/home/ec2-user/.ansible/cp/f291336e89"' 10.0.1.171 '/bin/sh -c '"'"'echo ~ec2-user && sleep 0'"'"''
<10.0.1.171> (0, b'/home/ec2-user\n', b'')
<10.0.1.171> ESTABLISH SSH CONNECTION FOR USER: ec2-user
<10.0.1.171> SSH: EXEC ssh -C -o ControlMaster=auto -o ControlPersist=60s -o KbdInteractiveAuthentication=no -o PreferredAuthentications=gssapi-with-mic,gssapi-keyex,hostbased,publickey -o PasswordAuthentication=no -o 'User="ec2-user"' -o ConnectTimeout=10 -o 'ControlPath="/home/ec2-user/.ansible/cp/f291336e89"' 10.0.1.171 '/bin/sh -c '"'"'( umask 77 && mkdir -p "` echo /home/ec2-user/.ansible/tmp `"&& mkdir "` echo /home/ec2-user/.ansible/tmp/ansible-tmp-1721489337.884361-327763-104367036881273 `" && echo ansible-tmp-1721489337.884361-327763-104367036881273="` echo /home/ec2-user/.ansible/tmp/ansible-tmp-1721489337.884361-327763-104367036881273 `" ) && sleep 0'"'"''
<10.0.1.171> (0, b'ansible-tmp-1721489337.884361-327763-104367036881273=/home/ec2-user/.ansible/tmp/ansible-tmp-1721489337.884361-327763-104367036881273\n', b'')
Using module file /usr/lib/python3.9/site-packages/ansible/modules/command.py
<10.0.1.171> PUT /home/ec2-user/.ansible/tmp/ansible-local-327570hxfw9f7r/tmpsxw350v1 TO /home/ec2-user/.ansible/tmp/ansible-tmp-1721489337.884361-327763-104367036881273/AnsiballZ_command.py
<10.0.1.171> SSH: EXEC sftp -b - -C -o ControlMaster=auto -o ControlPersist=60s -o KbdInteractiveAuthentication=no -o PreferredAuthentications=gssapi-with-mic,gssapi-keyex,hostbased,publickey -o PasswordAuthentication=no -o 'User="ec2-user"' -o ConnectTimeout=10 -o 'ControlPath="/home/ec2-user/.ansible/cp/f291336e89"' '[10.0.1.171]'
<10.0.1.171> (0, b'sftp> put /home/ec2-user/.ansible/tmp/ansible-local-327570hxfw9f7r/tmpsxw350v1 /home/ec2-user/.ansible/tmp/ansible-tmp-1721489337.884361-327763-104367036881273/AnsiballZ_command.py\n', b'')
<10.0.1.171> ESTABLISH SSH CONNECTION FOR USER: ec2-user
<10.0.1.171> SSH: EXEC ssh -C -o ControlMaster=auto -o ControlPersist=60s -o KbdInteractiveAuthentication=no -o PreferredAuthentications=gssapi-with-mic,gssapi-keyex,hostbased,publickey -o PasswordAuthentication=no -o 'User="ec2-user"' -o ConnectTimeout=10 -o 'ControlPath="/home/ec2-user/.ansible/cp/f291336e89"' 10.0.1.171 '/bin/sh -c '"'"'chmod u+x /home/ec2-user/.ansible/tmp/ansible-tmp-1721489337.884361-327763-104367036881273/ /home/ec2-user/.ansible/tmp/ansible-tmp-1721489337.884361-327763-104367036881273/AnsiballZ_command.py && sleep 0'"'"''
<10.0.1.171> (0, b'', b'')
<10.0.1.171> ESTABLISH SSH CONNECTION FOR USER: ec2-user
<10.0.1.171> SSH: EXEC ssh -C -o ControlMaster=auto -o ControlPersist=60s -o KbdInteractiveAuthentication=no -o PreferredAuthentications=gssapi-with-mic,gssapi-keyex,hostbased,publickey -o PasswordAuthentication=no -o 'User="ec2-user"' -o ConnectTimeout=10 -o 'ControlPath="/home/ec2-user/.ansible/cp/f291336e89"' -tt 10.0.1.171 '/bin/sh -c '"'"'sudo -H -S -n  -u root /bin/sh -c '"'"'"'"'"'"'"'"'echo BECOME-SUCCESS-ozoiqjblzsxemtwmtqnxmjwnehacmaql ; KUBECONFIG=/etc/kubernetes/admin.conf /usr/bin/python3.9 /home/ec2-user/.ansible/tmp/ansible-tmp-1721489337.884361-327763-104367036881273/AnsiballZ_command.py'"'"'"'"'"'"'"'"' && sleep 0'"'"''
Escalation succeeded
<10.0.1.171> (0, b'\r\n{"changed": true, "stdout": "serviceaccount/jenkins patched", "stderr": "", "rc": 0, "cmd": "kubectl patch serviceaccount jenkins -n default -p \'{\\"secrets\\": [{\\"name\\": \\"jenkins-secret\\"}]}\'\\n", "start": "2024-07-20 15:28:58.397350", "end": "2024-07-20 15:28:58.512991", "delta": "0:00:00.115641", "msg": "", "invocation": {"module_args": {"_raw_params": "kubectl patch serviceaccount jenkins -n default -p \'{\\"secrets\\": [{\\"name\\": \\"jenkins-secret\\"}]}\'\\n", "_uses_shell": true, "stdin_add_newline": true, "strip_empty_ends": true, "argv": null, "chdir": null, "executable": null, "creates": null, "removes": null, "stdin": null}}}\r\n', b'Shared connection to 10.0.1.171 closed.\r\n')
<10.0.1.171> ESTABLISH SSH CONNECTION FOR USER: ec2-user
<10.0.1.171> SSH: EXEC ssh -C -o ControlMaster=auto -o ControlPersist=60s -o KbdInteractiveAuthentication=no -o PreferredAuthentications=gssapi-with-mic,gssapi-keyex,hostbased,publickey -o PasswordAuthentication=no -o 'User="ec2-user"' -o ConnectTimeout=10 -o 'ControlPath="/home/ec2-user/.ansible/cp/f291336e89"' 10.0.1.171 '/bin/sh -c '"'"'rm -f -r /home/ec2-user/.ansible/tmp/ansible-tmp-1721489337.884361-327763-104367036881273/ > /dev/null 2>&1 && sleep 0'"'"''
<10.0.1.171> (0, b'', b'')
changed: [master] => {
    "changed": true,
    "cmd": "kubectl patch serviceaccount jenkins -n default -p '{\"secrets\": [{\"name\": \"jenkins-secret\"}]}'\n",
    "delta": "0:00:00.115641",
    "end": "2024-07-20 15:28:58.512991",
    "invocation": {
        "module_args": {
            "_raw_params": "kubectl patch serviceaccount jenkins -n default -p '{\"secrets\": [{\"name\": \"jenkins-secret\"}]}'\n",
            "_uses_shell": true,
            "argv": null,
            "chdir": null,
            "creates": null,
            "executable": null,
            "removes": null,
            "stdin": null,
            "stdin_add_newline": true,
            "strip_empty_ends": true
        }
    },
    "msg": "",
    "rc": 0,
    "start": "2024-07-20 15:28:58.397350",
    "stderr": "",
    "stderr_lines": [],
    "stdout": "serviceaccount/jenkins patched",
    "stdout_lines": [
        "serviceaccount/jenkins patched"
    ]
}

TASK [Retrieve certificate-authority-data] *************************************
task path: /home/ec2-user/devops_setup/ansible/playbooks/kubernetes/setup_kubectl_auth.yaml:72
<10.0.1.171> ESTABLISH SSH CONNECTION FOR USER: ec2-user
<10.0.1.171> SSH: EXEC ssh -C -o ControlMaster=auto -o ControlPersist=60s -o KbdInteractiveAuthentication=no -o PreferredAuthentications=gssapi-with-mic,gssapi-keyex,hostbased,publickey -o PasswordAuthentication=no -o 'User="ec2-user"' -o ConnectTimeout=10 -o 'ControlPath="/home/ec2-user/.ansible/cp/f291336e89"' 10.0.1.171 '/bin/sh -c '"'"'echo ~ec2-user && sleep 0'"'"''
<10.0.1.171> (0, b'/home/ec2-user\n', b'')
<10.0.1.171> ESTABLISH SSH CONNECTION FOR USER: ec2-user
<10.0.1.171> SSH: EXEC ssh -C -o ControlMaster=auto -o ControlPersist=60s -o KbdInteractiveAuthentication=no -o PreferredAuthentications=gssapi-with-mic,gssapi-keyex,hostbased,publickey -o PasswordAuthentication=no -o 'User="ec2-user"' -o ConnectTimeout=10 -o 'ControlPath="/home/ec2-user/.ansible/cp/f291336e89"' 10.0.1.171 '/bin/sh -c '"'"'( umask 77 && mkdir -p "` echo /home/ec2-user/.ansible/tmp `"&& mkdir "` echo /home/ec2-user/.ansible/tmp/ansible-tmp-1721489338.6467645-327772-150563971252281 `" && echo ansible-tmp-1721489338.6467645-327772-150563971252281="` echo /home/ec2-user/.ansible/tmp/ansible-tmp-1721489338.6467645-327772-150563971252281 `" ) && sleep 0'"'"''
<10.0.1.171> (0, b'ansible-tmp-1721489338.6467645-327772-150563971252281=/home/ec2-user/.ansible/tmp/ansible-tmp-1721489338.6467645-327772-150563971252281\n', b'')
Using module file /usr/lib/python3.9/site-packages/ansible/modules/command.py
<10.0.1.171> PUT /home/ec2-user/.ansible/tmp/ansible-local-327570hxfw9f7r/tmpkmoo7o1m TO /home/ec2-user/.ansible/tmp/ansible-tmp-1721489338.6467645-327772-150563971252281/AnsiballZ_command.py
<10.0.1.171> SSH: EXEC sftp -b - -C -o ControlMaster=auto -o ControlPersist=60s -o KbdInteractiveAuthentication=no -o PreferredAuthentications=gssapi-with-mic,gssapi-keyex,hostbased,publickey -o PasswordAuthentication=no -o 'User="ec2-user"' -o ConnectTimeout=10 -o 'ControlPath="/home/ec2-user/.ansible/cp/f291336e89"' '[10.0.1.171]'
<10.0.1.171> (0, b'sftp> put /home/ec2-user/.ansible/tmp/ansible-local-327570hxfw9f7r/tmpkmoo7o1m /home/ec2-user/.ansible/tmp/ansible-tmp-1721489338.6467645-327772-150563971252281/AnsiballZ_command.py\n', b'')
<10.0.1.171> ESTABLISH SSH CONNECTION FOR USER: ec2-user
<10.0.1.171> SSH: EXEC ssh -C -o ControlMaster=auto -o ControlPersist=60s -o KbdInteractiveAuthentication=no -o PreferredAuthentications=gssapi-with-mic,gssapi-keyex,hostbased,publickey -o PasswordAuthentication=no -o 'User="ec2-user"' -o ConnectTimeout=10 -o 'ControlPath="/home/ec2-user/.ansible/cp/f291336e89"' 10.0.1.171 '/bin/sh -c '"'"'chmod u+x /home/ec2-user/.ansible/tmp/ansible-tmp-1721489338.6467645-327772-150563971252281/ /home/ec2-user/.ansible/tmp/ansible-tmp-1721489338.6467645-327772-150563971252281/AnsiballZ_command.py && sleep 0'"'"''
<10.0.1.171> (0, b'', b'')
<10.0.1.171> ESTABLISH SSH CONNECTION FOR USER: ec2-user
<10.0.1.171> SSH: EXEC ssh -C -o ControlMaster=auto -o ControlPersist=60s -o KbdInteractiveAuthentication=no -o PreferredAuthentications=gssapi-with-mic,gssapi-keyex,hostbased,publickey -o PasswordAuthentication=no -o 'User="ec2-user"' -o ConnectTimeout=10 -o 'ControlPath="/home/ec2-user/.ansible/cp/f291336e89"' -tt 10.0.1.171 '/bin/sh -c '"'"'sudo -H -S -n  -u root /bin/sh -c '"'"'"'"'"'"'"'"'echo BECOME-SUCCESS-jntxsgckzfpnuhuwtxmwbrnfactuftck ; KUBECONFIG=/etc/kubernetes/admin.conf /usr/bin/python3.9 /home/ec2-user/.ansible/tmp/ansible-tmp-1721489338.6467645-327772-150563971252281/AnsiballZ_command.py'"'"'"'"'"'"'"'"' && sleep 0'"'"''
Escalation succeeded
<10.0.1.171> (0, b'\r\n{"changed": true, "stdout": "LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURCVENDQWUyZ0F3SUJBZ0lJTWZSUUtyWWZuaG93RFFZSktvWklodmNOQVFFTEJRQXdGVEVUTUJFR0ExVUUKQXhNS2EzVmlaWEp1WlhSbGN6QWVGdzB5TkRBM01qQXhOVEl6TWpkYUZ3MHpOREEzTVRneE5USTRNamRhTUJVeApFekFSQmdOVkJBTVRDbXQxWW1WeWJtVjBaWE13Z2dFaU1BMEdDU3FHU0liM0RRRUJBUVVBQTRJQkR3QXdnZ0VLCkFvSUJBUUN4d1RvbStjRllqemNsOFBkL2gvYjNPMkV6dG93aXc0NnNLdGdOQmJ4M2hwZmdpV21ISGRiNWVMMS8KdnFXSDNaSlVPb3Q3TVFDNVF1ZlBleHZzQ2dvcklnNG9FNDhIVlBPUG00d0drbG1VWGJLcXNtTEhkaE1XcUNDVApTRHorbjEzaFBRVytJWTVYN0NSNVk4cEhlRVNtRnZMY0xHYlJKR05GOHQyVkVBNlNJRkxIUjJncU8wYk9RcGlvCm41WDljbjRCelVXV2hvQjlkRWdDRjU2d0xxaXRFaTVteFpZenkrZFV3bUdHTVdIZ29NYmloVm1vTHp1aU01cFMKRHRqUlZSczhBUmZ1MXhiaGptYXdJNHZ0QXlXOWUvZ0Z2THJmZ0pQS3V6SlR1MlFPYWRzUi93VldGblRFc1VnagpsV1FkNFhTQmNPQzFDNGVVcE40dnl4TkdWQ3A5QWdNQkFBR2pXVEJYTUE0R0ExVWREd0VCL3dRRUF3SUNwREFQCkJnTlZIUk1CQWY4RUJUQURBUUgvTUIwR0ExVWREZ1FXQkJUYVY5dmd5RnFOSEc3WXVnWFFJRityeisyNWFEQVYKQmdOVkhSRUVEakFNZ2dwcmRXSmxjbTVsZEdWek1BMEdDU3FHU0liM0RRRUJDd1VBQTRJQkFRQVQxeVBTWHdtawpOSWZ6OTF5NW1QaTNUSTZhdGdwcFltSW9lLy9BOVNJZHRQcWtqMnZyenI5YTUrVDRnVUErRGZIelpOeEIyUzNYCmJtWnpvMDZhYnZXSHVnTjVaOEJqREhBWSttUGxYaEVpdThBcUc0UU5HV3c5RFNHVUc2cXp4Y3RqcVVQZE1lMUYKcmpnMVhtL2w4VWJzTG8zLzdUeE5MdlEvaHUxR3c0Z2UraUhQRHZzREpJTmgrYjJCNS8wK1VEcEpPRVZOQWx3bApXYnZoMmgyeWVqcGdFb0grRGJOZE0xRWZPWmJOdmEyRFIySFo5bzlNSnowSGRUOG1pMVIwa2lKcFBVQnVlckVuCkgzYTZpNG9iTFIyNkpzT0pZODZjSGRuUDh3N043NzFGMVNBc0lKN25BRTRhVFlBSmloWGZRdEFhSkdLalY4ZlIKYWhoaHJtdlVFN1hXCi0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K", "stderr": "", "rc": 0, "cmd": ["kubectl", "get", "secret", "jenkins-secret", "-n", "default", "-o", "jsonpath={.data[\'ca\\\\.crt\']}"], "start": "2024-07-20 15:28:59.227602", "end": "2024-07-20 15:28:59.340333", "delta": "0:00:00.112731", "msg": "", "invocation": {"module_args": {"_raw_params": "kubectl get secret jenkins-secret -n default -o jsonpath=\\"{.data[\'ca\\\\.crt\']}\\"", "_uses_shell": false, "stdin_add_newline": true, "strip_empty_ends": true, "argv": null, "chdir": null, "executable": null, "creates": null, "removes": null, "stdin": null}}}\r\n', b'Shared connection to 10.0.1.171 closed.\r\n')
<10.0.1.171> ESTABLISH SSH CONNECTION FOR USER: ec2-user
<10.0.1.171> SSH: EXEC ssh -C -o ControlMaster=auto -o ControlPersist=60s -o KbdInteractiveAuthentication=no -o PreferredAuthentications=gssapi-with-mic,gssapi-keyex,hostbased,publickey -o PasswordAuthentication=no -o 'User="ec2-user"' -o ConnectTimeout=10 -o 'ControlPath="/home/ec2-user/.ansible/cp/f291336e89"' 10.0.1.171 '/bin/sh -c '"'"'rm -f -r /home/ec2-user/.ansible/tmp/ansible-tmp-1721489338.6467645-327772-150563971252281/ > /dev/null 2>&1 && sleep 0'"'"''
<10.0.1.171> (0, b'', b'')
changed: [master] => {
    "changed": true,
    "cmd": [
        "kubectl",
        "get",
        "secret",
        "jenkins-secret",
        "-n",
        "default",
        "-o",
        "jsonpath={.data['ca\\.crt']}"
    ],
    "delta": "0:00:00.112731",
    "end": "2024-07-20 15:28:59.340333",
    "invocation": {
        "module_args": {
            "_raw_params": "kubectl get secret jenkins-secret -n default -o jsonpath=\"{.data['ca\\.crt']}\"",
            "_uses_shell": false,
            "argv": null,
            "chdir": null,
            "creates": null,
            "executable": null,
            "removes": null,
            "stdin": null,
            "stdin_add_newline": true,
            "strip_empty_ends": true
        }
    },
    "msg": "",
    "rc": 0,
    "start": "2024-07-20 15:28:59.227602",
    "stderr": "",
    "stderr_lines": [],
    "stdout": "LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURCVENDQWUyZ0F3SUJBZ0lJTWZSUUtyWWZuaG93RFFZSktvWklodmNOQVFFTEJRQXdGVEVUTUJFR0ExVUUKQXhNS2EzVmlaWEp1WlhSbGN6QWVGdzB5TkRBM01qQXhOVEl6TWpkYUZ3MHpOREEzTVRneE5USTRNamRhTUJVeApFekFSQmdOVkJBTVRDbXQxWW1WeWJtVjBaWE13Z2dFaU1BMEdDU3FHU0liM0RRRUJBUVVBQTRJQkR3QXdnZ0VLCkFvSUJBUUN4d1RvbStjRllqemNsOFBkL2gvYjNPMkV6dG93aXc0NnNLdGdOQmJ4M2hwZmdpV21ISGRiNWVMMS8KdnFXSDNaSlVPb3Q3TVFDNVF1ZlBleHZzQ2dvcklnNG9FNDhIVlBPUG00d0drbG1VWGJLcXNtTEhkaE1XcUNDVApTRHorbjEzaFBRVytJWTVYN0NSNVk4cEhlRVNtRnZMY0xHYlJKR05GOHQyVkVBNlNJRkxIUjJncU8wYk9RcGlvCm41WDljbjRCelVXV2hvQjlkRWdDRjU2d0xxaXRFaTVteFpZenkrZFV3bUdHTVdIZ29NYmloVm1vTHp1aU01cFMKRHRqUlZSczhBUmZ1MXhiaGptYXdJNHZ0QXlXOWUvZ0Z2THJmZ0pQS3V6SlR1MlFPYWRzUi93VldGblRFc1VnagpsV1FkNFhTQmNPQzFDNGVVcE40dnl4TkdWQ3A5QWdNQkFBR2pXVEJYTUE0R0ExVWREd0VCL3dRRUF3SUNwREFQCkJnTlZIUk1CQWY4RUJUQURBUUgvTUIwR0ExVWREZ1FXQkJUYVY5dmd5RnFOSEc3WXVnWFFJRityeisyNWFEQVYKQmdOVkhSRUVEakFNZ2dwcmRXSmxjbTVsZEdWek1BMEdDU3FHU0liM0RRRUJDd1VBQTRJQkFRQVQxeVBTWHdtawpOSWZ6OTF5NW1QaTNUSTZhdGdwcFltSW9lLy9BOVNJZHRQcWtqMnZyenI5YTUrVDRnVUErRGZIelpOeEIyUzNYCmJtWnpvMDZhYnZXSHVnTjVaOEJqREhBWSttUGxYaEVpdThBcUc0UU5HV3c5RFNHVUc2cXp4Y3RqcVVQZE1lMUYKcmpnMVhtL2w4VWJzTG8zLzdUeE5MdlEvaHUxR3c0Z2UraUhQRHZzREpJTmgrYjJCNS8wK1VEcEpPRVZOQWx3bApXYnZoMmgyeWVqcGdFb0grRGJOZE0xRWZPWmJOdmEyRFIySFo5bzlNSnowSGRUOG1pMVIwa2lKcFBVQnVlckVuCkgzYTZpNG9iTFIyNkpzT0pZODZjSGRuUDh3N043NzFGMVNBc0lKN25BRTRhVFlBSmloWGZRdEFhSkdLalY4ZlIKYWhoaHJtdlVFN1hXCi0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K",
    "stdout_lines": [
        "LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURCVENDQWUyZ0F3SUJBZ0lJTWZSUUtyWWZuaG93RFFZSktvWklodmNOQVFFTEJRQXdGVEVUTUJFR0ExVUUKQXhNS2EzVmlaWEp1WlhSbGN6QWVGdzB5TkRBM01qQXhOVEl6TWpkYUZ3MHpOREEzTVRneE5USTRNamRhTUJVeApFekFSQmdOVkJBTVRDbXQxWW1WeWJtVjBaWE13Z2dFaU1BMEdDU3FHU0liM0RRRUJBUVVBQTRJQkR3QXdnZ0VLCkFvSUJBUUN4d1RvbStjRllqemNsOFBkL2gvYjNPMkV6dG93aXc0NnNLdGdOQmJ4M2hwZmdpV21ISGRiNWVMMS8KdnFXSDNaSlVPb3Q3TVFDNVF1ZlBleHZzQ2dvcklnNG9FNDhIVlBPUG00d0drbG1VWGJLcXNtTEhkaE1XcUNDVApTRHorbjEzaFBRVytJWTVYN0NSNVk4cEhlRVNtRnZMY0xHYlJKR05GOHQyVkVBNlNJRkxIUjJncU8wYk9RcGlvCm41WDljbjRCelVXV2hvQjlkRWdDRjU2d0xxaXRFaTVteFpZenkrZFV3bUdHTVdIZ29NYmloVm1vTHp1aU01cFMKRHRqUlZSczhBUmZ1MXhiaGptYXdJNHZ0QXlXOWUvZ0Z2THJmZ0pQS3V6SlR1MlFPYWRzUi93VldGblRFc1VnagpsV1FkNFhTQmNPQzFDNGVVcE40dnl4TkdWQ3A5QWdNQkFBR2pXVEJYTUE0R0ExVWREd0VCL3dRRUF3SUNwREFQCkJnTlZIUk1CQWY4RUJUQURBUUgvTUIwR0ExVWREZ1FXQkJUYVY5dmd5RnFOSEc3WXVnWFFJRityeisyNWFEQVYKQmdOVkhSRUVEakFNZ2dwcmRXSmxjbTVsZEdWek1BMEdDU3FHU0liM0RRRUJDd1VBQTRJQkFRQVQxeVBTWHdtawpOSWZ6OTF5NW1QaTNUSTZhdGdwcFltSW9lLy9BOVNJZHRQcWtqMnZyenI5YTUrVDRnVUErRGZIelpOeEIyUzNYCmJtWnpvMDZhYnZXSHVnTjVaOEJqREhBWSttUGxYaEVpdThBcUc0UU5HV3c5RFNHVUc2cXp4Y3RqcVVQZE1lMUYKcmpnMVhtL2w4VWJzTG8zLzdUeE5MdlEvaHUxR3c0Z2UraUhQRHZzREpJTmgrYjJCNS8wK1VEcEpPRVZOQWx3bApXYnZoMmgyeWVqcGdFb0grRGJOZE0xRWZPWmJOdmEyRFIySFo5bzlNSnowSGRUOG1pMVIwa2lKcFBVQnVlckVuCkgzYTZpNG9iTFIyNkpzT0pZODZjSGRuUDh3N043NzFGMVNBc0lKN25BRTRhVFlBSmloWGZRdEFhSkdLalY4ZlIKYWhoaHJtdlVFN1hXCi0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K"
    ]
}

TASK [Create kubeconfig file for Jenkins] **************************************
task path: /home/ec2-user/devops_setup/ansible/playbooks/kubernetes/setup_kubectl_auth.yaml:78
<10.0.1.171> ESTABLISH SSH CONNECTION FOR USER: ec2-user
<10.0.1.171> SSH: EXEC ssh -C -o ControlMaster=auto -o ControlPersist=60s -o KbdInteractiveAuthentication=no -o PreferredAuthentications=gssapi-with-mic,gssapi-keyex,hostbased,publickey -o PasswordAuthentication=no -o 'User="ec2-user"' -o ConnectTimeout=10 -o 'ControlPath="/home/ec2-user/.ansible/cp/f291336e89"' 10.0.1.171 '/bin/sh -c '"'"'echo ~ec2-user && sleep 0'"'"''
<10.0.1.171> (0, b'/home/ec2-user\n', b'')
<10.0.1.171> ESTABLISH SSH CONNECTION FOR USER: ec2-user
<10.0.1.171> SSH: EXEC ssh -C -o ControlMaster=auto -o ControlPersist=60s -o KbdInteractiveAuthentication=no -o PreferredAuthentications=gssapi-with-mic,gssapi-keyex,hostbased,publickey -o PasswordAuthentication=no -o 'User="ec2-user"' -o ConnectTimeout=10 -o 'ControlPath="/home/ec2-user/.ansible/cp/f291336e89"' 10.0.1.171 '/bin/sh -c '"'"'( umask 77 && mkdir -p "` echo /home/ec2-user/.ansible/tmp `"&& mkdir "` echo /home/ec2-user/.ansible/tmp/ansible-tmp-1721489339.5392578-327787-255284304918293 `" && echo ansible-tmp-1721489339.5392578-327787-255284304918293="` echo /home/ec2-user/.ansible/tmp/ansible-tmp-1721489339.5392578-327787-255284304918293 `" ) && sleep 0'"'"''
<10.0.1.171> (0, b'ansible-tmp-1721489339.5392578-327787-255284304918293=/home/ec2-user/.ansible/tmp/ansible-tmp-1721489339.5392578-327787-255284304918293\n', b'')
Using module file /usr/lib/python3.9/site-packages/ansible/modules/command.py
<10.0.1.171> PUT /home/ec2-user/.ansible/tmp/ansible-local-327570hxfw9f7r/tmp08efocqh TO /home/ec2-user/.ansible/tmp/ansible-tmp-1721489339.5392578-327787-255284304918293/AnsiballZ_command.py
<10.0.1.171> SSH: EXEC sftp -b - -C -o ControlMaster=auto -o ControlPersist=60s -o KbdInteractiveAuthentication=no -o PreferredAuthentications=gssapi-with-mic,gssapi-keyex,hostbased,publickey -o PasswordAuthentication=no -o 'User="ec2-user"' -o ConnectTimeout=10 -o 'ControlPath="/home/ec2-user/.ansible/cp/f291336e89"' '[10.0.1.171]'
<10.0.1.171> (0, b'sftp> put /home/ec2-user/.ansible/tmp/ansible-local-327570hxfw9f7r/tmp08efocqh /home/ec2-user/.ansible/tmp/ansible-tmp-1721489339.5392578-327787-255284304918293/AnsiballZ_command.py\n', b'')
<10.0.1.171> ESTABLISH SSH CONNECTION FOR USER: ec2-user
<10.0.1.171> SSH: EXEC ssh -C -o ControlMaster=auto -o ControlPersist=60s -o KbdInteractiveAuthentication=no -o PreferredAuthentications=gssapi-with-mic,gssapi-keyex,hostbased,publickey -o PasswordAuthentication=no -o 'User="ec2-user"' -o ConnectTimeout=10 -o 'ControlPath="/home/ec2-user/.ansible/cp/f291336e89"' 10.0.1.171 '/bin/sh -c '"'"'chmod u+x /home/ec2-user/.ansible/tmp/ansible-tmp-1721489339.5392578-327787-255284304918293/ /home/ec2-user/.ansible/tmp/ansible-tmp-1721489339.5392578-327787-255284304918293/AnsiballZ_command.py && sleep 0'"'"''
<10.0.1.171> (0, b'', b'')
<10.0.1.171> ESTABLISH SSH CONNECTION FOR USER: ec2-user
<10.0.1.171> SSH: EXEC ssh -C -o ControlMaster=auto -o ControlPersist=60s -o KbdInteractiveAuthentication=no -o PreferredAuthentications=gssapi-with-mic,gssapi-keyex,hostbased,publickey -o PasswordAuthentication=no -o 'User="ec2-user"' -o ConnectTimeout=10 -o 'ControlPath="/home/ec2-user/.ansible/cp/f291336e89"' -tt 10.0.1.171 '/bin/sh -c '"'"'sudo -H -S -n  -u root /bin/sh -c '"'"'"'"'"'"'"'"'echo BECOME-SUCCESS-nvuyfggghairfavqbxypahecsjjfyile ; KUBECONFIG=/etc/kubernetes/admin.conf /usr/bin/python3.9 /home/ec2-user/.ansible/tmp/ansible-tmp-1721489339.5392578-327787-255284304918293/AnsiballZ_command.py'"'"'"'"'"'"'"'"' && sleep 0'"'"''
Escalation succeeded
<10.0.1.171> (0, b'\r\n{"changed": true, "stdout": "", "stderr": "", "rc": 0, "cmd": "cat <<EOF > /tmp/kubeconfig-jenkins.yaml\\napiVersion: v1\\nkind: Config\\nclusters:\\n- cluster:\\n    certificate-authority-data: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURCVENDQWUyZ0F3SUJBZ0lJTWZSUUtyWWZuaG93RFFZSktvWklodmNOQVFFTEJRQXdGVEVUTUJFR0ExVUUKQXhNS2EzVmlaWEp1WlhSbGN6QWVGdzB5TkRBM01qQXhOVEl6TWpkYUZ3MHpOREEzTVRneE5USTRNamRhTUJVeApFekFSQmdOVkJBTVRDbXQxWW1WeWJtVjBaWE13Z2dFaU1BMEdDU3FHU0liM0RRRUJBUVVBQTRJQkR3QXdnZ0VLCkFvSUJBUUN4d1RvbStjRllqemNsOFBkL2gvYjNPMkV6dG93aXc0NnNLdGdOQmJ4M2hwZmdpV21ISGRiNWVMMS8KdnFXSDNaSlVPb3Q3TVFDNVF1ZlBleHZzQ2dvcklnNG9FNDhIVlBPUG00d0drbG1VWGJLcXNtTEhkaE1XcUNDVApTRHorbjEzaFBRVytJWTVYN0NSNVk4cEhlRVNtRnZMY0xHYlJKR05GOHQyVkVBNlNJRkxIUjJncU8wYk9RcGlvCm41WDljbjRCelVXV2hvQjlkRWdDRjU2d0xxaXRFaTVteFpZenkrZFV3bUdHTVdIZ29NYmloVm1vTHp1aU01cFMKRHRqUlZSczhBUmZ1MXhiaGptYXdJNHZ0QXlXOWUvZ0Z2THJmZ0pQS3V6SlR1MlFPYWRzUi93VldGblRFc1VnagpsV1FkNFhTQmNPQzFDNGVVcE40dnl4TkdWQ3A5QWdNQkFBR2pXVEJYTUE0R0ExVWREd0VCL3dRRUF3SUNwREFQCkJnTlZIUk1CQWY4RUJUQURBUUgvTUIwR0ExVWREZ1FXQkJUYVY5dmd5RnFOSEc3WXVnWFFJRityeisyNWFEQVYKQmdOVkhSRUVEakFNZ2dwcmRXSmxjbTVsZEdWek1BMEdDU3FHU0liM0RRRUJDd1VBQTRJQkFRQVQxeVBTWHdtawpOSWZ6OTF5NW1QaTNUSTZhdGdwcFltSW9lLy9BOVNJZHRQcWtqMnZyenI5YTUrVDRnVUErRGZIelpOeEIyUzNYCmJtWnpvMDZhYnZXSHVnTjVaOEJqREhBWSttUGxYaEVpdThBcUc0UU5HV3c5RFNHVUc2cXp4Y3RqcVVQZE1lMUYKcmpnMVhtL2w4VWJzTG8zLzdUeE5MdlEvaHUxR3c0Z2UraUhQRHZzREpJTmgrYjJCNS8wK1VEcEpPRVZOQWx3bApXYnZoMmgyeWVqcGdFb0grRGJOZE0xRWZPWmJOdmEyRFIySFo5bzlNSnowSGRUOG1pMVIwa2lKcFBVQnVlckVuCkgzYTZpNG9iTFIyNkpzT0pZODZjSGRuUDh3N043NzFGMVNBc0lKN25BRTRhVFlBSmloWGZRdEFhSkdLalY4ZlIKYWhoaHJtdlVFN1hXCi0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K\\n    server: https://10.0.1.171:6443\\n  name: kubernetes\\ncontexts:\\n- context:\\n    cluster: kubernetes\\n    namespace: default\\n    user: jenkins\\n  name: jenkins\\ncurrent-context: jenkins\\nusers:\\n- name: jenkins\\n  user:\\n    token: eyJhbGciOiJSUzI1NiIsImtpZCI6Ii1MQTJuMU9KcFJTbEJkcDE1ZVFUamNiSEMyY0VwNzIxd1N4cFFuX2NiTDgifQ.eyJhdWQiOlsiaHR0cHM6Ly9rdWJlcm5ldGVzLmRlZmF1bHQuc3ZjLmNsdXN0ZXIubG9jYWwiXSwiZXhwIjoxNzIxNTc1NzM2LCJpYXQiOjE3MjE0ODkzMzYsImlzcyI6Imh0dHBzOi8va3ViZXJuZXRlcy5kZWZhdWx0LnN2Yy5jbHVzdGVyLmxvY2FsIiwianRpIjoiMGE2M2I5MmMtNGVhYy00NWUxLThkYTEtNDFkY2Y3NDczMGMxIiwia3ViZXJuZXRlcy5pbyI6eyJuYW1lc3BhY2UiOiJkZWZhdWx0Iiwic2VydmljZWFjY291bnQiOnsibmFtZSI6ImplbmtpbnMiLCJ1aWQiOiIxNzkxMDY4NC1jOTkzLTRiYzctYjU1Mi04NTY2YTI4OWMwYWUifX0sIm5iZiI6MTcyMTQ4OTMzNiwic3ViIjoic3lzdGVtOnNlcnZpY2VhY2NvdW50OmRlZmF1bHQ6amVua2lucyJ9.Y-ZwzxSTx3xKLPrJWEO18InqwmCqeVP8Kfc1p_jQusOwq1-y80SCrsI5QuiciqD656x2kTeN_YmAsbuzajUJ2Mx6E-AMtiH09uiYOeHN236FOZDjBmJG7hh_vk5LIGYwc3z5xWEeJozjEPT4-YNOlfcapLHKO6UakvdzkaggXExxtCRilFVU8ZcnM7WuYoKNUnxx-sUJ092RgyW70gKVsddCQPpkvStjpdQdWZnvGAUU62zzHOATx5jv7x842lrb2CT263KXquGUqugAULOrDTzySo7XuKL-IUbbI_nhrKjjMcOb-BfCRB9DWaTl3Jx_PapFz9B9C3iXO8rl17183A\\nEOF\\n", "start": "2024-07-20 15:29:00.191050", "end": "2024-07-20 15:29:00.207787", "delta": "0:00:00.016737", "msg": "", "invocation": {"module_args": {"_raw_params": "cat <<EOF > /tmp/kubeconfig-jenkins.yaml\\napiVersion: v1\\nkind: Config\\nclusters:\\n- cluster:\\n    certificate-authority-data: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURCVENDQWUyZ0F3SUJBZ0lJTWZSUUtyWWZuaG93RFFZSktvWklodmNOQVFFTEJRQXdGVEVUTUJFR0ExVUUKQXhNS2EzVmlaWEp1WlhSbGN6QWVGdzB5TkRBM01qQXhOVEl6TWpkYUZ3MHpOREEzTVRneE5USTRNamRhTUJVeApFekFSQmdOVkJBTVRDbXQxWW1WeWJtVjBaWE13Z2dFaU1BMEdDU3FHU0liM0RRRUJBUVVBQTRJQkR3QXdnZ0VLCkFvSUJBUUN4d1RvbStjRllqemNsOFBkL2gvYjNPMkV6dG93aXc0NnNLdGdOQmJ4M2hwZmdpV21ISGRiNWVMMS8KdnFXSDNaSlVPb3Q3TVFDNVF1ZlBleHZzQ2dvcklnNG9FNDhIVlBPUG00d0drbG1VWGJLcXNtTEhkaE1XcUNDVApTRHorbjEzaFBRVytJWTVYN0NSNVk4cEhlRVNtRnZMY0xHYlJKR05GOHQyVkVBNlNJRkxIUjJncU8wYk9RcGlvCm41WDljbjRCelVXV2hvQjlkRWdDRjU2d0xxaXRFaTVteFpZenkrZFV3bUdHTVdIZ29NYmloVm1vTHp1aU01cFMKRHRqUlZSczhBUmZ1MXhiaGptYXdJNHZ0QXlXOWUvZ0Z2THJmZ0pQS3V6SlR1MlFPYWRzUi93VldGblRFc1VnagpsV1FkNFhTQmNPQzFDNGVVcE40dnl4TkdWQ3A5QWdNQkFBR2pXVEJYTUE0R0ExVWREd0VCL3dRRUF3SUNwREFQCkJnTlZIUk1CQWY4RUJUQURBUUgvTUIwR0ExVWREZ1FXQkJUYVY5dmd5RnFOSEc3WXVnWFFJRityeisyNWFEQVYKQmdOVkhSRUVEakFNZ2dwcmRXSmxjbTVsZEdWek1BMEdDU3FHU0liM0RRRUJDd1VBQTRJQkFRQVQxeVBTWHdtawpOSWZ6OTF5NW1QaTNUSTZhdGdwcFltSW9lLy9BOVNJZHRQcWtqMnZyenI5YTUrVDRnVUErRGZIelpOeEIyUzNYCmJtWnpvMDZhYnZXSHVnTjVaOEJqREhBWSttUGxYaEVpdThBcUc0UU5HV3c5RFNHVUc2cXp4Y3RqcVVQZE1lMUYKcmpnMVhtL2w4VWJzTG8zLzdUeE5MdlEvaHUxR3c0Z2UraUhQRHZzREpJTmgrYjJCNS8wK1VEcEpPRVZOQWx3bApXYnZoMmgyeWVqcGdFb0grRGJOZE0xRWZPWmJOdmEyRFIySFo5bzlNSnowSGRUOG1pMVIwa2lKcFBVQnVlckVuCkgzYTZpNG9iTFIyNkpzT0pZODZjSGRuUDh3N043NzFGMVNBc0lKN25BRTRhVFlBSmloWGZRdEFhSkdLalY4ZlIKYWhoaHJtdlVFN1hXCi0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K\\n    server: https://10.0.1.171:6443\\n  name: kubernetes\\ncontexts:\\n- context:\\n    cluster: kubernetes\\n    namespace: default\\n    user: jenkins\\n  name: jenkins\\ncurrent-context: jenkins\\nusers:\\n- name: jenkins\\n  user:\\n    token: eyJhbGciOiJSUzI1NiIsImtpZCI6Ii1MQTJuMU9KcFJTbEJkcDE1ZVFUamNiSEMyY0VwNzIxd1N4cFFuX2NiTDgifQ.eyJhdWQiOlsiaHR0cHM6Ly9rdWJlcm5ldGVzLmRlZmF1bHQuc3ZjLmNsdXN0ZXIubG9jYWwiXSwiZXhwIjoxNzIxNTc1NzM2LCJpYXQiOjE3MjE0ODkzMzYsImlzcyI6Imh0dHBzOi8va3ViZXJuZXRlcy5kZWZhdWx0LnN2Yy5jbHVzdGVyLmxvY2FsIiwianRpIjoiMGE2M2I5MmMtNGVhYy00NWUxLThkYTEtNDFkY2Y3NDczMGMxIiwia3ViZXJuZXRlcy5pbyI6eyJuYW1lc3BhY2UiOiJkZWZhdWx0Iiwic2VydmljZWFjY291bnQiOnsibmFtZSI6ImplbmtpbnMiLCJ1aWQiOiIxNzkxMDY4NC1jOTkzLTRiYzctYjU1Mi04NTY2YTI4OWMwYWUifX0sIm5iZiI6MTcyMTQ4OTMzNiwic3ViIjoic3lzdGVtOnNlcnZpY2VhY2NvdW50OmRlZmF1bHQ6amVua2lucyJ9.Y-ZwzxSTx3xKLPrJWEO18InqwmCqeVP8Kfc1p_jQusOwq1-y80SCrsI5QuiciqD656x2kTeN_YmAsbuzajUJ2Mx6E-AMtiH09uiYOeHN236FOZDjBmJG7hh_vk5LIGYwc3z5xWEeJozjEPT4-YNOlfcapLHKO6UakvdzkaggXExxtCRilFVU8ZcnM7WuYoKNUnxx-sUJ092RgyW70gKVsddCQPpkvStjpdQdWZnvGAUU62zzHOATx5jv7x842lrb2CT263KXquGUqugAULOrDTzySo7XuKL-IUbbI_nhrKjjMcOb-BfCRB9DWaTl3Jx_PapFz9B9C3iXO8rl17183A\\nEOF\\n", "_uses_shell": true, "stdin_add_newline": true, "strip_empty_ends": true, "argv": null, "chdir": null, "executable": null, "creates": null, "removes": null, "stdin": null}}}\r\n', b'Shared connection to 10.0.1.171 closed.\r\n')
<10.0.1.171> ESTABLISH SSH CONNECTION FOR USER: ec2-user
<10.0.1.171> SSH: EXEC ssh -C -o ControlMaster=auto -o ControlPersist=60s -o KbdInteractiveAuthentication=no -o PreferredAuthentications=gssapi-with-mic,gssapi-keyex,hostbased,publickey -o PasswordAuthentication=no -o 'User="ec2-user"' -o ConnectTimeout=10 -o 'ControlPath="/home/ec2-user/.ansible/cp/f291336e89"' 10.0.1.171 '/bin/sh -c '"'"'rm -f -r /home/ec2-user/.ansible/tmp/ansible-tmp-1721489339.5392578-327787-255284304918293/ > /dev/null 2>&1 && sleep 0'"'"''
<10.0.1.171> (0, b'', b'')
changed: [master] => {
    "changed": true,
    "cmd": "cat <<EOF > /tmp/kubeconfig-jenkins.yaml\napiVersion: v1\nkind: Config\nclusters:\n- cluster:\n    certificate-authority-data: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURCVENDQWUyZ0F3SUJBZ0lJTWZSUUtyWWZuaG93RFFZSktvWklodmNOQVFFTEJRQXdGVEVUTUJFR0ExVUUKQXhNS2EzVmlaWEp1WlhSbGN6QWVGdzB5TkRBM01qQXhOVEl6TWpkYUZ3MHpOREEzTVRneE5USTRNamRhTUJVeApFekFSQmdOVkJBTVRDbXQxWW1WeWJtVjBaWE13Z2dFaU1BMEdDU3FHU0liM0RRRUJBUVVBQTRJQkR3QXdnZ0VLCkFvSUJBUUN4d1RvbStjRllqemNsOFBkL2gvYjNPMkV6dG93aXc0NnNLdGdOQmJ4M2hwZmdpV21ISGRiNWVMMS8KdnFXSDNaSlVPb3Q3TVFDNVF1ZlBleHZzQ2dvcklnNG9FNDhIVlBPUG00d0drbG1VWGJLcXNtTEhkaE1XcUNDVApTRHorbjEzaFBRVytJWTVYN0NSNVk4cEhlRVNtRnZMY0xHYlJKR05GOHQyVkVBNlNJRkxIUjJncU8wYk9RcGlvCm41WDljbjRCelVXV2hvQjlkRWdDRjU2d0xxaXRFaTVteFpZenkrZFV3bUdHTVdIZ29NYmloVm1vTHp1aU01cFMKRHRqUlZSczhBUmZ1MXhiaGptYXdJNHZ0QXlXOWUvZ0Z2THJmZ0pQS3V6SlR1MlFPYWRzUi93VldGblRFc1VnagpsV1FkNFhTQmNPQzFDNGVVcE40dnl4TkdWQ3A5QWdNQkFBR2pXVEJYTUE0R0ExVWREd0VCL3dRRUF3SUNwREFQCkJnTlZIUk1CQWY4RUJUQURBUUgvTUIwR0ExVWREZ1FXQkJUYVY5dmd5RnFOSEc3WXVnWFFJRityeisyNWFEQVYKQmdOVkhSRUVEakFNZ2dwcmRXSmxjbTVsZEdWek1BMEdDU3FHU0liM0RRRUJDd1VBQTRJQkFRQVQxeVBTWHdtawpOSWZ6OTF5NW1QaTNUSTZhdGdwcFltSW9lLy9BOVNJZHRQcWtqMnZyenI5YTUrVDRnVUErRGZIelpOeEIyUzNYCmJtWnpvMDZhYnZXSHVnTjVaOEJqREhBWSttUGxYaEVpdThBcUc0UU5HV3c5RFNHVUc2cXp4Y3RqcVVQZE1lMUYKcmpnMVhtL2w4VWJzTG8zLzdUeE5MdlEvaHUxR3c0Z2UraUhQRHZzREpJTmgrYjJCNS8wK1VEcEpPRVZOQWx3bApXYnZoMmgyeWVqcGdFb0grRGJOZE0xRWZPWmJOdmEyRFIySFo5bzlNSnowSGRUOG1pMVIwa2lKcFBVQnVlckVuCkgzYTZpNG9iTFIyNkpzT0pZODZjSGRuUDh3N043NzFGMVNBc0lKN25BRTRhVFlBSmloWGZRdEFhSkdLalY4ZlIKYWhoaHJtdlVFN1hXCi0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K\n    server: https://10.0.1.171:6443\n  name: kubernetes\ncontexts:\n- context:\n    cluster: kubernetes\n    namespace: default\n    user: jenkins\n  name: jenkins\ncurrent-context: jenkins\nusers:\n- name: jenkins\n  user:\n    token: eyJhbGciOiJSUzI1NiIsImtpZCI6Ii1MQTJuMU9KcFJTbEJkcDE1ZVFUamNiSEMyY0VwNzIxd1N4cFFuX2NiTDgifQ.eyJhdWQiOlsiaHR0cHM6Ly9rdWJlcm5ldGVzLmRlZmF1bHQuc3ZjLmNsdXN0ZXIubG9jYWwiXSwiZXhwIjoxNzIxNTc1NzM2LCJpYXQiOjE3MjE0ODkzMzYsImlzcyI6Imh0dHBzOi8va3ViZXJuZXRlcy5kZWZhdWx0LnN2Yy5jbHVzdGVyLmxvY2FsIiwianRpIjoiMGE2M2I5MmMtNGVhYy00NWUxLThkYTEtNDFkY2Y3NDczMGMxIiwia3ViZXJuZXRlcy5pbyI6eyJuYW1lc3BhY2UiOiJkZWZhdWx0Iiwic2VydmljZWFjY291bnQiOnsibmFtZSI6ImplbmtpbnMiLCJ1aWQiOiIxNzkxMDY4NC1jOTkzLTRiYzctYjU1Mi04NTY2YTI4OWMwYWUifX0sIm5iZiI6MTcyMTQ4OTMzNiwic3ViIjoic3lzdGVtOnNlcnZpY2VhY2NvdW50OmRlZmF1bHQ6amVua2lucyJ9.Y-ZwzxSTx3xKLPrJWEO18InqwmCqeVP8Kfc1p_jQusOwq1-y80SCrsI5QuiciqD656x2kTeN_YmAsbuzajUJ2Mx6E-AMtiH09uiYOeHN236FOZDjBmJG7hh_vk5LIGYwc3z5xWEeJozjEPT4-YNOlfcapLHKO6UakvdzkaggXExxtCRilFVU8ZcnM7WuYoKNUnxx-sUJ092RgyW70gKVsddCQPpkvStjpdQdWZnvGAUU62zzHOATx5jv7x842lrb2CT263KXquGUqugAULOrDTzySo7XuKL-IUbbI_nhrKjjMcOb-BfCRB9DWaTl3Jx_PapFz9B9C3iXO8rl17183A\nEOF\n",
    "delta": "0:00:00.016737",
    "end": "2024-07-20 15:29:00.207787",
    "invocation": {
        "module_args": {
            "_raw_params": "cat <<EOF > /tmp/kubeconfig-jenkins.yaml\napiVersion: v1\nkind: Config\nclusters:\n- cluster:\n    certificate-authority-data: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURCVENDQWUyZ0F3SUJBZ0lJTWZSUUtyWWZuaG93RFFZSktvWklodmNOQVFFTEJRQXdGVEVUTUJFR0ExVUUKQXhNS2EzVmlaWEp1WlhSbGN6QWVGdzB5TkRBM01qQXhOVEl6TWpkYUZ3MHpOREEzTVRneE5USTRNamRhTUJVeApFekFSQmdOVkJBTVRDbXQxWW1WeWJtVjBaWE13Z2dFaU1BMEdDU3FHU0liM0RRRUJBUVVBQTRJQkR3QXdnZ0VLCkFvSUJBUUN4d1RvbStjRllqemNsOFBkL2gvYjNPMkV6dG93aXc0NnNLdGdOQmJ4M2hwZmdpV21ISGRiNWVMMS8KdnFXSDNaSlVPb3Q3TVFDNVF1ZlBleHZzQ2dvcklnNG9FNDhIVlBPUG00d0drbG1VWGJLcXNtTEhkaE1XcUNDVApTRHorbjEzaFBRVytJWTVYN0NSNVk4cEhlRVNtRnZMY0xHYlJKR05GOHQyVkVBNlNJRkxIUjJncU8wYk9RcGlvCm41WDljbjRCelVXV2hvQjlkRWdDRjU2d0xxaXRFaTVteFpZenkrZFV3bUdHTVdIZ29NYmloVm1vTHp1aU01cFMKRHRqUlZSczhBUmZ1MXhiaGptYXdJNHZ0QXlXOWUvZ0Z2THJmZ0pQS3V6SlR1MlFPYWRzUi93VldGblRFc1VnagpsV1FkNFhTQmNPQzFDNGVVcE40dnl4TkdWQ3A5QWdNQkFBR2pXVEJYTUE0R0ExVWREd0VCL3dRRUF3SUNwREFQCkJnTlZIUk1CQWY4RUJUQURBUUgvTUIwR0ExVWREZ1FXQkJUYVY5dmd5RnFOSEc3WXVnWFFJRityeisyNWFEQVYKQmdOVkhSRUVEakFNZ2dwcmRXSmxjbTVsZEdWek1BMEdDU3FHU0liM0RRRUJDd1VBQTRJQkFRQVQxeVBTWHdtawpOSWZ6OTF5NW1QaTNUSTZhdGdwcFltSW9lLy9BOVNJZHRQcWtqMnZyenI5YTUrVDRnVUErRGZIelpOeEIyUzNYCmJtWnpvMDZhYnZXSHVnTjVaOEJqREhBWSttUGxYaEVpdThBcUc0UU5HV3c5RFNHVUc2cXp4Y3RqcVVQZE1lMUYKcmpnMVhtL2w4VWJzTG8zLzdUeE5MdlEvaHUxR3c0Z2UraUhQRHZzREpJTmgrYjJCNS8wK1VEcEpPRVZOQWx3bApXYnZoMmgyeWVqcGdFb0grRGJOZE0xRWZPWmJOdmEyRFIySFo5bzlNSnowSGRUOG1pMVIwa2lKcFBVQnVlckVuCkgzYTZpNG9iTFIyNkpzT0pZODZjSGRuUDh3N043NzFGMVNBc0lKN25BRTRhVFlBSmloWGZRdEFhSkdLalY4ZlIKYWhoaHJtdlVFN1hXCi0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K\n    server: https://10.0.1.171:6443\n  name: kubernetes\ncontexts:\n- context:\n    cluster: kubernetes\n    namespace: default\n    user: jenkins\n  name: jenkins\ncurrent-context: jenkins\nusers:\n- name: jenkins\n  user:\n    token: eyJhbGciOiJSUzI1NiIsImtpZCI6Ii1MQTJuMU9KcFJTbEJkcDE1ZVFUamNiSEMyY0VwNzIxd1N4cFFuX2NiTDgifQ.eyJhdWQiOlsiaHR0cHM6Ly9rdWJlcm5ldGVzLmRlZmF1bHQuc3ZjLmNsdXN0ZXIubG9jYWwiXSwiZXhwIjoxNzIxNTc1NzM2LCJpYXQiOjE3MjE0ODkzMzYsImlzcyI6Imh0dHBzOi8va3ViZXJuZXRlcy5kZWZhdWx0LnN2Yy5jbHVzdGVyLmxvY2FsIiwianRpIjoiMGE2M2I5MmMtNGVhYy00NWUxLThkYTEtNDFkY2Y3NDczMGMxIiwia3ViZXJuZXRlcy5pbyI6eyJuYW1lc3BhY2UiOiJkZWZhdWx0Iiwic2VydmljZWFjY291bnQiOnsibmFtZSI6ImplbmtpbnMiLCJ1aWQiOiIxNzkxMDY4NC1jOTkzLTRiYzctYjU1Mi04NTY2YTI4OWMwYWUifX0sIm5iZiI6MTcyMTQ4OTMzNiwic3ViIjoic3lzdGVtOnNlcnZpY2VhY2NvdW50OmRlZmF1bHQ6amVua2lucyJ9.Y-ZwzxSTx3xKLPrJWEO18InqwmCqeVP8Kfc1p_jQusOwq1-y80SCrsI5QuiciqD656x2kTeN_YmAsbuzajUJ2Mx6E-AMtiH09uiYOeHN236FOZDjBmJG7hh_vk5LIGYwc3z5xWEeJozjEPT4-YNOlfcapLHKO6UakvdzkaggXExxtCRilFVU8ZcnM7WuYoKNUnxx-sUJ092RgyW70gKVsddCQPpkvStjpdQdWZnvGAUU62zzHOATx5jv7x842lrb2CT263KXquGUqugAULOrDTzySo7XuKL-IUbbI_nhrKjjMcOb-BfCRB9DWaTl3Jx_PapFz9B9C3iXO8rl17183A\nEOF\n",
            "_uses_shell": true,
            "argv": null,
            "chdir": null,
            "creates": null,
            "executable": null,
            "removes": null,
            "stdin": null,
            "stdin_add_newline": true,
            "strip_empty_ends": true
        }
    },
    "msg": "",
    "rc": 0,
    "start": "2024-07-20 15:29:00.191050",
    "stderr": "",
    "stderr_lines": [],
    "stdout": "",
    "stdout_lines": []
}

TASK [Set master private IP globally] ******************************************
task path: /home/ec2-user/devops_setup/ansible/playbooks/kubernetes/setup_kubectl_auth.yaml:103
ok: [master] => {
    "ansible_facts": {
        "global_master_private_ip": "10.0.1.171"
    },
    "changed": false
}

PLAY [Fetch kubeconfig for Jenkins to local machine] ***************************

TASK [Gathering Facts] *********************************************************
task path: /home/ec2-user/devops_setup/ansible/playbooks/kubernetes/setup_kubectl_auth.yaml:107
<127.0.0.1> ESTABLISH LOCAL CONNECTION FOR USER: ec2-user
<127.0.0.1> EXEC /bin/sh -c 'echo ~ec2-user && sleep 0'
<127.0.0.1> EXEC /bin/sh -c '( umask 77 && mkdir -p "` echo /home/ec2-user/.ansible/tmp `"&& mkdir "` echo /home/ec2-user/.ansible/tmp/ansible-tmp-1721489340.4120326-327800-99560274614914 `" && echo ansible-tmp-1721489340.4120326-327800-99560274614914="` echo /home/ec2-user/.ansible/tmp/ansible-tmp-1721489340.4120326-327800-99560274614914 `" ) && sleep 0'
Using module file /usr/lib/python3.9/site-packages/ansible/modules/setup.py
<127.0.0.1> PUT /home/ec2-user/.ansible/tmp/ansible-local-327570hxfw9f7r/tmpg0_20srx TO /home/ec2-user/.ansible/tmp/ansible-tmp-1721489340.4120326-327800-99560274614914/AnsiballZ_setup.py
<127.0.0.1> EXEC /bin/sh -c 'chmod u+x /home/ec2-user/.ansible/tmp/ansible-tmp-1721489340.4120326-327800-99560274614914/ /home/ec2-user/.ansible/tmp/ansible-tmp-1721489340.4120326-327800-99560274614914/AnsiballZ_setup.py && sleep 0'
<127.0.0.1> EXEC /bin/sh -c '/usr/bin/python3.9 /home/ec2-user/.ansible/tmp/ansible-tmp-1721489340.4120326-327800-99560274614914/AnsiballZ_setup.py && sleep 0'
<127.0.0.1> EXEC /bin/sh -c 'rm -f -r /home/ec2-user/.ansible/tmp/ansible-tmp-1721489340.4120326-327800-99560274614914/ > /dev/null 2>&1 && sleep 0'
ok: [localhost]

TASK [Create directory for kubeconfig] *****************************************
task path: /home/ec2-user/devops_setup/ansible/playbooks/kubernetes/setup_kubectl_auth.yaml:110
<127.0.0.1> ESTABLISH LOCAL CONNECTION FOR USER: ec2-user
<127.0.0.1> EXEC /bin/sh -c 'echo ~ec2-user && sleep 0'
<127.0.0.1> EXEC /bin/sh -c '( umask 77 && mkdir -p "` echo /home/ec2-user/.ansible/tmp `"&& mkdir "` echo /home/ec2-user/.ansible/tmp/ansible-tmp-1721489341.305253-327847-120056179378713 `" && echo ansible-tmp-1721489341.305253-327847-120056179378713="` echo /home/ec2-user/.ansible/tmp/ansible-tmp-1721489341.305253-327847-120056179378713 `" ) && sleep 0'
Using module file /usr/lib/python3.9/site-packages/ansible/modules/file.py
<127.0.0.1> PUT /home/ec2-user/.ansible/tmp/ansible-local-327570hxfw9f7r/tmpzpfy5wqh TO /home/ec2-user/.ansible/tmp/ansible-tmp-1721489341.305253-327847-120056179378713/AnsiballZ_file.py
<127.0.0.1> EXEC /bin/sh -c 'chmod u+x /home/ec2-user/.ansible/tmp/ansible-tmp-1721489341.305253-327847-120056179378713/ /home/ec2-user/.ansible/tmp/ansible-tmp-1721489341.305253-327847-120056179378713/AnsiballZ_file.py && sleep 0'
<127.0.0.1> EXEC /bin/sh -c '/usr/bin/python3.9 /home/ec2-user/.ansible/tmp/ansible-tmp-1721489341.305253-327847-120056179378713/AnsiballZ_file.py && sleep 0'
<127.0.0.1> EXEC /bin/sh -c 'rm -f -r /home/ec2-user/.ansible/tmp/ansible-tmp-1721489341.305253-327847-120056179378713/ > /dev/null 2>&1 && sleep 0'
ok: [localhost] => {
    "changed": false,
    "diff": {
        "after": {
            "path": "/home/ec2-user/devops_setup/jenkins-docker"
        },
        "before": {
            "path": "/home/ec2-user/devops_setup/jenkins-docker"
        }
    },
    "gid": 1000,
    "group": "ec2-user",
    "invocation": {
        "module_args": {
            "_diff_peek": null,
            "_original_basename": null,
            "access_time": null,
            "access_time_format": "%Y%m%d%H%M.%S",
            "attributes": null,
            "follow": true,
            "force": false,
            "group": null,
            "mode": "0755",
            "modification_time": null,
            "modification_time_format": "%Y%m%d%H%M.%S",
            "owner": null,
            "path": "/home/ec2-user/devops_setup/jenkins-docker",
            "recurse": false,
            "selevel": null,
            "serole": null,
            "setype": null,
            "seuser": null,
            "src": null,
            "state": "directory",
            "unsafe_writes": false
        }
    },
    "mode": "0755",
    "owner": "ec2-user",
    "path": "/home/ec2-user/devops_setup/jenkins-docker",
    "secontext": "unconfined_u:object_r:user_home_t:s0",
    "size": 24,
    "state": "directory",
    "uid": 1000
}

TASK [Fetch kubeconfig file using scp] *****************************************
task path: /home/ec2-user/devops_setup/ansible/playbooks/kubernetes/setup_kubectl_auth.yaml:116
<localhost> ESTABLISH LOCAL CONNECTION FOR USER: ec2-user
<localhost> EXEC /bin/sh -c 'echo ~ec2-user && sleep 0'
<localhost> EXEC /bin/sh -c '( umask 77 && mkdir -p "` echo /home/ec2-user/.ansible/tmp `"&& mkdir "` echo /home/ec2-user/.ansible/tmp/ansible-tmp-1721489341.72571-327866-124718894953136 `" && echo ansible-tmp-1721489341.72571-327866-124718894953136="` echo /home/ec2-user/.ansible/tmp/ansible-tmp-1721489341.72571-327866-124718894953136 `" ) && sleep 0'
Using module file /usr/lib/python3.9/site-packages/ansible/modules/command.py
<localhost> PUT /home/ec2-user/.ansible/tmp/ansible-local-327570hxfw9f7r/tmpulb3yfjk TO /home/ec2-user/.ansible/tmp/ansible-tmp-1721489341.72571-327866-124718894953136/AnsiballZ_command.py
<localhost> EXEC /bin/sh -c 'chmod u+x /home/ec2-user/.ansible/tmp/ansible-tmp-1721489341.72571-327866-124718894953136/ /home/ec2-user/.ansible/tmp/ansible-tmp-1721489341.72571-327866-124718894953136/AnsiballZ_command.py && sleep 0'
<localhost> EXEC /bin/sh -c 'sudo -H -S -n  -u root /bin/sh -c '"'"'echo BECOME-SUCCESS-ilglfaprurqscljuzsbumkwrvgphvust ; /usr/bin/python3.9 /home/ec2-user/.ansible/tmp/ansible-tmp-1721489341.72571-327866-124718894953136/AnsiballZ_command.py'"'"' && sleep 0'
<localhost> EXEC /bin/sh -c 'rm -f -r /home/ec2-user/.ansible/tmp/ansible-tmp-1721489341.72571-327866-124718894953136/ > /dev/null 2>&1 && sleep 0'
changed: [localhost] => {
    "changed": true,
    "cmd": [
        "scp",
        "-i",
        "/home/ec2-user/.ssh/my-key-pair",
        "ec2-user@10.0.1.171:/tmp/kubeconfig-jenkins.yaml",
        "/home/ec2-user/devops_setup/jenkins-docker/kubeconfig-jenkins.yaml"
    ],
    "delta": "0:00:00.351195",
    "end": "2024-07-20 15:29:02.493234",
    "invocation": {
        "module_args": {
            "_raw_params": "scp -i /home/ec2-user/.ssh/my-key-pair ec2-user@10.0.1.171:/tmp/kubeconfig-jenkins.yaml /home/ec2-user/devops_setup/jenkins-docker/kubeconfig-jenkins.yaml",
            "_uses_shell": false,
            "argv": null,
            "chdir": null,
            "creates": null,
            "executable": null,
            "removes": null,
            "stdin": null,
            "stdin_add_newline": true,
            "strip_empty_ends": true
        }
    },
    "msg": "",
    "rc": 0,
    "start": "2024-07-20 15:29:02.142039",
    "stderr": "",
    "stderr_lines": [],
    "stdout": "",
    "stdout_lines": []
}

TASK [Export KUBECONFIG environment variable] **********************************
task path: /home/ec2-user/devops_setup/ansible/playbooks/kubernetes/setup_kubectl_auth.yaml:122
<127.0.0.1> ESTABLISH LOCAL CONNECTION FOR USER: ec2-user
<127.0.0.1> EXEC /bin/sh -c 'echo ~ec2-user && sleep 0'
<127.0.0.1> EXEC /bin/sh -c '( umask 77 && mkdir -p "` echo /home/ec2-user/.ansible/tmp `"&& mkdir "` echo /home/ec2-user/.ansible/tmp/ansible-tmp-1721489342.551261-327903-146542323466276 `" && echo ansible-tmp-1721489342.551261-327903-146542323466276="` echo /home/ec2-user/.ansible/tmp/ansible-tmp-1721489342.551261-327903-146542323466276 `" ) && sleep 0'
Using module file /usr/lib/python3.9/site-packages/ansible/modules/command.py
<127.0.0.1> PUT /home/ec2-user/.ansible/tmp/ansible-local-327570hxfw9f7r/tmpt5ifwj4m TO /home/ec2-user/.ansible/tmp/ansible-tmp-1721489342.551261-327903-146542323466276/AnsiballZ_command.py
<127.0.0.1> EXEC /bin/sh -c 'chmod u+x /home/ec2-user/.ansible/tmp/ansible-tmp-1721489342.551261-327903-146542323466276/ /home/ec2-user/.ansible/tmp/ansible-tmp-1721489342.551261-327903-146542323466276/AnsiballZ_command.py && sleep 0'
<127.0.0.1> EXEC /bin/sh -c '/usr/bin/python3.9 /home/ec2-user/.ansible/tmp/ansible-tmp-1721489342.551261-327903-146542323466276/AnsiballZ_command.py && sleep 0'
<127.0.0.1> EXEC /bin/sh -c 'rm -f -r /home/ec2-user/.ansible/tmp/ansible-tmp-1721489342.551261-327903-146542323466276/ > /dev/null 2>&1 && sleep 0'
changed: [localhost] => {
    "changed": true,
    "cmd": "export KUBECONFIG=/home/ec2-user/devops_setup/jenkins-docker/kubeconfig-jenkins.yaml\necho \"export KUBECONFIG=/home/ec2-user/devops_setup/jenkins-docker/kubeconfig-jenkins.yaml\" >> ~/.bashrc\nsource ~/.bashrc\n",
    "delta": "0:00:00.026030",
    "end": "2024-07-20 15:29:02.778126",
    "invocation": {
        "module_args": {
            "_raw_params": "export KUBECONFIG=/home/ec2-user/devops_setup/jenkins-docker/kubeconfig-jenkins.yaml\necho \"export KUBECONFIG=/home/ec2-user/devops_setup/jenkins-docker/kubeconfig-jenkins.yaml\" >> ~/.bashrc\nsource ~/.bashrc\n",
            "_uses_shell": true,
            "argv": null,
            "chdir": null,
            "creates": null,
            "executable": "/bin/bash",
            "removes": null,
            "stdin": null,
            "stdin_add_newline": true,
            "strip_empty_ends": true
        }
    },
    "msg": "",
    "rc": 0,
    "start": "2024-07-20 15:29:02.752096",
    "stderr": "",
    "stderr_lines": [],
    "stdout": "",
    "stdout_lines": []
}

PLAY RECAP *********************************************************************
localhost                  : ok=4    changed=2    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   
master                     : ok=17   changed=11   unreachable=0    failed=0    skipped=0    rescued=0    ignored=3   

