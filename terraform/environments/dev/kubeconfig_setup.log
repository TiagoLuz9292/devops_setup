Running playbook with environment: dev
No config file found; using defaults

PLAY [Setup Jenkins service account on Kubernetes] *****************************

TASK [Gathering Facts] *********************************************************
[WARNING]: Platform linux on host master is using the discovered Python
interpreter at /usr/bin/python3.9, but future installation of another Python
interpreter could change the meaning of that path. See
https://docs.ansible.com/ansible-
core/2.15/reference_appendices/interpreter_discovery.html for more information.
ok: [master]

TASK [Print environment variable] **********************************************
ok: [master] => {
    "msg": "Environment is dev"
}

TASK [Get private IP using curl] ***********************************************
changed: [master] => {"changed": true, "cmd": ["curl", "-s", "http://169.254.169.254/latest/meta-data/local-ipv4"], "delta": "0:00:00.017102", "end": "2024-07-31 20:30:59.271738", "msg": "", "rc": 0, "start": "2024-07-31 20:30:59.254636", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Set master private IP fact] **********************************************
ok: [master] => {"ansible_facts": {"master_private_ip": ""}, "changed": false}

TASK [Print private IP] ********************************************************
ok: [master] => {
    "msg": "The private IP of the target server is: 10.1.1.225"
}

TASK [Set KUBECONFIG environment variable] *************************************
ok: [master] => {"ansible_facts": {"kubeconfig_path": "/etc/kubernetes/admin.conf"}, "changed": false}

TASK [Remove existing Jenkins service account] *********************************
fatal: [master]: FAILED! => {"changed": true, "cmd": ["kubectl", "delete", "serviceaccount", "jenkins", "-n", "default"], "delta": "0:00:00.130692", "end": "2024-07-31 20:31:00.503200", "msg": "non-zero return code", "rc": 1, "start": "2024-07-31 20:31:00.372508", "stderr": "Error from server (NotFound): serviceaccounts \"jenkins\" not found", "stderr_lines": ["Error from server (NotFound): serviceaccounts \"jenkins\" not found"], "stdout": "", "stdout_lines": []}
...ignoring

TASK [Remove existing Jenkins cluster role binding] ****************************
fatal: [master]: FAILED! => {"changed": true, "cmd": ["kubectl", "delete", "clusterrolebinding", "jenkins"], "delta": "0:00:00.142334", "end": "2024-07-31 20:31:01.576933", "msg": "non-zero return code", "rc": 1, "start": "2024-07-31 20:31:01.434599", "stderr": "Error from server (NotFound): clusterrolebindings.rbac.authorization.k8s.io \"jenkins\" not found", "stderr_lines": ["Error from server (NotFound): clusterrolebindings.rbac.authorization.k8s.io \"jenkins\" not found"], "stdout": "", "stdout_lines": []}
...ignoring

TASK [Remove existing Jenkins secret] ******************************************
fatal: [master]: FAILED! => {"changed": true, "cmd": ["kubectl", "delete", "secret", "jenkins-secret", "-n", "default"], "delta": "0:00:00.146731", "end": "2024-07-31 20:31:03.060268", "msg": "non-zero return code", "rc": 1, "start": "2024-07-31 20:31:02.913537", "stderr": "Error from server (NotFound): secrets \"jenkins-secret\" not found", "stderr_lines": ["Error from server (NotFound): secrets \"jenkins-secret\" not found"], "stdout": "", "stdout_lines": []}
...ignoring

TASK [Remove existing kubeconfig file for Jenkins] *****************************
ok: [master] => {"changed": false, "path": "/tmp/kubeconfig-jenkins.yaml", "state": "absent"}

TASK [Create service account for Jenkins] **************************************
changed: [master] => {"changed": true, "cmd": ["kubectl", "create", "serviceaccount", "jenkins", "-n", "default"], "delta": "0:00:00.088176", "end": "2024-07-31 20:31:04.854455", "msg": "", "rc": 0, "start": "2024-07-31 20:31:04.766279", "stderr": "", "stderr_lines": [], "stdout": "serviceaccount/jenkins created", "stdout_lines": ["serviceaccount/jenkins created"]}

TASK [Create cluster role binding for Jenkins] *********************************
changed: [master] => {"changed": true, "cmd": ["kubectl", "create", "clusterrolebinding", "jenkins", "--clusterrole=cluster-admin", "--serviceaccount=default:jenkins"], "delta": "0:00:00.118685", "end": "2024-07-31 20:31:05.786667", "msg": "", "rc": 0, "start": "2024-07-31 20:31:05.667982", "stderr": "", "stderr_lines": [], "stdout": "clusterrolebinding.rbac.authorization.k8s.io/jenkins created", "stdout_lines": ["clusterrolebinding.rbac.authorization.k8s.io/jenkins created"]}

TASK [Get Jenkins token] *******************************************************
changed: [master] => {"changed": true, "cmd": ["kubectl", "create", "token", "jenkins", "-n", "default", "--duration=24h"], "delta": "0:00:00.094425", "end": "2024-07-31 20:31:07.025851", "msg": "", "rc": 0, "start": "2024-07-31 20:31:06.931426", "stderr": "", "stderr_lines": [], "stdout": "eyJhbGciOiJSUzI1NiIsImtpZCI6IlIyYlFGZVN2V2ROUDlvN0ZwdFgyZFdKMUxWUHVLeXBXay01dlhBVFlzUm8ifQ.eyJhdWQiOlsiaHR0cHM6Ly9rdWJlcm5ldGVzLmRlZmF1bHQuc3ZjLmNsdXN0ZXIubG9jYWwiXSwiZXhwIjoxNzIyNTQ0MjY3LCJpYXQiOjE3MjI0NTc4NjcsImlzcyI6Imh0dHBzOi8va3ViZXJuZXRlcy5kZWZhdWx0LnN2Yy5jbHVzdGVyLmxvY2FsIiwianRpIjoiNjI3MWY0OGUtNzc5ZC00NWIwLTgxMjItY2QzZWY4YTBiZGI0Iiwia3ViZXJuZXRlcy5pbyI6eyJuYW1lc3BhY2UiOiJkZWZhdWx0Iiwic2VydmljZWFjY291bnQiOnsibmFtZSI6ImplbmtpbnMiLCJ1aWQiOiI0MmNkNDRlYy1lY2MyLTRkNjEtYmJhZC0zMWYxZmQwZGE5NjYifX0sIm5iZiI6MTcyMjQ1Nzg2Nywic3ViIjoic3lzdGVtOnNlcnZpY2VhY2NvdW50OmRlZmF1bHQ6amVua2lucyJ9.mxJjO79XkxjKF1PPsl-cz77uM2kPKtpHlUMwNen9yazIxHFoWO0UzNEoFagwY86BCZ4ECdSr9I4CXrliyHutDSJxd7KjSrkwdem8-HLauqsazjTCSnlgZ5CVPcscuxFjTywaHKH4wIFSdf7K5fYNwUIhO2ul8pY0U4wM88k-_XPpZKY78eaFcrHG0XRGIDbjVlxY68Wt8fjEkbhnhzDwyof2GsFr2b2DpPB6RFakkV3AI_l4WCT5qR2N1OISVBmQzuDd7MLUZLMKLbdg-fhp3MPsyg7IgG-eJ56tRkawaBHfHk8PHg_SzV5h8x4LOgRknh8CWaOVkL2nA0oYl8qJHQ", "stdout_lines": ["eyJhbGciOiJSUzI1NiIsImtpZCI6IlIyYlFGZVN2V2ROUDlvN0ZwdFgyZFdKMUxWUHVLeXBXay01dlhBVFlzUm8ifQ.eyJhdWQiOlsiaHR0cHM6Ly9rdWJlcm5ldGVzLmRlZmF1bHQuc3ZjLmNsdXN0ZXIubG9jYWwiXSwiZXhwIjoxNzIyNTQ0MjY3LCJpYXQiOjE3MjI0NTc4NjcsImlzcyI6Imh0dHBzOi8va3ViZXJuZXRlcy5kZWZhdWx0LnN2Yy5jbHVzdGVyLmxvY2FsIiwianRpIjoiNjI3MWY0OGUtNzc5ZC00NWIwLTgxMjItY2QzZWY4YTBiZGI0Iiwia3ViZXJuZXRlcy5pbyI6eyJuYW1lc3BhY2UiOiJkZWZhdWx0Iiwic2VydmljZWFjY291bnQiOnsibmFtZSI6ImplbmtpbnMiLCJ1aWQiOiI0MmNkNDRlYy1lY2MyLTRkNjEtYmJhZC0zMWYxZmQwZGE5NjYifX0sIm5iZiI6MTcyMjQ1Nzg2Nywic3ViIjoic3lzdGVtOnNlcnZpY2VhY2NvdW50OmRlZmF1bHQ6amVua2lucyJ9.mxJjO79XkxjKF1PPsl-cz77uM2kPKtpHlUMwNen9yazIxHFoWO0UzNEoFagwY86BCZ4ECdSr9I4CXrliyHutDSJxd7KjSrkwdem8-HLauqsazjTCSnlgZ5CVPcscuxFjTywaHKH4wIFSdf7K5fYNwUIhO2ul8pY0U4wM88k-_XPpZKY78eaFcrHG0XRGIDbjVlxY68Wt8fjEkbhnhzDwyof2GsFr2b2DpPB6RFakkV3AI_l4WCT5qR2N1OISVBmQzuDd7MLUZLMKLbdg-fhp3MPsyg7IgG-eJ56tRkawaBHfHk8PHg_SzV5h8x4LOgRknh8CWaOVkL2nA0oYl8qJHQ"]}

TASK [Create secret for Jenkins token] *****************************************
changed: [master] => {"changed": true, "cmd": ["kubectl", "create", "secret", "generic", "jenkins-secret", "--namespace", "default", "--from-literal=token=eyJhbGciOiJSUzI1NiIsImtpZCI6IlIyYlFGZVN2V2ROUDlvN0ZwdFgyZFdKMUxWUHVLeXBXay01dlhBVFlzUm8ifQ.eyJhdWQiOlsiaHR0cHM6Ly9rdWJlcm5ldGVzLmRlZmF1bHQuc3ZjLmNsdXN0ZXIubG9jYWwiXSwiZXhwIjoxNzIyNTQ0MjY3LCJpYXQiOjE3MjI0NTc4NjcsImlzcyI6Imh0dHBzOi8va3ViZXJuZXRlcy5kZWZhdWx0LnN2Yy5jbHVzdGVyLmxvY2FsIiwianRpIjoiNjI3MWY0OGUtNzc5ZC00NWIwLTgxMjItY2QzZWY4YTBiZGI0Iiwia3ViZXJuZXRlcy5pbyI6eyJuYW1lc3BhY2UiOiJkZWZhdWx0Iiwic2VydmljZWFjY291bnQiOnsibmFtZSI6ImplbmtpbnMiLCJ1aWQiOiI0MmNkNDRlYy1lY2MyLTRkNjEtYmJhZC0zMWYxZmQwZGE5NjYifX0sIm5iZiI6MTcyMjQ1Nzg2Nywic3ViIjoic3lzdGVtOnNlcnZpY2VhY2NvdW50OmRlZmF1bHQ6amVua2lucyJ9.mxJjO79XkxjKF1PPsl-cz77uM2kPKtpHlUMwNen9yazIxHFoWO0UzNEoFagwY86BCZ4ECdSr9I4CXrliyHutDSJxd7KjSrkwdem8-HLauqsazjTCSnlgZ5CVPcscuxFjTywaHKH4wIFSdf7K5fYNwUIhO2ul8pY0U4wM88k-_XPpZKY78eaFcrHG0XRGIDbjVlxY68Wt8fjEkbhnhzDwyof2GsFr2b2DpPB6RFakkV3AI_l4WCT5qR2N1OISVBmQzuDd7MLUZLMKLbdg-fhp3MPsyg7IgG-eJ56tRkawaBHfHk8PHg_SzV5h8x4LOgRknh8CWaOVkL2nA0oYl8qJHQ", "--from-file=ca.crt=/etc/kubernetes/pki/ca.crt"], "delta": "0:00:00.123407", "end": "2024-07-31 20:31:08.131109", "msg": "", "rc": 0, "start": "2024-07-31 20:31:08.007702", "stderr": "", "stderr_lines": [], "stdout": "secret/jenkins-secret created", "stdout_lines": ["secret/jenkins-secret created"]}

TASK [Patch service account with secret] ***************************************
changed: [master] => {"changed": true, "cmd": "kubectl patch serviceaccount jenkins -n default -p '{\"secrets\": [{\"name\": \"jenkins-secret\"}]}'\n", "delta": "0:00:00.170410", "end": "2024-07-31 20:31:09.355753", "msg": "", "rc": 0, "start": "2024-07-31 20:31:09.185343", "stderr": "", "stderr_lines": [], "stdout": "serviceaccount/jenkins patched", "stdout_lines": ["serviceaccount/jenkins patched"]}

TASK [Retrieve certificate-authority-data] *************************************
changed: [master] => {"changed": true, "cmd": ["kubectl", "get", "secret", "jenkins-secret", "-n", "default", "-o", "jsonpath={.data['ca\\.crt']}"], "delta": "0:00:00.118496", "end": "2024-07-31 20:31:10.566413", "msg": "", "rc": 0, "start": "2024-07-31 20:31:10.447917", "stderr": "", "stderr_lines": [], "stdout": "LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURCVENDQWUyZ0F3SUJBZ0lJYytJL0UreVJCeE13RFFZSktvWklodmNOQVFFTEJRQXdGVEVUTUJFR0ExVUUKQXhNS2EzVmlaWEp1WlhSbGN6QWVGdzB5TkRBM016RXlNREkxTWpoYUZ3MHpOREEzTWpreU1ETXdNamhhTUJVeApFekFSQmdOVkJBTVRDbXQxWW1WeWJtVjBaWE13Z2dFaU1BMEdDU3FHU0liM0RRRUJBUVVBQTRJQkR3QXdnZ0VLCkFvSUJBUUN4L2hzWTVjSmxmQnJQN0lTSjBiWGtlYXNGVHpPZklNUENDYlB2S3BCN01xUGNuK2VORm1yR2k4a0IKZ3dHc2FMLzFVVjdxeWxUUDhjNCtIcEs5aThJc0o4aTBaOEcwQXRxQjBwTnFCN0piWCtmY1dpRXFES2JiVnVyTwpUZUo1Y0h4WXZsMU5VMC9xbDRYVzRwVndzVkZTVDZENFA3OXE2enFiVTZTL3NBc1c4QXFlWFYwTms4S200RFJoCkQ3NmdZNHVqOXNyR0c2Z1d5ejVrWU1EZmNBR2pKY3pKOFNNT3VtR2tTdFRuV3dCdEdIV2RTOUFsaHJMWDFHOXkKdWZwUGhHdXNORlg0U2NLbzNzWk1pek05eFIzZ1FlQ0MwaFp2VkJnU0I5VldQbjg3VjE2dWhkRWs1cjlqK0dJdwo4U1J6U0R1RHc1cklhMGRDRE1xU2RlZnhyR2NMQWdNQkFBR2pXVEJYTUE0R0ExVWREd0VCL3dRRUF3SUNwREFQCkJnTlZIUk1CQWY4RUJUQURBUUgvTUIwR0ExVWREZ1FXQkJUZEQ2b1cxby95czJ0by93ZTJXQjRxbGVxQVZ6QVYKQmdOVkhSRUVEakFNZ2dwcmRXSmxjbTVsZEdWek1BMEdDU3FHU0liM0RRRUJDd1VBQTRJQkFRQ0MxNlkrcm5meAoxb25QdTEybjFxVCtKWVZZMThWa3RXbG5wVDBPV1hFRWpNN0JwM3RDZlZ1dWRTaytBRVY4U0JIZlIrdUN3bVJoCkJQdTlLdGg3bVNNQ3B1MC9EUklKbDgwR01MTlZjTkF5enJnV0ZDOTlTTFN2RGkwaG9JR2lVS0gxQmp5Qi9FSVYKNDhFUGlOc3dOQ3pKRnNWbmZBNFBiRTRWVnloKzd4YkFsb2h2enBJY0R2Y0Rwc2dLTUw0aUlQbzVoMXFzQnFVZQpucG11V1VqTjJsVUtxaExKaEpjQUdybWlMV3dtb01qOVp3ZTVRQmowWU82MDl0MnVEQ3NteEx4YXdGeSt4dnpRCmZObHQ3c2FSL1gyVDBXMDM4VmQxWnNoOXAzU1ozMVJ5UnVnMENjNU1yWEdrMmREWXBYYzZjVmJ1ajJJWWVMU0cKQy9vMWhGWG92TkI0Ci0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K", "stdout_lines": ["LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURCVENDQWUyZ0F3SUJBZ0lJYytJL0UreVJCeE13RFFZSktvWklodmNOQVFFTEJRQXdGVEVUTUJFR0ExVUUKQXhNS2EzVmlaWEp1WlhSbGN6QWVGdzB5TkRBM016RXlNREkxTWpoYUZ3MHpOREEzTWpreU1ETXdNamhhTUJVeApFekFSQmdOVkJBTVRDbXQxWW1WeWJtVjBaWE13Z2dFaU1BMEdDU3FHU0liM0RRRUJBUVVBQTRJQkR3QXdnZ0VLCkFvSUJBUUN4L2hzWTVjSmxmQnJQN0lTSjBiWGtlYXNGVHpPZklNUENDYlB2S3BCN01xUGNuK2VORm1yR2k4a0IKZ3dHc2FMLzFVVjdxeWxUUDhjNCtIcEs5aThJc0o4aTBaOEcwQXRxQjBwTnFCN0piWCtmY1dpRXFES2JiVnVyTwpUZUo1Y0h4WXZsMU5VMC9xbDRYVzRwVndzVkZTVDZENFA3OXE2enFiVTZTL3NBc1c4QXFlWFYwTms4S200RFJoCkQ3NmdZNHVqOXNyR0c2Z1d5ejVrWU1EZmNBR2pKY3pKOFNNT3VtR2tTdFRuV3dCdEdIV2RTOUFsaHJMWDFHOXkKdWZwUGhHdXNORlg0U2NLbzNzWk1pek05eFIzZ1FlQ0MwaFp2VkJnU0I5VldQbjg3VjE2dWhkRWs1cjlqK0dJdwo4U1J6U0R1RHc1cklhMGRDRE1xU2RlZnhyR2NMQWdNQkFBR2pXVEJYTUE0R0ExVWREd0VCL3dRRUF3SUNwREFQCkJnTlZIUk1CQWY4RUJUQURBUUgvTUIwR0ExVWREZ1FXQkJUZEQ2b1cxby95czJ0by93ZTJXQjRxbGVxQVZ6QVYKQmdOVkhSRUVEakFNZ2dwcmRXSmxjbTVsZEdWek1BMEdDU3FHU0liM0RRRUJDd1VBQTRJQkFRQ0MxNlkrcm5meAoxb25QdTEybjFxVCtKWVZZMThWa3RXbG5wVDBPV1hFRWpNN0JwM3RDZlZ1dWRTaytBRVY4U0JIZlIrdUN3bVJoCkJQdTlLdGg3bVNNQ3B1MC9EUklKbDgwR01MTlZjTkF5enJnV0ZDOTlTTFN2RGkwaG9JR2lVS0gxQmp5Qi9FSVYKNDhFUGlOc3dOQ3pKRnNWbmZBNFBiRTRWVnloKzd4YkFsb2h2enBJY0R2Y0Rwc2dLTUw0aUlQbzVoMXFzQnFVZQpucG11V1VqTjJsVUtxaExKaEpjQUdybWlMV3dtb01qOVp3ZTVRQmowWU82MDl0MnVEQ3NteEx4YXdGeSt4dnpRCmZObHQ3c2FSL1gyVDBXMDM4VmQxWnNoOXAzU1ozMVJ5UnVnMENjNU1yWEdrMmREWXBYYzZjVmJ1ajJJWWVMU0cKQy9vMWhGWG92TkI0Ci0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K"]}

TASK [Create kubeconfig file for Jenkins] **************************************
changed: [master] => {"changed": true, "cmd": "cat <<EOF > /tmp/kubeconfig-jenkins.yaml\napiVersion: v1\nkind: Config\nclusters:\n- cluster:\n    certificate-authority-data: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURCVENDQWUyZ0F3SUJBZ0lJYytJL0UreVJCeE13RFFZSktvWklodmNOQVFFTEJRQXdGVEVUTUJFR0ExVUUKQXhNS2EzVmlaWEp1WlhSbGN6QWVGdzB5TkRBM016RXlNREkxTWpoYUZ3MHpOREEzTWpreU1ETXdNamhhTUJVeApFekFSQmdOVkJBTVRDbXQxWW1WeWJtVjBaWE13Z2dFaU1BMEdDU3FHU0liM0RRRUJBUVVBQTRJQkR3QXdnZ0VLCkFvSUJBUUN4L2hzWTVjSmxmQnJQN0lTSjBiWGtlYXNGVHpPZklNUENDYlB2S3BCN01xUGNuK2VORm1yR2k4a0IKZ3dHc2FMLzFVVjdxeWxUUDhjNCtIcEs5aThJc0o4aTBaOEcwQXRxQjBwTnFCN0piWCtmY1dpRXFES2JiVnVyTwpUZUo1Y0h4WXZsMU5VMC9xbDRYVzRwVndzVkZTVDZENFA3OXE2enFiVTZTL3NBc1c4QXFlWFYwTms4S200RFJoCkQ3NmdZNHVqOXNyR0c2Z1d5ejVrWU1EZmNBR2pKY3pKOFNNT3VtR2tTdFRuV3dCdEdIV2RTOUFsaHJMWDFHOXkKdWZwUGhHdXNORlg0U2NLbzNzWk1pek05eFIzZ1FlQ0MwaFp2VkJnU0I5VldQbjg3VjE2dWhkRWs1cjlqK0dJdwo4U1J6U0R1RHc1cklhMGRDRE1xU2RlZnhyR2NMQWdNQkFBR2pXVEJYTUE0R0ExVWREd0VCL3dRRUF3SUNwREFQCkJnTlZIUk1CQWY4RUJUQURBUUgvTUIwR0ExVWREZ1FXQkJUZEQ2b1cxby95czJ0by93ZTJXQjRxbGVxQVZ6QVYKQmdOVkhSRUVEakFNZ2dwcmRXSmxjbTVsZEdWek1BMEdDU3FHU0liM0RRRUJDd1VBQTRJQkFRQ0MxNlkrcm5meAoxb25QdTEybjFxVCtKWVZZMThWa3RXbG5wVDBPV1hFRWpNN0JwM3RDZlZ1dWRTaytBRVY4U0JIZlIrdUN3bVJoCkJQdTlLdGg3bVNNQ3B1MC9EUklKbDgwR01MTlZjTkF5enJnV0ZDOTlTTFN2RGkwaG9JR2lVS0gxQmp5Qi9FSVYKNDhFUGlOc3dOQ3pKRnNWbmZBNFBiRTRWVnloKzd4YkFsb2h2enBJY0R2Y0Rwc2dLTUw0aUlQbzVoMXFzQnFVZQpucG11V1VqTjJsVUtxaExKaEpjQUdybWlMV3dtb01qOVp3ZTVRQmowWU82MDl0MnVEQ3NteEx4YXdGeSt4dnpRCmZObHQ3c2FSL1gyVDBXMDM4VmQxWnNoOXAzU1ozMVJ5UnVnMENjNU1yWEdrMmREWXBYYzZjVmJ1ajJJWWVMU0cKQy9vMWhGWG92TkI0Ci0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K\n    server: https://10.1.1.225:6443\n  name: kubernetes\ncontexts:\n- context:\n    cluster: kubernetes\n    namespace: default\n    user: jenkins\n  name: jenkins\ncurrent-context: jenkins\nusers:\n- name: jenkins\n  user:\n    token: eyJhbGciOiJSUzI1NiIsImtpZCI6IlIyYlFGZVN2V2ROUDlvN0ZwdFgyZFdKMUxWUHVLeXBXay01dlhBVFlzUm8ifQ.eyJhdWQiOlsiaHR0cHM6Ly9rdWJlcm5ldGVzLmRlZmF1bHQuc3ZjLmNsdXN0ZXIubG9jYWwiXSwiZXhwIjoxNzIyNTQ0MjY3LCJpYXQiOjE3MjI0NTc4NjcsImlzcyI6Imh0dHBzOi8va3ViZXJuZXRlcy5kZWZhdWx0LnN2Yy5jbHVzdGVyLmxvY2FsIiwianRpIjoiNjI3MWY0OGUtNzc5ZC00NWIwLTgxMjItY2QzZWY4YTBiZGI0Iiwia3ViZXJuZXRlcy5pbyI6eyJuYW1lc3BhY2UiOiJkZWZhdWx0Iiwic2VydmljZWFjY291bnQiOnsibmFtZSI6ImplbmtpbnMiLCJ1aWQiOiI0MmNkNDRlYy1lY2MyLTRkNjEtYmJhZC0zMWYxZmQwZGE5NjYifX0sIm5iZiI6MTcyMjQ1Nzg2Nywic3ViIjoic3lzdGVtOnNlcnZpY2VhY2NvdW50OmRlZmF1bHQ6amVua2lucyJ9.mxJjO79XkxjKF1PPsl-cz77uM2kPKtpHlUMwNen9yazIxHFoWO0UzNEoFagwY86BCZ4ECdSr9I4CXrliyHutDSJxd7KjSrkwdem8-HLauqsazjTCSnlgZ5CVPcscuxFjTywaHKH4wIFSdf7K5fYNwUIhO2ul8pY0U4wM88k-_XPpZKY78eaFcrHG0XRGIDbjVlxY68Wt8fjEkbhnhzDwyof2GsFr2b2DpPB6RFakkV3AI_l4WCT5qR2N1OISVBmQzuDd7MLUZLMKLbdg-fhp3MPsyg7IgG-eJ56tRkawaBHfHk8PHg_SzV5h8x4LOgRknh8CWaOVkL2nA0oYl8qJHQ\nEOF\n", "delta": "0:00:00.008797", "end": "2024-07-31 20:31:11.661830", "msg": "", "rc": 0, "start": "2024-07-31 20:31:11.653033", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Set master private IP globally] ******************************************
ok: [master] => {"ansible_facts": {"global_master_private_ip": "10.1.1.225"}, "changed": false}

PLAY [Fetch kubeconfig for Jenkins to local machine] ***************************

TASK [Gathering Facts] *********************************************************
ok: [localhost]

TASK [Create directory for kubeconfig] *****************************************
ok: [localhost] => {"changed": false, "gid": 1000, "group": "ec2-user", "mode": "0755", "owner": "ec2-user", "path": "/home/ec2-user/devops_setup/jenkins-docker", "secontext": "unconfined_u:object_r:user_home_t:s0", "size": 6, "state": "directory", "uid": 1000}

TASK [Remove old host key for the master node] *********************************
changed: [localhost] => {"changed": true, "cmd": "ssh-keygen -R 10.1.1.225\n", "delta": "0:00:00.010115", "end": "2024-07-31 20:31:13.686839", "msg": "", "rc": 0, "start": "2024-07-31 20:31:13.676724", "stderr": "", "stderr_lines": [], "stdout": "# Host 10.1.1.225 found: line 59\n# Host 10.1.1.225 found: line 60\n/home/ec2-user/.ssh/known_hosts updated.\nOriginal contents retained as /home/ec2-user/.ssh/known_hosts.old", "stdout_lines": ["# Host 10.1.1.225 found: line 59", "# Host 10.1.1.225 found: line 60", "/home/ec2-user/.ssh/known_hosts updated.", "Original contents retained as /home/ec2-user/.ssh/known_hosts.old"]}

TASK [Fetch kubeconfig file using scp] *****************************************
changed: [localhost] => {"changed": true, "cmd": ["scp", "-o", "StrictHostKeyChecking=no", "-i", "/home/ec2-user/.ssh/my-key-pair", "ec2-user@10.1.1.225:/tmp/kubeconfig-jenkins.yaml", "/home/ec2-user/.ssh/kubeconfig-dev.yaml"], "delta": "0:00:00.355890", "end": "2024-07-31 20:31:14.521306", "msg": "", "rc": 0, "start": "2024-07-31 20:31:14.165416", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Export KUBECONFIG environment variable] **********************************
changed: [localhost] => {"changed": true, "cmd": "if ! grep -Fxq \"export KUBECONFIG=/home/ec2-user/.ssh/kubeconfig-dev.yaml\" ~/.bashrc; then\n  echo \"export KUBECONFIG=/home/ec2-user/.ssh/kubeconfig-dev.yaml\" >> ~/.bashrc\nfi\n", "delta": "0:00:00.005896", "end": "2024-07-31 20:31:15.118170", "msg": "", "rc": 0, "start": "2024-07-31 20:31:15.112274", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Copy kubeconfig file to lambda package directory] ************************
changed: [localhost] => {"changed": true, "checksum": "9543beb5189172f5d4b2ecc2a25ddf6f8ce98d5c", "dest": "/home/ec2-user/devops_setup/terraform/environments/dev/lifecycle_hooks/lambda_package/kubeconfig.yaml", "gid": 0, "group": "root", "md5sum": "9b966a48db9071e00678ce44b95d7527", "mode": "0644", "owner": "root", "secontext": "unconfined_u:object_r:user_home_t:s0", "size": 2713, "src": "/home/ec2-user/.ansible/tmp/ansible-tmp-1722457875.1919243-160597-170981164058212/source", "state": "file", "uid": 0}

TASK [Create the Lambda package] ***********************************************
changed: [localhost] => {"changed": true, "cmd": "cd /home/ec2-user/devops_setup/terraform/environments/dev/lifecycle_hooks/lambda_package\nzip lambda_function.zip lambda_function.py kubectl kubeconfig.yaml\n", "delta": "0:00:03.767672", "end": "2024-07-31 20:31:20.542278", "msg": "", "rc": 0, "start": "2024-07-31 20:31:16.774606", "stderr": "", "stderr_lines": [], "stdout": "  adding: lambda_function.py (deflated 60%)\n  adding: kubectl (deflated 69%)\n  adding: kubeconfig.yaml (deflated 28%)", "stdout_lines": ["  adding: lambda_function.py (deflated 60%)", "  adding: kubectl (deflated 69%)", "  adding: kubeconfig.yaml (deflated 28%)"]}

TASK [Move the Lambda package zip to the parent directory] *********************
changed: [localhost] => {"changed": true, "cmd": "mv /home/ec2-user/devops_setup/terraform/environments/dev/lifecycle_hooks/lambda_package/lambda_function.zip /home/ec2-user/devops_setup/terraform/environments/dev/lifecycle_hooks\n", "delta": "0:00:00.008682", "end": "2024-07-31 20:31:21.036802", "msg": "", "rc": 0, "start": "2024-07-31 20:31:21.028120", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

PLAY RECAP *********************************************************************
localhost                  : ok=8    changed=6    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   
master                     : ok=18   changed=11   unreachable=0    failed=0    skipped=0    rescued=0    ignored=3   

